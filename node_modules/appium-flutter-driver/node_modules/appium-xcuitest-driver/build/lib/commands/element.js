"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _baseDriver = require("@appium/base-driver");

var _support = require("@appium/support");

var _logger = _interopRequireDefault(require("../logger"));

const commands = {},
      extensions = {};
exports.commands = commands;

commands.elementDisplayed = async function elementDisplayed(el) {
  el = _support.util.unwrapElement(el);

  if (this.isWebContext()) {
    const atomsElement = this.getAtomsElement(el);
    return await this.executeAtom('is_displayed', [atomsElement]);
  }

  return await this.proxyCommand(`/element/${el}/displayed`, 'GET');
};

commands.elementEnabled = async function elementEnabled(el) {
  el = _support.util.unwrapElement(el);

  if (this.isWebContext()) {
    const atomsElement = this.getAtomsElement(el);
    return await this.executeAtom('is_enabled', [atomsElement]);
  }

  return await this.proxyCommand(`/element/${el}/enabled`, 'GET');
};

commands.elementSelected = async function elementSelected(el) {
  el = _support.util.unwrapElement(el);

  if (this.isWebContext()) {
    const atomsElement = this.getAtomsElement(el);
    return await this.executeAtom('is_selected', [atomsElement]);
  }

  return await this.proxyCommand(`/element/${el}/selected`, 'GET');
};

commands.getName = async function getName(el) {
  el = _support.util.unwrapElement(el);

  if (this.isWebContext()) {
    const atomsElement = this.getAtomsElement(el);
    const script = 'return arguments[0].tagName.toLowerCase()';
    return await this.executeAtom('execute_script', [script, [atomsElement]]);
  }

  return await this.proxyCommand(`/element/${el}/name`, 'GET');
};

commands.getNativeAttribute = async function getNativeAttribute(attribute, el) {
  if (attribute === 'contentSize') {
    return await this.getContentSize(el);
  }

  el = _support.util.unwrapElement(el);
  let value = await this.proxyCommand(`/element/${el}/attribute/${attribute}`, 'GET');

  if ([0, 1].includes(value)) {
    value = !!value;
  }

  return _lodash.default.isNull(value) || _lodash.default.isString(value) ? value : JSON.stringify(value);
};

commands.getAttribute = async function getAttribute(attribute, el) {
  el = _support.util.unwrapElement(el);

  if (!this.isWebContext()) {
    return await this.getNativeAttribute(attribute, el);
  }

  const atomsElement = this.getAtomsElement(el);
  return await this.executeAtom('get_attribute_value', [atomsElement, attribute]);
};

commands.getProperty = async function getProperty(property, el) {
  el = _support.util.unwrapElement(el);

  if (!this.isWebContext()) {
    return await this.getNativeAttribute(property, el);
  }

  const atomsElement = this.getAtomsElement(el);
  return await this.executeAtom('get_attribute_value', [atomsElement, property]);
};

commands.getText = async function getText(el) {
  el = _support.util.unwrapElement(el);

  if (!this.isWebContext()) {
    return await this.proxyCommand(`/element/${el}/text`, 'GET');
  }

  let atomsElement = this.getAtomsElement(el);
  return await this.executeAtom('get_text', [atomsElement]);
};

commands.getElementRect = async function getElementRect(el) {
  if (this.isWebContext()) {
    const {
      x,
      y
    } = await this.getLocation(el);
    const {
      width,
      height
    } = await this.getSize(el);
    return {
      x,
      y,
      width,
      height
    };
  }

  el = _support.util.unwrapElement(el);
  return await this.getNativeRect(el);
};

extensions.getNativeRect = async function getNativeRect(el) {
  return await this.proxyCommand(`/element/${el}/rect`, 'GET');
};

commands.getLocation = async function getLocation(el) {
  el = _support.util.unwrapElement(el);

  if (this.isWebContext()) {
    const atomsElement = await this.getAtomsElement(el);
    let loc = await this.executeAtom('get_top_left_coordinates', [atomsElement]);

    if (this.opts.absoluteWebLocations) {
      const script = 'return [' + 'Math.max(window.pageXOffset,document.documentElement.scrollLeft,document.body.scrollLeft),' + 'Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)];';
      const [xOffset, yOffset] = await this.execute(script);
      loc.x += xOffset;
      loc.y += yOffset;
    }

    return loc;
  }

  const rect = await this.getElementRect(el);
  return {
    x: rect.x,
    y: rect.y
  };
};

commands.getLocationInView = async function getLocationInView(el) {
  return await this.getLocation(el);
};

commands.getSize = async function getSize(el) {
  el = _support.util.unwrapElement(el);

  if (this.isWebContext()) {
    return await this.executeAtom('get_size', [this.getAtomsElement(el)]);
  }

  const rect = await this.getElementRect(el);
  return {
    width: rect.width,
    height: rect.height
  };
};

function prepareInputValue(inp) {
  if (![_lodash.default.isArray, _lodash.default.isString, _lodash.default.isFinite].some(f => f(inp))) {
    throw new Error(`Only strings, numbers and arrays are supported as input arguments. ` + `Received: ${JSON.stringify(inp)}`);
  }

  if (_lodash.default.isArray(inp)) {
    inp = inp.join('');
  } else if (_lodash.default.isFinite(inp)) {
    inp = `${inp}`;
  }

  return [...inp].map(k => {
    if (['\uE006', '\uE007'].includes(k)) {
      return '\n';
    }

    if (['\uE003', '\ue017'].includes(k)) {
      return '\b';
    }

    return k;
  });
}

commands.setValueImmediate = async function setValueImmediate(value, el) {
  _logger.default.info('There is currently no way to bypass typing using XCUITest. Setting value through keyboard');

  await this.setValue(value, el);
};

commands.setValue = async function setValue(value, el) {
  el = _support.util.unwrapElement(el);

  if (!this.isWebContext()) {
    await this.proxyCommand(`/element/${el}/value`, 'POST', {
      value: prepareInputValue(value)
    });
    return;
  }

  const atomsElement = this.getAtomsElement(el);
  await this.executeAtom('click', [atomsElement]);
  await this.executeAtom('type', [atomsElement, value]);
};

commands.keys = async function keys(value) {
  await this.proxyCommand('/wda/keys', 'POST', {
    value: prepareInputValue(value)
  });
};

commands.clear = async function clear(el) {
  el = _support.util.unwrapElement(el);

  if (this.isWebContext()) {
    const atomsElement = this.getAtomsElement(el);
    await this.executeAtom('clear', [atomsElement]);
    return;
  }

  await this.proxyCommand(`/element/${el}/clear`, 'POST');
};

commands.getContentSize = async function getContentSize(el) {
  if (this.isWebContext()) {
    throw new _baseDriver.errors.NotYetImplementedError('Support for getContentSize for web context is not yet implemented. Please contact an Appium dev');
  }

  const type = await this.getAttribute('type', el);

  if (type !== 'XCUIElementTypeTable' && type !== 'XCUIElementTypeCollectionView') {
    throw new Error(`Can't get content size for type '${type}', only for ` + `tables and collection views`);
  }

  let locator = '*';

  if (type === 'XCUIElementTypeTable') {
    locator = 'XCUIElementTypeCell';
  }

  let contentHeight = 0;
  const children = await this.findElOrEls(`class chain`, locator, true, el);

  if (children.length === 1) {
    const rect = await this.getElementRect(_lodash.default.head(children));
    contentHeight = rect.height;
  } else if (children.length) {
    switch (type) {
      case 'XCUIElementTypeTable':
        {
          const firstRect = await this.getElementRect(_lodash.default.head(children));
          const lastRect = await this.getElementRect(_lodash.default.last(children));
          contentHeight = lastRect.y + lastRect.height - firstRect.y;
          break;
        }

      case 'XCUIElementTypeCollectionView':
        {
          let elsInRow = 1;
          let firstRect = await this.getElementRect(_lodash.default.head(children));
          let initialRects = [firstRect];

          for (let i = 1; i < children.length; i++) {
            const rect = await this.getElementRect(children[i]);
            initialRects.push(rect);

            if (rect.y !== firstRect.y) {
              elsInRow = i;
              break;
            }
          }

          const spaceBetweenEls = initialRects[elsInRow].y - initialRects[elsInRow - 1].y - initialRects[elsInRow - 1].height;
          const numRows = Math.ceil(children.length / elsInRow);
          contentHeight = numRows * firstRect.height + spaceBetweenEls * (numRows - 1);
          break;
        }

      default:
        throw new Error(`Programming error: type '${type}' was not ` + `valid but should have already been rejected`);
    }
  }

  const size = await this.getSize(el);
  const origin = await this.getLocationInView(el);
  return JSON.stringify({
    width: size.width,
    height: size.height,
    top: origin.y,
    left: origin.x,
    scrollableOffset: contentHeight
  });
};

commands.isKeyboardShown = async function isKeyboardShown() {
  try {
    await this.findNativeElementOrElements('class name', 'XCUIElementTypeKeyboard', false);
    return true;
  } catch (ign) {
    return false;
  }
};

Object.assign(extensions, commands);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiZXh0ZW5zaW9ucyIsImVsZW1lbnREaXNwbGF5ZWQiLCJlbCIsInV0aWwiLCJ1bndyYXBFbGVtZW50IiwiaXNXZWJDb250ZXh0IiwiYXRvbXNFbGVtZW50IiwiZ2V0QXRvbXNFbGVtZW50IiwiZXhlY3V0ZUF0b20iLCJwcm94eUNvbW1hbmQiLCJlbGVtZW50RW5hYmxlZCIsImVsZW1lbnRTZWxlY3RlZCIsImdldE5hbWUiLCJzY3JpcHQiLCJnZXROYXRpdmVBdHRyaWJ1dGUiLCJhdHRyaWJ1dGUiLCJnZXRDb250ZW50U2l6ZSIsInZhbHVlIiwiaW5jbHVkZXMiLCJfIiwiaXNOdWxsIiwiaXNTdHJpbmciLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0QXR0cmlidXRlIiwiZ2V0UHJvcGVydHkiLCJwcm9wZXJ0eSIsImdldFRleHQiLCJnZXRFbGVtZW50UmVjdCIsIngiLCJ5IiwiZ2V0TG9jYXRpb24iLCJ3aWR0aCIsImhlaWdodCIsImdldFNpemUiLCJnZXROYXRpdmVSZWN0IiwibG9jIiwib3B0cyIsImFic29sdXRlV2ViTG9jYXRpb25zIiwieE9mZnNldCIsInlPZmZzZXQiLCJleGVjdXRlIiwicmVjdCIsImdldExvY2F0aW9uSW5WaWV3IiwicHJlcGFyZUlucHV0VmFsdWUiLCJpbnAiLCJpc0FycmF5IiwiaXNGaW5pdGUiLCJzb21lIiwiZiIsIkVycm9yIiwiam9pbiIsIm1hcCIsImsiLCJzZXRWYWx1ZUltbWVkaWF0ZSIsImxvZyIsImluZm8iLCJzZXRWYWx1ZSIsImtleXMiLCJjbGVhciIsImVycm9ycyIsIk5vdFlldEltcGxlbWVudGVkRXJyb3IiLCJ0eXBlIiwibG9jYXRvciIsImNvbnRlbnRIZWlnaHQiLCJjaGlsZHJlbiIsImZpbmRFbE9yRWxzIiwibGVuZ3RoIiwiaGVhZCIsImZpcnN0UmVjdCIsImxhc3RSZWN0IiwibGFzdCIsImVsc0luUm93IiwiaW5pdGlhbFJlY3RzIiwiaSIsInB1c2giLCJzcGFjZUJldHdlZW5FbHMiLCJudW1Sb3dzIiwiTWF0aCIsImNlaWwiLCJzaXplIiwib3JpZ2luIiwidG9wIiwibGVmdCIsInNjcm9sbGFibGVPZmZzZXQiLCJpc0tleWJvYXJkU2hvd24iLCJmaW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMiLCJpZ24iLCJPYmplY3QiLCJhc3NpZ24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsUUFBUSxHQUFHLEVBQWpCO0FBQUEsTUFBcUJDLFVBQVUsR0FBRyxFQUFsQzs7O0FBRUFELFFBQVEsQ0FBQ0UsZ0JBQVQsR0FBNEIsZUFBZUEsZ0JBQWYsQ0FBaUNDLEVBQWpDLEVBQXFDO0FBQy9EQSxFQUFBQSxFQUFFLEdBQUdDLGNBQUtDLGFBQUwsQ0FBbUJGLEVBQW5CLENBQUw7O0FBQ0EsTUFBSSxLQUFLRyxZQUFMLEVBQUosRUFBeUI7QUFDdkIsVUFBTUMsWUFBWSxHQUFHLEtBQUtDLGVBQUwsQ0FBcUJMLEVBQXJCLENBQXJCO0FBQ0EsV0FBTyxNQUFNLEtBQUtNLFdBQUwsQ0FBaUIsY0FBakIsRUFBaUMsQ0FBQ0YsWUFBRCxDQUFqQyxDQUFiO0FBQ0Q7O0FBRUQsU0FBTyxNQUFNLEtBQUtHLFlBQUwsQ0FBbUIsWUFBV1AsRUFBRyxZQUFqQyxFQUE4QyxLQUE5QyxDQUFiO0FBQ0QsQ0FSRDs7QUFVQUgsUUFBUSxDQUFDVyxjQUFULEdBQTBCLGVBQWVBLGNBQWYsQ0FBK0JSLEVBQS9CLEVBQW1DO0FBQzNEQSxFQUFBQSxFQUFFLEdBQUdDLGNBQUtDLGFBQUwsQ0FBbUJGLEVBQW5CLENBQUw7O0FBQ0EsTUFBSSxLQUFLRyxZQUFMLEVBQUosRUFBeUI7QUFDdkIsVUFBTUMsWUFBWSxHQUFHLEtBQUtDLGVBQUwsQ0FBcUJMLEVBQXJCLENBQXJCO0FBQ0EsV0FBTyxNQUFNLEtBQUtNLFdBQUwsQ0FBaUIsWUFBakIsRUFBK0IsQ0FBQ0YsWUFBRCxDQUEvQixDQUFiO0FBQ0Q7O0FB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LEdBQWdDMkMsZUFBZSxJQUFJQyxPQUFPLEdBQUcsQ0FBZCxDQUEvRDtBQUNBO0FBQ0Q7O0FBQ0Q7QUFBUyxjQUFNLElBQUkzQixLQUFKLENBQVcsNEJBQTJCWSxJQUFLLFlBQWpDLEdBQ0MsNkNBRFgsQ0FBTjtBQTFCWDtBQTZCRDs7QUFDRCxRQUFNa0IsSUFBSSxHQUFHLE1BQU0sS0FBSzlDLE9BQUwsQ0FBYWhDLEVBQWIsQ0FBbkI7QUFDQSxRQUFNK0UsTUFBTSxHQUFHLE1BQU0sS0FBS3RDLGlCQUFMLENBQXVCekMsRUFBdkIsQ0FBckI7QUFFQSxTQUFPb0IsSUFBSSxDQUFDQyxTQUFMLENBQWU7QUFDcEJTLElBQUFBLEtBQUssRUFBRWdELElBQUksQ0FBQ2hELEtBRFE7QUFFcEJDLElBQUFBLE1BQU0sRUFBRStDLElBQUksQ0FBQy9DLE1BRk87QUFHcEJpRCxJQUFBQSxHQUFHLEVBQUVELE1BQU0sQ0FBQ25ELENBSFE7QUFJcEJxRCxJQUFBQSxJQUFJLEVBQUVGLE1BQU0sQ0FBQ3BELENBSk87QUFLcEJ1RCxJQUFBQSxnQkFBZ0IsRUFBRXBCO0FBTEUsR0FBZixDQUFQO0FBT0QsQ0FwRUQ7O0FBc0VBakUsUUFBUSxDQUFDc0YsZUFBVCxHQUEyQixlQUFlQSxlQUFmLEdBQWtDO0FBQzNELE1BQUk7QUFDRixVQUFNLEtBQUtDLDJCQUFMLENBQWlDLFlBQWpDLEVBQStDLHlCQUEvQyxFQUEwRSxLQUExRSxDQUFOO0FBQ0EsV0FBTyxJQUFQO0FBQ0QsR0FIRCxDQUdFLE9BQU9DLEdBQVAsRUFBWTtBQUNaLFdBQU8sS0FBUDtBQUNEO0FBQ0YsQ0FQRDs7QUFTQUMsTUFBTSxDQUFDQyxNQUFQLENBQWN6RixVQUFkLEVBQTBCRCxRQUExQjtlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGVycm9ycyB9IGZyb20gJ0BhcHBpdW0vYmFzZS1kcml2ZXInO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5cblxuY29uc3QgY29tbWFuZHMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5jb21tYW5kcy5lbGVtZW50RGlzcGxheWVkID0gYXN5bmMgZnVuY3Rpb24gZWxlbWVudERpc3BsYXllZCAoZWwpIHtcbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGNvbnN0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnaXNfZGlzcGxheWVkJywgW2F0b21zRWxlbWVudF0pO1xuICB9XG5cbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke2VsfS9kaXNwbGF5ZWRgLCAnR0VUJyk7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50RW5hYmxlZCA9IGFzeW5jIGZ1bmN0aW9uIGVsZW1lbnRFbmFibGVkIChlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgY29uc3QgYXRvbXNFbGVtZW50ID0gdGhpcy5nZXRBdG9tc0VsZW1lbnQoZWwpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdpc19lbmFibGVkJywgW2F0b21zRWxlbWVudF0pO1xuICB9XG5cbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke2VsfS9lbmFibGVkYCwgJ0dFVCcpO1xufTtcblxuY29tbWFuZHMuZWxlbWVudFNlbGVjdGVkID0gYXN5bmMgZnVuY3Rpb24gZWxlbWVudFNlbGVjdGVkIChlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgY29uc3QgYXRvbXNFbGVtZW50ID0gdGhpcy5nZXRBdG9tc0VsZW1lbnQoZWwpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdpc19zZWxlY3RlZCcsIFthdG9tc0VsZW1lbnRdKTtcbiAgfVxuXG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL2VsZW1lbnQvJHtlbH0vc2VsZWN0ZWRgLCAnR0VUJyk7XG59O1xuXG5jb21tYW5kcy5nZXROYW1lID0gYXN5bmMgZnVuY3Rpb24gZ2V0TmFtZSAoZWwpIHtcbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGNvbnN0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgICBjb25zdCBzY3JpcHQgPSAncmV0dXJuIGFyZ3VtZW50c1swXS50YWdOYW1lLnRvTG93ZXJDYXNlKCknO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdleGVjdXRlX3NjcmlwdCcsIFtzY3JpcHQsIFthdG9tc0VsZW1lbnRdXSk7XG4gIH1cblxuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7ZWx9L25hbWVgLCAnR0VUJyk7XG59O1xuXG5jb21tYW5kcy5nZXROYXRpdmVBdHRyaWJ1dGUgPSBhc3luYyBmdW5jdGlvbiBnZXROYXRpdmVBdHRyaWJ1dGUgKGF0dHJpYnV0ZSwgZWwpIHtcbiAgaWYgKGF0dHJpYnV0ZSA9PT0gJ2NvbnRlbnRTaXplJykge1xuICAgIC8vIGRvbid0IHByb3h5IHJlcXVlc3RzIGZvciB0aGUgY29udGVudCBzaXplIG9mIGEgc2Nyb2xsYWJsZSBlbGVtZW50XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0Q29udGVudFNpemUoZWwpO1xuICB9XG5cbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuXG4gIC8vIG90aGVyd2lzZSBsZXQgV0RBIGhhbmRsZSBhdHRyaWJ1dGUgcmVxdWVzdHNcbiAgbGV0IHZhbHVlID0gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7ZWx9L2F0dHJpYnV0ZS8ke2F0dHJpYnV0ZX1gLCAnR0VUJyk7XG4gIC8vIFRyYW5zZm9ybSB0aGUgcmVzdWx0IGZvciB0aGUgY2FzZSB3aGVuIFdEQSByZXR1cm5zIGFuIGludGVnZXIgcmVwcmVzZW50YXRpb24gZm9yIGEgYm9vbGVhbiB2YWx1ZVxuICBpZiAoWzAsIDFdLmluY2x1ZGVzKHZhbHVlKSkge1xuICAgIHZhbHVlID0gISF2YWx1ZTtcbiAgfVxuICAvLyBUaGUgcmV0dXJuZWQgdmFsdWUgbXVzdCBiZSBvZiB0eXBlIHN0cmluZyBhY2NvcmRpbmcgdG8gaHR0cHM6Ly93d3cudzMub3JnL1RSL3dlYmRyaXZlci8jZ2V0LWVsZW1lbnQtYXR0cmlidXRlXG4gIHJldHVybiAoXy5pc051bGwodmFsdWUpIHx8IF8uaXNTdHJpbmcodmFsdWUpKSA/IHZhbHVlIDogSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xufTtcblxuY29tbWFuZHMuZ2V0QXR0cmlidXRlID0gYXN5bmMgZnVuY3Rpb24gZ2V0QXR0cmlidXRlIChhdHRyaWJ1dGUsIGVsKSB7XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0TmF0aXZlQXR0cmlidXRlKGF0dHJpYnV0ZSwgZWwpO1xuICB9XG4gIGNvbnN0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF9hdHRyaWJ1dGVfdmFsdWUnLCBbYXRvbXNFbGVtZW50LCBhdHRyaWJ1dGVdKTtcbn07XG5cbmNvbW1hbmRzLmdldFByb3BlcnR5ID0gYXN5bmMgZnVuY3Rpb24gZ2V0UHJvcGVydHkgKHByb3BlcnR5LCBlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmdldE5hdGl2ZUF0dHJpYnV0ZShwcm9wZXJ0eSwgZWwpO1xuICB9XG4gIGNvbnN0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF9hdHRyaWJ1dGVfdmFsdWUnLCBbYXRvbXNFbGVtZW50LCBwcm9wZXJ0eV0pO1xufTtcblxuY29tbWFuZHMuZ2V0VGV4dCA9IGFzeW5jIGZ1bmN0aW9uIGdldFRleHQgKGVsKSB7XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke2VsfS90ZXh0YCwgJ0dFVCcpO1xuICB9XG4gIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLmdldEF0b21zRWxlbWVudChlbCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfdGV4dCcsIFthdG9tc0VsZW1lbnRdKTtcbn07XG5cbmNvbW1hbmRzLmdldEVsZW1lbnRSZWN0ID0gYXN5bmMgZnVuY3Rpb24gZ2V0RWxlbWVudFJlY3QgKGVsKSB7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgLy8gTW9iaWxlIHNhZmFyaSBkb2Vzbid0IHN1cHBvcnQgcmVjdFxuICAgIGNvbnN0IHt4LCB5fSA9IGF3YWl0IHRoaXMuZ2V0TG9jYXRpb24oZWwpO1xuICAgIGNvbnN0IHt3aWR0aCwgaGVpZ2h0fSA9IGF3YWl0IHRoaXMuZ2V0U2l6ZShlbCk7XG4gICAgcmV0dXJuIHt4LCB5LCB3aWR0aCwgaGVpZ2h0fTtcbiAgfVxuXG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0TmF0aXZlUmVjdChlbCk7XG59O1xuXG5leHRlbnNpb25zLmdldE5hdGl2ZVJlY3QgPSBhc3luYyBmdW5jdGlvbiBnZXROYXRpdmVSZWN0IChlbCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7ZWx9L3JlY3RgLCAnR0VUJyk7XG59O1xuXG5jb21tYW5kcy5nZXRMb2NhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIGdldExvY2F0aW9uIChlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgY29uc3QgYXRvbXNFbGVtZW50ID0gYXdhaXQgdGhpcy5nZXRBdG9tc0VsZW1lbnQoZWwpO1xuICAgIGxldCBsb2MgPSBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfdG9wX2xlZnRfY29vcmRpbmF0ZXMnLCBbYXRvbXNFbGVtZW50XSk7XG4gICAgaWYgKHRoaXMub3B0cy5hYnNvbHV0ZVdlYkxvY2F0aW9ucykge1xuICAgICAgY29uc3Qgc2NyaXB0ID0gJ3JldHVybiBbJyArXG4gICAgICAgICdNYXRoLm1heCh3aW5kb3cucGFnZVhPZmZzZXQsZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQsZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0KSwnICtcbiAgICAgICAgJ01hdGgubWF4KHdpbmRvdy5wYWdlWU9mZnNldCxkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wLGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKV07JztcbiAgICAgIGNvbnN0IFt4T2Zmc2V0LCB5T2Zmc2V0XSA9IGF3YWl0IHRoaXMuZXhlY3V0ZShzY3JpcHQpO1xuICAgICAgbG9jLnggKz0geE9mZnNldDtcbiAgICAgIGxvYy55ICs9IHlPZmZzZXQ7XG4gICAgfVxuICAgIHJldHVybiBsb2M7XG4gIH1cblxuICBjb25zdCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChlbCk7XG4gIHJldHVybiB7eDogcmVjdC54LCB5OiByZWN0Lnl9O1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb25JblZpZXcgPSBhc3luYyBmdW5jdGlvbiBnZXRMb2NhdGlvbkluVmlldyAoZWwpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0TG9jYXRpb24oZWwpO1xufTtcblxuY29tbWFuZHMuZ2V0U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIGdldFNpemUgKGVsKSB7XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X3NpemUnLCBbdGhpcy5nZXRBdG9tc0VsZW1lbnQoZWwpXSk7XG4gIH1cblxuICBjb25zdCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChlbCk7XG4gIHJldHVybiB7d2lkdGg6IHJlY3Qud2lkdGgsIGhlaWdodDogcmVjdC5oZWlnaHR9O1xufTtcblxuLyoqXG4gKiBQcmVwYXJlcyB0aGUgaW5wdXQgdmFsdWUgdG8gYmUgcGFzc2VkIGFzIGFuIGFyZ3VtZW50IHRvIFdEQS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xBcnJheTxzdHJpbmc+fG51bWJlcn0gaW5wIFRoZSBhY3R1YWwgdGV4dCB0byB0eXBlLlxuICogQWNjZXB0YWJsZSB2YWx1ZXMgb2YgYGlucGA6XG4gKiAgIFsnc29tZSB0ZXh0J11cbiAqICAgWydzJywgJ28nLCAnbScsICdlJywgJyAnLCAndCcsICdlJywgJ3gnLCAndCddXG4gKiAgICdzb21lIHRleHQnXG4gKiAgIDEyMzRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgdmFsdWUgaXMgbm90IGFjY2VwdGFibGUgZm9yIGlucHV0XG4gKiBAcmV0dXJucyB7QXJyYXk8c3RyaW5nPn0gVGhlIHByZXByb2Nlc3NlZCB2YWx1ZVxuICovXG5mdW5jdGlvbiBwcmVwYXJlSW5wdXRWYWx1ZSAoaW5wKSB7XG4gIGlmICghW18uaXNBcnJheSwgXy5pc1N0cmluZywgXy5pc0Zpbml0ZV0uc29tZSgoZikgPT4gZihpbnApKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgT25seSBzdHJpbmdzLCBudW1iZXJzIGFuZCBhcnJheXMgYXJlIHN1cHBvcnRlZCBhcyBpbnB1dCBhcmd1bWVudHMuIGAgK1xuICAgICAgYFJlY2VpdmVkOiAke0pTT04uc3RyaW5naWZ5KGlucCl9YCk7XG4gIH1cblxuICAvLyBtYWtlIGl0IGludG8gYSBzdHJpbmcsIHNvIHRoZW4gd2UgYXNzdXJlXG4gIC8vIHRoZSBhcnJheSBpdGVtcyBhcmUgc2luZ2xlIGNoYXJhY3RlcnNcbiAgaWYgKF8uaXNBcnJheShpbnApKSB7XG4gICAgaW5wID0gaW5wLmpvaW4oJycpO1xuICB9IGVsc2UgaWYgKF8uaXNGaW5pdGUoaW5wKSkge1xuICAgIGlucCA9IGAke2lucH1gO1xuICB9XG4gIC8vIFRoZSBgc3BsaXRgIG1ldGhvZCBtdXN0IG5vdCBiZSB1c2VkIG9uIHRoZSBzdHJpbmdcbiAgLy8gdG8gcHJvcGVybHkgaGFuZGxlIGFsbCBVbmljb2RlIGNvZGUgcG9pbnRzXG4gIHJldHVybiBbLi4uaW5wXS5tYXAoKGspID0+IHtcbiAgICBpZiAoWydcXHVFMDA2JywgJ1xcdUUwMDcnXS5pbmNsdWRlcyhrKSkgeyAvLyBSRVRVUk4gb3IgRU5URVJcbiAgICAgIHJldHVybiAnXFxuJztcbiAgICB9XG4gICAgaWYgKFsnXFx1RTAwMycsICdcXHVlMDE3J10uaW5jbHVkZXMoaykpIHsgLy8gQkFDS1NQQUNFIG9yIERFTEVURVxuICAgICAgcmV0dXJuICdcXGInO1xuICAgIH1cbiAgICByZXR1cm4gaztcbiAgfSk7XG59XG5cbmNvbW1hbmRzLnNldFZhbHVlSW1tZWRpYXRlID0gYXN5bmMgZnVuY3Rpb24gc2V0VmFsdWVJbW1lZGlhdGUgKHZhbHVlLCBlbCkge1xuICAvLyBXREEgZG9lcyBub3QgcHJvdmlkZSBubyB3YXkgdG8gc2V0IHRoZSB2YWx1ZSBkaXJlY3RseVxuICBsb2cuaW5mbygnVGhlcmUgaXMgY3VycmVudGx5IG5vIHdheSB0byBieXBhc3MgdHlwaW5nIHVzaW5nIFhDVUlUZXN0LiBTZXR0aW5nIHZhbHVlIHRocm91Z2gga2V5Ym9hcmQnKTtcbiAgYXdhaXQgdGhpcy5zZXRWYWx1ZSh2YWx1ZSwgZWwpO1xufTtcblxuY29tbWFuZHMuc2V0VmFsdWUgPSBhc3luYyBmdW5jdGlvbiBzZXRWYWx1ZSAodmFsdWUsIGVsKSB7XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7ZWx9L3ZhbHVlYCwgJ1BPU1QnLCB7XG4gICAgICB2YWx1ZTogcHJlcGFyZUlucHV0VmFsdWUodmFsdWUpLFxuICAgIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnY2xpY2snLCBbYXRvbXNFbGVtZW50XSk7XG4gIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ3R5cGUnLCBbYXRvbXNFbGVtZW50LCB2YWx1ZV0pO1xufTtcblxuY29tbWFuZHMua2V5cyA9IGFzeW5jIGZ1bmN0aW9uIGtleXMgKHZhbHVlKSB7XG4gIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL2tleXMnLCAnUE9TVCcsIHtcbiAgICB2YWx1ZTogcHJlcGFyZUlucHV0VmFsdWUodmFsdWUpLFxuICB9KTtcbn07XG5cbmNvbW1hbmRzLmNsZWFyID0gYXN5bmMgZnVuY3Rpb24gY2xlYXIgKGVsKSB7XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBjb25zdCBhdG9tc0VsZW1lbnQgPSB0aGlzLmdldEF0b21zRWxlbWVudChlbCk7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnY2xlYXInLCBbYXRvbXNFbGVtZW50XSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke2VsfS9jbGVhcmAsICdQT1NUJyk7XG59O1xuXG5jb21tYW5kcy5nZXRDb250ZW50U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIGdldENvbnRlbnRTaXplIChlbCkge1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90WWV0SW1wbGVtZW50ZWRFcnJvcignU3VwcG9ydCBmb3IgZ2V0Q29udGVudFNpemUgZm9yIHdlYiBjb250ZXh0IGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQuIFBsZWFzZSBjb250YWN0IGFuIEFwcGl1bSBkZXYnKTtcbiAgfVxuXG4gIGNvbnN0IHR5cGUgPSBhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZSgndHlwZScsIGVsKTtcblxuICBpZiAodHlwZSAhPT0gJ1hDVUlFbGVtZW50VHlwZVRhYmxlJyAmJlxuICAgICAgdHlwZSAhPT0gJ1hDVUlFbGVtZW50VHlwZUNvbGxlY3Rpb25WaWV3Jykge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgZ2V0IGNvbnRlbnQgc2l6ZSBmb3IgdHlwZSAnJHt0eXBlfScsIG9ubHkgZm9yIGAgK1xuICAgICAgICAgICAgICAgICAgICBgdGFibGVzIGFuZCBjb2xsZWN0aW9uIHZpZXdzYCk7XG4gIH1cbiAgbGV0IGxvY2F0b3IgPSAnKic7XG4gIGlmICh0eXBlID09PSAnWENVSUVsZW1lbnRUeXBlVGFibGUnKSB7XG4gICAgLy8gb25seSBmaW5kIHRhYmxlIGNlbGxzLCBub3QganVzdCBhbnkgY2hpbGRyZW5cbiAgICBsb2NhdG9yID0gJ1hDVUlFbGVtZW50VHlwZUNlbGwnO1xuICB9XG5cbiAgbGV0IGNvbnRlbnRIZWlnaHQgPSAwO1xuICBjb25zdCBjaGlsZHJlbiA9IGF3YWl0IHRoaXMuZmluZEVsT3JFbHMoYGNsYXNzIGNoYWluYCwgbG9jYXRvciwgdHJ1ZSwgZWwpO1xuICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAxKSB7XG4gICAgLy8gaWYgd2Uga25vdyB0aGVyZSdzIG9ubHkgb25lIGVsZW1lbnQsIHdlIGNhbiBvcHRpbWl6ZSB0byBtYWtlIGp1c3Qgb25lXG4gICAgLy8gY2FsbCB0byBXREFcbiAgICBjb25zdCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChfLmhlYWQoY2hpbGRyZW4pKTtcbiAgICBjb250ZW50SGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XG4gIH0gZWxzZSBpZiAoY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgLy8gb3RoZXJ3aXNlIGlmIHdlIGhhdmUgbXVsdGlwbGUgZWxlbWVudHMsIGxvZ2ljIGRpZmZlcnMgYmFzZWQgb24gZWxlbWVudFxuICAgIC8vIHR5cGVcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgJ1hDVUlFbGVtZW50VHlwZVRhYmxlJzoge1xuICAgICAgICBjb25zdCBmaXJzdFJlY3QgPSBhd2FpdCB0aGlzLmdldEVsZW1lbnRSZWN0KF8uaGVhZChjaGlsZHJlbikpO1xuICAgICAgICBjb25zdCBsYXN0UmVjdCA9IGF3YWl0IHRoaXMuZ2V0RWxlbWVudFJlY3QoXy5sYXN0KGNoaWxkcmVuKSk7XG4gICAgICAgIGNvbnRlbnRIZWlnaHQgPSBsYXN0UmVjdC55ICsgbGFzdFJlY3QuaGVpZ2h0IC0gZmlyc3RSZWN0Lnk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSAnWENVSUVsZW1lbnRUeXBlQ29sbGVjdGlvblZpZXcnOiB7XG4gICAgICAgIGxldCBlbHNJblJvdyA9IDE7IC8vIHdlIGtub3cgdGhlcmUgbXVzdCBiZSBhdCBsZWFzdCBvbmUgZWxlbWVudCBpbiB0aGUgcm93XG4gICAgICAgIGxldCBmaXJzdFJlY3QgPSBhd2FpdCB0aGlzLmdldEVsZW1lbnRSZWN0KF8uaGVhZChjaGlsZHJlbikpO1xuICAgICAgICBsZXQgaW5pdGlhbFJlY3RzID0gW2ZpcnN0UmVjdF07XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb25zdCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChjaGlsZHJlbltpXSk7XG4gICAgICAgICAgaW5pdGlhbFJlY3RzLnB1c2gocmVjdCk7XG4gICAgICAgICAgaWYgKHJlY3QueSAhPT0gZmlyc3RSZWN0LnkpIHtcbiAgICAgICAgICAgIGVsc0luUm93ID0gaTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzcGFjZUJldHdlZW5FbHMgPSBpbml0aWFsUmVjdHNbZWxzSW5Sb3ddLnkgLSBpbml0aWFsUmVjdHNbZWxzSW5Sb3cgLSAxXS55IC0gaW5pdGlhbFJlY3RzW2Vsc0luUm93IC0gMV0uaGVpZ2h0O1xuICAgICAgICBjb25zdCBudW1Sb3dzID0gTWF0aC5jZWlsKGNoaWxkcmVuLmxlbmd0aCAvIGVsc0luUm93KTtcblxuICAgICAgICAvLyBhc3N1bWUgYWxsIGNlbGxzIGFyZSB0aGUgc2FtZSBoZWlnaHRcbiAgICAgICAgY29udGVudEhlaWdodCA9IChudW1Sb3dzICogZmlyc3RSZWN0LmhlaWdodCkgKyAoc3BhY2VCZXR3ZWVuRWxzICogKG51bVJvd3MgLSAxKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKGBQcm9ncmFtbWluZyBlcnJvcjogdHlwZSAnJHt0eXBlfScgd2FzIG5vdCBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgdmFsaWQgYnV0IHNob3VsZCBoYXZlIGFscmVhZHkgYmVlbiByZWplY3RlZGApO1xuICAgIH1cbiAgfVxuICBjb25zdCBzaXplID0gYXdhaXQgdGhpcy5nZXRTaXplKGVsKTtcbiAgY29uc3Qgb3JpZ2luID0gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbkluVmlldyhlbCk7XG4gIC8vIGF0dHJpYnV0ZXMgaGF2ZSB0byBiZSBzdHJpbmdzLCBzbyBzdHJpbmdpZnkgdGhpcyB1cFxuICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoe1xuICAgIHdpZHRoOiBzaXplLndpZHRoLFxuICAgIGhlaWdodDogc2l6ZS5oZWlnaHQsXG4gICAgdG9wOiBvcmlnaW4ueSxcbiAgICBsZWZ0OiBvcmlnaW4ueCxcbiAgICBzY3JvbGxhYmxlT2Zmc2V0OiBjb250ZW50SGVpZ2h0XG4gIH0pO1xufTtcblxuY29tbWFuZHMuaXNLZXlib2FyZFNob3duID0gYXN5bmMgZnVuY3Rpb24gaXNLZXlib2FyZFNob3duICgpIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cygnY2xhc3MgbmFtZScsICdYQ1VJRWxlbWVudFR5cGVLZXlib2FyZCcsIGZhbHNlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoaWduKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzKTtcbmV4cG9ydCB7IGNvbW1hbmRzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvZWxlbWVudC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
