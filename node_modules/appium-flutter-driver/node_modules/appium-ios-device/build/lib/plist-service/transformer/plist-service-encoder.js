"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.PlistServiceEncoder = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _support = require("@appium/support");

const HEADER_LENGTH = 4;

class PlistServiceEncoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, onData) {
    this.push(this._encode(data), 'buffer');
    onData();
  }

  _encode(data) {
    let payloadBuffer = _support.plist.createBinaryPlist(data);

    const headerBuffer = Buffer.alloc(HEADER_LENGTH);
    headerBuffer.writeUInt32BE(payloadBuffer.length, 0);
    return Buffer.concat([headerBuffer, payloadBuffer], headerBuffer.length + payloadBuffer.length);
  }

}

exports.PlistServiceEncoder = PlistServiceEncoder;
var _default = PlistServiceEncoder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9wbGlzdC1zZXJ2aWNlL3RyYW5zZm9ybWVyL3BsaXN0LXNlcnZpY2UtZW5jb2Rlci5qcyJdLCJuYW1lcyI6WyJIRUFERVJfTEVOR1RIIiwiUGxpc3RTZXJ2aWNlRW5jb2RlciIsIlN0cmVhbSIsIlRyYW5zZm9ybSIsImNvbnN0cnVjdG9yIiwib2JqZWN0TW9kZSIsIl90cmFuc2Zvcm0iLCJkYXRhIiwiZW5jb2RpbmciLCJvbkRhdGEiLCJwdXNoIiwiX2VuY29kZSIsInBheWxvYWRCdWZmZXIiLCJwbGlzdCIsImNyZWF0ZUJpbmFyeVBsaXN0IiwiaGVhZGVyQnVmZmVyIiwiQnVmZmVyIiwiYWxsb2MiLCJ3cml0ZVVJbnQzMkJFIiwibGVuZ3RoIiwiY29uY2F0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUdBLE1BQU1BLGFBQWEsR0FBRyxDQUF0Qjs7QUFFQSxNQUFNQyxtQkFBTixTQUFrQ0MsZ0JBQU9DLFNBQXpDLENBQW1EO0FBQ2pEQyxFQUFBQSxXQUFXLEdBQUk7QUFDYixVQUFNO0FBQUVDLE1BQUFBLFVBQVUsRUFBRTtBQUFkLEtBQU47QUFDRDs7QUFFREMsRUFBQUEsVUFBVSxDQUFFQyxJQUFGLEVBQVFDLFFBQVIsRUFBa0JDLE1BQWxCLEVBQTBCO0FBQ2xDLFNBQUtDLElBQUwsQ0FBVSxLQUFLQyxPQUFMLENBQWFKLElBQWIsQ0FBVixFQUE4QixRQUE5QjtBQUNBRSxJQUFBQSxNQUFNO0FBQ1A7O0FBRURFLEVBQUFBLE9BQU8sQ0FBRUosSUFBRixFQUFRO0FBQ2IsUUFBSUssYUFBYSxHQUFHQyxlQUFNQyxpQkFBTixDQUF3QlAsSUFBeEIsQ0FBcEI7O0FBQ0EsVUFBTVEsWUFBWSxHQUFHQyxNQUFNLENBQUNDLEtBQVAsQ0FBYWpCLGFBQWIsQ0FBckI7QUFDQWUsSUFBQUEsWUFBWSxDQUFDRyxhQUFiLENBQTJCTixhQUFhLENBQUNPLE1BQXpDLEVBQWlELENBQWpEO0FBQ0EsV0FBT0gsTUFBTSxDQUFDSSxNQUFQLENBQWMsQ0FBQ0wsWUFBRCxFQUFlSCxhQUFmLENBQWQsRUFBNkNHLFlBQVksQ0FBQ0ksTUFBYixHQUFzQlAsYUFBYSxDQUFDTyxNQUFqRixDQUFQO0FBQ0Q7O0FBZmdEOzs7ZUFtQnBDbEIsbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3RyZWFtIGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQgeyBwbGlzdCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5cblxuY29uc3QgSEVBREVSX0xFTkdUSCA9IDQ7XG5cbmNsYXNzIFBsaXN0U2VydmljZUVuY29kZXIgZXh0ZW5kcyBTdHJlYW0uVHJhbnNmb3JtIHtcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKHsgb2JqZWN0TW9kZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIF90cmFuc2Zvcm0gKGRhdGEsIGVuY29kaW5nLCBvbkRhdGEpIHtcbiAgICB0aGlzLnB1c2godGhpcy5fZW5jb2RlKGRhdGEpLCAnYnVmZmVyJyk7XG4gICAgb25EYXRhKCk7XG4gIH1cblxuICBfZW5jb2RlIChkYXRhKSB7XG4gICAgbGV0IHBheWxvYWRCdWZmZXIgPSBwbGlzdC5jcmVhdGVCaW5hcnlQbGlzdChkYXRhKTtcbiAgICBjb25zdCBoZWFkZXJCdWZmZXIgPSBCdWZmZXIuYWxsb2MoSEVBREVSX0xFTkdUSCk7XG4gICAgaGVhZGVyQnVmZmVyLndyaXRlVUludDMyQkUocGF5bG9hZEJ1ZmZlci5sZW5ndGgsIDApO1xuICAgIHJldHVybiBCdWZmZXIuY29uY2F0KFtoZWFkZXJCdWZmZXIsIHBheWxvYWRCdWZmZXJdLCBoZWFkZXJCdWZmZXIubGVuZ3RoICsgcGF5bG9hZEJ1ZmZlci5sZW5ndGgpO1xuICB9XG59XG5cbmV4cG9ydCB7IFBsaXN0U2VydmljZUVuY29kZXIgfTtcbmV4cG9ydCBkZWZhdWx0IFBsaXN0U2VydmljZUVuY29kZXI7XG4iXSwiZmlsZSI6ImxpYi9wbGlzdC1zZXJ2aWNlL3RyYW5zZm9ybWVyL3BsaXN0LXNlcnZpY2UtZW5jb2Rlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLiJ9
