"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.helpers = exports.default = exports.commands = void 0;

require("source-map-support/register");

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _support = require("@appium/support");

var _path = _interopRequireDefault(require("path"));

var _logger = _interopRequireDefault(require("../logger"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _jimp = _interopRequireDefault(require("jimp"));

var _teen_process = require("teen_process");

const swipeStepsPerSec = 28;
const dragStepsPerSec = 40;
let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.keyevent = async function keyevent(keycode, metastate = null) {
  _logger.default.warn('keyevent will be deprecated use pressKeyCode');

  return await this.pressKeyCode(keycode, metastate);
};

commands.pressKeyCode = async function pressKeyCode(keycode, metastate = null) {
  return await this.bootstrap.sendAction('pressKeyCode', {
    keycode,
    metastate
  });
};

commands.longPressKeyCode = async function longPressKeyCode(keycode, metastate = null) {
  return await this.bootstrap.sendAction('longPressKeyCode', {
    keycode,
    metastate
  });
};

commands.getOrientation = async function getOrientation() {
  let params = {
    naturalOrientation: !!this.opts.androidNaturalOrientation
  };
  let orientation = await this.bootstrap.sendAction('orientation', params);
  return orientation.toUpperCase();
};

commands.setOrientation = async function setOrientation(orientation) {
  orientation = orientation.toUpperCase();
  let params = {
    orientation,
    naturalOrientation: !!this.opts.androidNaturalOrientation
  };
  return await this.bootstrap.sendAction('orientation', params);
};

commands.fakeFlick = async function fakeFlick(xSpeed, ySpeed) {
  return await this.bootstrap.sendAction('flick', {
    xSpeed,
    ySpeed
  });
};

commands.fakeFlickElement = async function fakeFlickElement(elementId, xoffset, yoffset, speed) {
  let params = {
    xoffset,
    yoffset,
    speed,
    elementId
  };
  return await this.bootstrap.sendAction('element:flick', params);
};

commands.swipe = async function swipe(startX, startY, endX, endY, duration, touchCount, elId) {
  if (startX === 'null') {
    startX = 0.5;
  }

  if (startY === 'null') {
    startY = 0.5;
  }

  let swipeOpts = {
    startX,
    startY,
    endX,
    endY,
    steps: Math.round(duration * swipeStepsPerSec)
  };

  if (_support.util.hasValue(elId)) {
    swipeOpts.elementId = elId;
  }

  return await this.doSwipe(swipeOpts);
};

commands.doSwipe = async function doSwipe(swipeOpts) {
  if (_support.util.hasValue(swipeOpts.elementId)) {
    return await this.bootstrap.sendAction('element:swipe', swipeOpts);
  } else {
    return await this.bootstrap.sendAction('swipe', swipeOpts);
  }
};

commands.pinchClose = async function pinchClose(startX, startY, endX, endY, duration, percent, steps, elId) {
  let pinchOpts = {
    direction: 'in',
    elementId: elId,
    percent,
    steps
  };
  return await this.bootstrap.sendAction('element:pinch', pinchOpts);
};

commands.pinchOpen = async function pinchOpen(startX, startY, endX, endY, duration, percent, steps, elId) {
  let pinchOpts = {
    direction: 'out',
    elementId: elId,
    percent,
    steps
  };
  return await this.bootstrap.sendAction('element:pinch', pinchOpts);
};

commands.flick = async function flick(element, xSpeed, ySpeed, xOffset, yOffset, speed) {
  if (element) {
    await this.fakeFlickElement(element, xOffset, yOffset, speed);
  } else {
    await this.fakeFlick(xSpeed, ySpeed);
  }
};

commands.drag = async function drag(startX, startY, endX, endY, duration, touchCount, elementId, destElId) {
  let dragOpts = {
    elementId,
    destElId,
    startX,
    startY,
    endX,
    endY,
    steps: Math.round(duration * dragStepsPerSec)
  };
  return await this.doDrag(dragOpts);
};

commands.doDrag = async function doDrag(dragOpts) {
  if (_support.util.hasValue(dragOpts.elementId)) {
    return await this.bootstrap.sendAction('element:drag', dragOpts);
  } else {
    return await this.bootstrap.sendAction('drag', dragOpts);
  }
};

commands.lock = async function lock(seconds) {
  await this.adb.lock();

  if (isNaN(seconds)) {
    return;
  }

  const floatSeconds = parseFloat(seconds);

  if (floatSeconds <= 0) {
    return;
  }

  await _bluebird.default.delay(1000 * floatSeconds);
  await this.unlock();
};

commands.isLocked = async function isLocked() {
  return await this.adb.isScreenLocked();
};

commands.unlock = async function unlock() {
  return await _androidHelpers.default.unlock(this, this.adb, this.caps);
};

commands.openNotifications = async function openNotifications() {
  return await this.bootstrap.sendAction('openNotification');
};

commands.setLocation = async function setLocation(latitude, longitude) {
  return await this.adb.sendTelnetCommand(`geo fix ${longitude} ${latitude}`);
};

commands.fingerprint = async function fingerprint(fingerprintId) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('fingerprint method is only available for emulators');
  }

  await this.adb.fingerprint(fingerprintId);
};

commands.sendSMS = async function sendSMS(phoneNumber, message) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('sendSMS method is only available for emulators');
  }

  await this.adb.sendSMS(phoneNumber, message);
};

commands.gsmCall = async function gsmCall(phoneNumber, action) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('gsmCall method is only available for emulators');
  }

  await this.adb.gsmCall(phoneNumber, action);
};

commands.gsmSignal = async function gsmSignal(signalStrengh) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('gsmSignal method is only available for emulators');
  }

  await this.adb.gsmSignal(signalStrengh);
};

commands.gsmVoice = async function gsmVoice(state) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('gsmVoice method is only available for emulators');
  }

  await this.adb.gsmVoice(state);
};

commands.powerAC = async function powerAC(state) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('powerAC method is only available for emulators');
  }

  await this.adb.powerAC(state);
};

commands.powerCapacity = async function powerCapacity(batteryPercent) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('powerCapacity method is only available for emulators');
  }

  await this.adb.powerCapacity(batteryPercent);
};

commands.networkSpeed = async function networkSpeed(networkSpeed) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('networkSpeed method is only available for emulators');
  }

  await this.adb.networkSpeed(networkSpeed);
};

commands.sensorSet = async function sensorSet(sensor = {}) {
  const {
    sensorType,
    value
  } = sensor;

  if (!_support.util.hasValue(sensorType)) {
    _logger.default.errorAndThrow(`'sensorType' argument is required`);
  }

  if (!_support.util.hasValue(value)) {
    _logger.default.errorAndThrow(`'value' argument is required`);
  }

  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('sensorSet method is only available for emulators');
  }

  await this.adb.sensorSet(sensorType, value);
};

helpers.getScreenshotDataWithAdbShell = async function getScreenshotDataWithAdbShell(adb, opts) {
  const localFile = await _support.tempDir.path({
    prefix: 'appium',
    suffix: '.png'
  });

  if (await _support.fs.exists(localFile)) {
    await _support.fs.unlink(localFile);
  }

  try {
    const pngDir = opts.androidScreenshotPath || '/data/local/tmp/';

    const png = _path.default.posix.resolve(pngDir, 'screenshot.png');

    const cmd = ['/system/bin/rm', `${png};`, '/system/bin/screencap', '-p', png];
    await adb.shell(cmd);

    if (!(await adb.fileSize(png))) {
      throw new Error('The size of the taken screenshot equals to zero.');
    }

    await adb.pull(png, localFile);
    return await _jimp.default.read(localFile);
  } finally {
    if (await _support.fs.exists(localFile)) {
      await _support.fs.unlink(localFile);
    }
  }
};

helpers.getScreenshotDataWithAdbExecOut = async function getScreenshotDataWithAdbExecOut(adb) {
  let {
    stdout,
    stderr,
    code
  } = await (0, _teen_process.exec)(adb.executable.path, adb.executable.defaultArgs.concat(['exec-out', '/system/bin/screencap', '-p']), {
    encoding: 'binary',
    isBuffer: true
  });

  if (code || stderr.length) {
    throw new Error(`Screenshot returned error, code: '${code}', stderr: '${stderr.toString()}'`);
  }

  if (!stdout.length) {
    throw new Error('Screenshot returned no data');
  }

  return await _jimp.default.read(stdout);
};

commands.getScreenshot = async function getScreenshot() {
  const apiLevel = await this.adb.getApiLevel();
  let image = null;

  if (apiLevel > 20) {
    try {
      image = await this.getScreenshotDataWithAdbExecOut(this.adb);
    } catch (e) {
      _logger.default.info(`Cannot get screenshot data with 'adb exec-out' because of '${e.message}'. ` + `Defaulting to 'adb shell' call`);
    }
  }

  if (!image) {
    try {
      image = await this.getScreenshotDataWithAdbShell(this.adb, this.opts);
    } catch (e) {
      const err = `Cannot get screenshot data because of '${e.message}'. ` + `Make sure the 'LayoutParams.FLAG_SECURE' is not set for ` + `the current view`;

      _logger.default.errorAndThrow(err);
    }
  }

  if (apiLevel < 23) {
    let screenOrientation = await this.adb.getScreenOrientation();

    try {
      image = await image.rotate(-90 * screenOrientation);
    } catch (err) {
      _logger.default.warn(`Could not rotate screenshot due to error: ${err}`);
    }
  }

  const getBuffer = _bluebird.default.promisify(image.getBuffer, {
    context: image
  });

  const imgBuffer = await getBuffer(_jimp.default.MIME_PNG);
  return imgBuffer.toString('base64');
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9hY3Rpb25zLmpzIl0sIm5hbWVzIjpbInN3aXBlU3RlcHNQZXJTZWMiLCJkcmFnU3RlcHNQZXJTZWMiLCJjb21tYW5kcyIsImhlbHBlcnMiLCJleHRlbnNpb25zIiwia2V5ZXZlbnQiLCJrZXljb2RlIiwibWV0YXN0YXRlIiwibG9nIiwid2FybiIsInByZXNzS2V5Q29kZSIsImJvb3RzdHJhcCIsInNlbmRBY3Rpb24iLCJsb25nUHJlc3NLZXlDb2RlIiwiZ2V0T3JpZW50YXRpb24iLCJwYXJhbXMiLCJuYXR1cmFsT3JpZW50YXRpb24iLCJvcHRzIiwiYW5kcm9pZE5hdHVyYWxPcmllbnRhdGlvbiIsIm9yaWVudGF0aW9uIiwidG9VcHBlckNhc2UiLCJzZXRPcmllbnRhdGlvbiIsImZha2VGbGljayIsInhTcGVlZCIsInlTcGVlZCIsImZha2VGbGlja0VsZW1lbnQiLCJlbGVtZW50SWQiLCJ4b2Zmc2V0IiwieW9mZnNldCIsInNwZWVkIiwic3dpcGUiLCJzdGFydFgiLCJzdGFydFkiLCJlbmRYIiwiZW5kWSIsImR1cmF0aW9uIiwidG91Y2hDb3VudCIsImVsSWQiLCJzd2lwZU9wdHMiLCJzdGVwcyIsIk1hdGgiLCJyb3VuZCIsInV0aWwiLCJoYXNWYWx1ZSIsImRvU3dpcGUiLCJwaW5jaENsb3NlIiwicGVyY2VudCIsInBpbmNoT3B0cyIsImRpcmVjdGlvbiIsInBpbmNoT3BlbiIsImZsaWNrIiwiZWxlbWVudCIsInhPZmZzZXQiLCJ5T2Zmc2V0IiwiZHJhZyIsImRlc3RFbElkIiwiZHJhZ09wdHMiLCJkb0RyYWciLCJsb2NrIiwic2Vjb25kcyIsImFkYiIsImlzTmFOIiwiZmxvYXRTZWNvbmRzIiwicGFyc2VGbG9hdCIsIkIiLCJkZWxheSIsInVubG9jayIsImlzTG9ja2VkIiwiaXNTY3JlZW5Mb2NrZWQiLCJhbmRyb2lkSGVscGVycyIsImNhcHMiLCJvcGVuTm90aWZpY2F0aW9ucyIsInNldExvY2F0aW9uIiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJzZW5kVGVsbmV0Q29tbWFuZCIsImZpbmdlcnByaW50IiwiZmluZ2VycHJpbnRJZCIsImlzRW11bGF0b3IiLCJlcnJvckFuZFRocm93Iiwic2VuZFNNUyIsInBob25lTnVtYmVyIiwibWVzc2FnZSIsImdzbUNhbGwiLCJhY3Rpb24iLCJnc21TaWduYWwiLCJzaWduYWxTdHJlbmdoIiwiZ3NtVm9pY2UiLCJzdGF0ZSIsInBvd2VyQUMiLCJwb3dlckNhcGFjaXR5IiwiYmF0dGVyeVBlcmNlbnQiLCJuZXR3b3JrU3BlZWQiLCJzZW5zb3JTZXQiLCJzZW5zb3IiLCJzZW5zb3JUeXBlIiwidmFsdWUiLCJnZXRTY3JlZW5zaG90RGF0YVdpdGhBZGJTaGVsbCIsImxvY2FsRmlsZSIsInRlbXBEaXIiLCJwYXRoIiwicHJlZml4Iiwic3VmZml4IiwiZnMiLCJleGlzdHMiLCJ1bmxpbmsiLCJwbmdEaXIiLCJhbmRyb2lkU2NyZWVuc2hvdFBhdGgiLCJwbmciLCJwb3NpeCIsInJlc29sdmUiLCJjbWQiLCJzaGVsbCIsImZpbGVTaXplIiwiRXJyb3IiLCJwdWxsIiwiamltcCIsInJlYWQiLCJnZXRTY3JlZW5zaG90RGF0YVdpdGhBZGJFeGVjT3V0Iiwic3Rkb3V0Iiwic3RkZXJyIiwiY29kZSIsImV4ZWN1dGFibGUiLCJkZWZhdWx0QXJncyIsImNvbmNhdCIsImVuY29kaW5nIiwiaXNCdWZmZXIiLCJsZW5ndGgiLCJ0b1N0cmluZyIsImdldFNjcmVlbnNob3QiLCJhcGlMZXZlbCIsImdldEFwaUxldmVsIiwiaW1hZ2UiLCJlIiwiaW5mbyIsImVyciIsInNjcmVlbk9yaWVudGF0aW9uIiwiZ2V0U2NyZWVuT3JpZW50YXRpb24iLCJyb3RhdGUiLCJnZXRCdWZmZXIiLCJwcm9taXNpZnkiLCJjb250ZXh0IiwiaW1nQnVmZmVyIiwiTUlNRV9QTkciLCJPYmplY3QiLCJhc3NpZ24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FB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TUFBUCxDQUFjN0ksVUFBZCxFQUEwQkYsUUFBMUIsRUFBb0NDLE9BQXBDO2VBRWVDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5kcm9pZEhlbHBlcnMgZnJvbSAnLi4vYW5kcm9pZC1oZWxwZXJzJztcbmltcG9ydCB7IGZzLCB1dGlsLCB0ZW1wRGlyfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgamltcCBmcm9tICdqaW1wJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuXG5jb25zdCBzd2lwZVN0ZXBzUGVyU2VjID0gMjg7XG5jb25zdCBkcmFnU3RlcHNQZXJTZWMgPSA0MDtcblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5jb21tYW5kcy5rZXlldmVudCA9IGFzeW5jIGZ1bmN0aW9uIGtleWV2ZW50IChrZXljb2RlLCBtZXRhc3RhdGUgPSBudWxsKSB7XG4gIC8vIFRPRE8gZGVwcmVjYXRlIGtleWV2ZW50OyBjdXJyZW50bHkgd2Qgb25seSBpbXBsZW1lbnRzIGtleWV2ZW50XG4gIGxvZy53YXJuKCdrZXlldmVudCB3aWxsIGJlIGRlcHJlY2F0ZWQgdXNlIHByZXNzS2V5Q29kZScpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcmVzc0tleUNvZGUoa2V5Y29kZSwgbWV0YXN0YXRlKTtcbn07XG5cbmNvbW1hbmRzLnByZXNzS2V5Q29kZSA9IGFzeW5jIGZ1bmN0aW9uIHByZXNzS2V5Q29kZSAoa2V5Y29kZSwgbWV0YXN0YXRlID0gbnVsbCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbigncHJlc3NLZXlDb2RlJywge2tleWNvZGUsIG1ldGFzdGF0ZX0pO1xufTtcblxuY29tbWFuZHMubG9uZ1ByZXNzS2V5Q29kZSA9IGFzeW5jIGZ1bmN0aW9uIGxvbmdQcmVzc0tleUNvZGUgKGtleWNvZGUsIG1ldGFzdGF0ZSA9IG51bGwpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2xvbmdQcmVzc0tleUNvZGUnLCB7a2V5Y29kZSwgbWV0YXN0YXRlfSk7XG59O1xuXG5jb21tYW5kcy5nZXRPcmllbnRhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIGdldE9yaWVudGF0aW9uICgpIHtcbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBuYXR1cmFsT3JpZW50YXRpb246ICEhdGhpcy5vcHRzLmFuZHJvaWROYXR1cmFsT3JpZW50YXRpb24sXG4gIH07XG4gIGxldCBvcmllbnRhdGlvbiA9IGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ29yaWVudGF0aW9uJywgcGFyYW1zKTtcbiAgcmV0dXJuIG9yaWVudGF0aW9uLnRvVXBwZXJDYXNlKCk7XG59O1xuXG5jb21tYW5kcy5zZXRPcmllbnRhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIHNldE9yaWVudGF0aW9uIChvcmllbnRhdGlvbikge1xuICBvcmllbnRhdGlvbiA9IG9yaWVudGF0aW9uLnRvVXBwZXJDYXNlKCk7XG4gIGxldCBwYXJhbXMgPSB7XG4gICAgb3JpZW50YXRpb24sXG4gICAgbmF0dXJhbE9yaWVudGF0aW9uOiAhIXRoaXMub3B0cy5hbmRyb2lkTmF0dXJhbE9yaWVudGF0aW9uLFxuICB9O1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignb3JpZW50YXRpb24nLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMuZmFrZUZsaWNrID0gYXN5bmMgZnVuY3Rpb24gZmFrZUZsaWNrICh4U3BlZWQsIHlTcGVlZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZmxpY2snLCB7eFNwZWVkLCB5U3BlZWR9KTtcbn07XG5cbmNvbW1hbmRzLmZha2VGbGlja0VsZW1lbnQgPSBhc3luYyBmdW5jdGlvbiBmYWtlRmxpY2tFbGVtZW50IChlbGVtZW50SWQsIHhvZmZzZXQsIHlvZmZzZXQsIHNwZWVkKSB7XG4gIGxldCBwYXJhbXMgPSB7eG9mZnNldCwgeW9mZnNldCwgc3BlZWQsIGVsZW1lbnRJZH07XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdlbGVtZW50OmZsaWNrJywgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnN3aXBlID0gYXN5bmMgZnVuY3Rpb24gc3dpcGUgKHN0YXJ0WCwgc3RhcnRZLCBlbmRYLCBlbmRZLCBkdXJhdGlvbiwgdG91Y2hDb3VudCwgZWxJZCkge1xuICBpZiAoc3RhcnRYID09PSAnbnVsbCcpIHtcbiAgICBzdGFydFggPSAwLjU7XG4gIH1cbiAgaWYgKHN0YXJ0WSA9PT0gJ251bGwnKSB7XG4gICAgc3RhcnRZID0gMC41O1xuICB9XG4gIGxldCBzd2lwZU9wdHMgPSB7c3RhcnRYLCBzdGFydFksIGVuZFgsIGVuZFksXG4gICAgICAgICAgICAgICAgICAgc3RlcHM6IE1hdGgucm91bmQoZHVyYXRpb24gKiBzd2lwZVN0ZXBzUGVyU2VjKX07XG4gIC8vIGdvaW5nIHRoZSBsb25nIHdheSBhbmQgY2hlY2tpbmcgZm9yIHVuZGVmaW5lZCBhbmQgbnVsbCBzaW5jZVxuICAvLyB3ZSBjYW4ndCBiZSBhc3N1cmVkIGBlbElkYCBpcyBhIHN0cmluZyBhbmQgbm90IGFuIGludFxuICBpZiAodXRpbC5oYXNWYWx1ZShlbElkKSkge1xuICAgIHN3aXBlT3B0cy5lbGVtZW50SWQgPSBlbElkO1xuICB9XG4gIHJldHVybiBhd2FpdCB0aGlzLmRvU3dpcGUoc3dpcGVPcHRzKTtcbn07XG5cbmNvbW1hbmRzLmRvU3dpcGUgPSBhc3luYyBmdW5jdGlvbiBkb1N3aXBlIChzd2lwZU9wdHMpIHtcbiAgaWYgKHV0aWwuaGFzVmFsdWUoc3dpcGVPcHRzLmVsZW1lbnRJZCkpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpzd2lwZScsIHN3aXBlT3B0cyk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3N3aXBlJywgc3dpcGVPcHRzKTtcbiAgfVxufTtcblxuY29tbWFuZHMucGluY2hDbG9zZSA9IGFzeW5jIGZ1bmN0aW9uIHBpbmNoQ2xvc2UgKHN0YXJ0WCwgc3RhcnRZLCBlbmRYLCBlbmRZLCBkdXJhdGlvbiwgcGVyY2VudCwgc3RlcHMsIGVsSWQpIHtcbiAgbGV0IHBpbmNoT3B0cyA9IHtcbiAgICBkaXJlY3Rpb246ICdpbicsXG4gICAgZWxlbWVudElkOiBlbElkLFxuICAgIHBlcmNlbnQsXG4gICAgc3RlcHNcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6cGluY2gnLCBwaW5jaE9wdHMpO1xufTtcblxuY29tbWFuZHMucGluY2hPcGVuID0gYXN5bmMgZnVuY3Rpb24gcGluY2hPcGVuIChzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSwgZHVyYXRpb24sIHBlcmNlbnQsIHN0ZXBzLCBlbElkKSB7XG4gIGxldCBwaW5jaE9wdHMgPSB7ZGlyZWN0aW9uOiAnb3V0JywgZWxlbWVudElkOiBlbElkLCBwZXJjZW50LCBzdGVwc307XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdlbGVtZW50OnBpbmNoJywgcGluY2hPcHRzKTtcbn07XG5cbmNvbW1hbmRzLmZsaWNrID0gYXN5bmMgZnVuY3Rpb24gZmxpY2sgKGVsZW1lbnQsIHhTcGVlZCwgeVNwZWVkLCB4T2Zmc2V0LCB5T2Zmc2V0LCBzcGVlZCkge1xuICBpZiAoZWxlbWVudCkge1xuICAgIGF3YWl0IHRoaXMuZmFrZUZsaWNrRWxlbWVudChlbGVtZW50LCB4T2Zmc2V0LCB5T2Zmc2V0LCBzcGVlZCk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgdGhpcy5mYWtlRmxpY2soeFNwZWVkLCB5U3BlZWQpO1xuICB9XG59O1xuXG5jb21tYW5kcy5kcmFnID0gYXN5bmMgZnVuY3Rpb24gZHJhZyAoc3RhcnRYLCBzdGFydFksIGVuZFgsIGVuZFksIGR1cmF0aW9uLCB0b3VjaENvdW50LCBlbGVtZW50SWQsIGRlc3RFbElkKSB7XG4gIGxldCBkcmFnT3B0cyA9IHtcbiAgICBlbGVtZW50SWQsIGRlc3RFbElkLCBzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSxcbiAgICBzdGVwczogTWF0aC5yb3VuZChkdXJhdGlvbiAqIGRyYWdTdGVwc1BlclNlYylcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZG9EcmFnKGRyYWdPcHRzKTtcblxufTtcblxuY29tbWFuZHMuZG9EcmFnID0gYXN5bmMgZnVuY3Rpb24gZG9EcmFnIChkcmFnT3B0cykge1xuICBpZiAodXRpbC5oYXNWYWx1ZShkcmFnT3B0cy5lbGVtZW50SWQpKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6ZHJhZycsIGRyYWdPcHRzKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZHJhZycsIGRyYWdPcHRzKTtcbiAgfVxufTtcblxuY29tbWFuZHMubG9jayA9IGFzeW5jIGZ1bmN0aW9uIGxvY2sgKHNlY29uZHMpIHtcbiAgYXdhaXQgdGhpcy5hZGIubG9jaygpO1xuICBpZiAoaXNOYU4oc2Vjb25kcykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBmbG9hdFNlY29uZHMgPSBwYXJzZUZsb2F0KHNlY29uZHMpO1xuICBpZiAoZmxvYXRTZWNvbmRzIDw9IDApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgYXdhaXQgQi5kZWxheSgxMDAwICogZmxvYXRTZWNvbmRzKTtcbiAgYXdhaXQgdGhpcy51bmxvY2soKTtcbn07XG5cbmNvbW1hbmRzLmlzTG9ja2VkID0gYXN5bmMgZnVuY3Rpb24gaXNMb2NrZWQgKCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5hZGIuaXNTY3JlZW5Mb2NrZWQoKTtcbn07XG5cbmNvbW1hbmRzLnVubG9jayA9IGFzeW5jIGZ1bmN0aW9uIHVubG9jayAoKSB7XG4gIHJldHVybiBhd2FpdCBhbmRyb2lkSGVscGVycy51bmxvY2sodGhpcywgdGhpcy5hZGIsIHRoaXMuY2Fwcyk7XG59O1xuXG5jb21tYW5kcy5vcGVuTm90aWZpY2F0aW9ucyA9IGFzeW5jIGZ1bmN0aW9uIG9wZW5Ob3RpZmljYXRpb25zICgpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ29wZW5Ob3RpZmljYXRpb24nKTtcbn07XG5cbmNvbW1hbmRzLnNldExvY2F0aW9uID0gYXN5bmMgZnVuY3Rpb24gc2V0TG9jYXRpb24gKGxhdGl0dWRlLCBsb25naXR1ZGUpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYWRiLnNlbmRUZWxuZXRDb21tYW5kKGBnZW8gZml4ICR7bG9uZ2l0dWRlfSAke2xhdGl0dWRlfWApO1xufTtcblxuY29tbWFuZHMuZmluZ2VycHJpbnQgPSBhc3luYyBmdW5jdGlvbiBmaW5nZXJwcmludCAoZmluZ2VycHJpbnRJZCkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ2ZpbmdlcnByaW50IG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIuZmluZ2VycHJpbnQoZmluZ2VycHJpbnRJZCk7XG59O1xuXG5jb21tYW5kcy5zZW5kU01TID0gYXN5bmMgZnVuY3Rpb24gc2VuZFNNUyAocGhvbmVOdW1iZXIsIG1lc3NhZ2UpIHtcbiAgaWYgKCF0aGlzLmlzRW11bGF0b3IoKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdzZW5kU01TIG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIuc2VuZFNNUyhwaG9uZU51bWJlciwgbWVzc2FnZSk7XG59O1xuXG5jb21tYW5kcy5nc21DYWxsID0gYXN5bmMgZnVuY3Rpb24gZ3NtQ2FsbCAocGhvbmVOdW1iZXIsIGFjdGlvbikge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ2dzbUNhbGwgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5nc21DYWxsKHBob25lTnVtYmVyLCBhY3Rpb24pO1xufTtcblxuY29tbWFuZHMuZ3NtU2lnbmFsID0gYXN5bmMgZnVuY3Rpb24gZ3NtU2lnbmFsIChzaWduYWxTdHJlbmdoKSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnZ3NtU2lnbmFsIG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIuZ3NtU2lnbmFsKHNpZ25hbFN0cmVuZ2gpO1xufTtcblxuY29tbWFuZHMuZ3NtVm9pY2UgPSBhc3luYyBmdW5jdGlvbiBnc21Wb2ljZSAoc3RhdGUpIHtcbiAgaWYgKCF0aGlzLmlzRW11bGF0b3IoKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdnc21Wb2ljZSBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9ycycpO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiLmdzbVZvaWNlKHN0YXRlKTtcbn07XG5cbmNvbW1hbmRzLnBvd2VyQUMgPSBhc3luYyBmdW5jdGlvbiBwb3dlckFDIChzdGF0ZSkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ3Bvd2VyQUMgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5wb3dlckFDKHN0YXRlKTtcbn07XG5cbmNvbW1hbmRzLnBvd2VyQ2FwYWNpdHkgPSBhc3luYyBmdW5jdGlvbiBwb3dlckNhcGFjaXR5IChiYXR0ZXJ5UGVyY2VudCkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ3Bvd2VyQ2FwYWNpdHkgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5wb3dlckNhcGFjaXR5KGJhdHRlcnlQZXJjZW50KTtcbn07XG5cbmNvbW1hbmRzLm5ldHdvcmtTcGVlZCA9IGFzeW5jIGZ1bmN0aW9uIG5ldHdvcmtTcGVlZCAobmV0d29ya1NwZWVkKSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnbmV0d29ya1NwZWVkIG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIubmV0d29ya1NwZWVkKG5ldHdvcmtTcGVlZCk7XG59O1xuXG4vKipcbiAqIEVtdWxhdGUgc2Vuc29ycyB2YWx1ZXMgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTZW5zb3JcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzZW5zb3JUeXBlIC0gc2Vuc29yIHR5cGUgZGVjbGFyZWQgaW4gYWRiLlNFTlNPUlNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB2YWx1ZSAtIHZhbHVlIHRvIHNldCB0byB0aGUgc2Vuc29yXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IFNlbnNvclxuICogQHRocm93cyB7RXJyb3J9IC0gSWYgc2Vuc29yVHlwZSBpcyBub3QgZGVmaW5lZFxuICogQHRocm93cyB7RXJyb3J9IC0gSWYgdmFsdWUgZm9yIHRoZSBzZSBzb3IgaXMgbm90IGRlZmluZWRcbiAqIEB0aHJvd3Mge0Vycm9yfSAtIElmIGRldmljZVR5cGUgaXMgbm90IGFuIGVtdWxhdG9yXG4gKi9cbmNvbW1hbmRzLnNlbnNvclNldCA9IGFzeW5jIGZ1bmN0aW9uIHNlbnNvclNldCAoc2Vuc29yID0ge30pIHtcbiAgY29uc3Qge3NlbnNvclR5cGUsIHZhbHVlfSA9IHNlbnNvcjtcbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKHNlbnNvclR5cGUpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYCdzZW5zb3JUeXBlJyBhcmd1bWVudCBpcyByZXF1aXJlZGApO1xuICB9XG4gIGlmICghdXRpbC5oYXNWYWx1ZSh2YWx1ZSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgJ3ZhbHVlJyBhcmd1bWVudCBpcyByZXF1aXJlZGApO1xuICB9XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnc2Vuc29yU2V0IG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIuc2Vuc29yU2V0KHNlbnNvclR5cGUsIHZhbHVlKTtcbn07XG5cbmhlbHBlcnMuZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiU2hlbGwgPSBhc3luYyBmdW5jdGlvbiBnZXRTY3JlZW5zaG90RGF0YVdpdGhBZGJTaGVsbCAoYWRiLCBvcHRzKSB7XG4gIGNvbnN0IGxvY2FsRmlsZSA9IGF3YWl0IHRlbXBEaXIucGF0aCh7cHJlZml4OiAnYXBwaXVtJywgc3VmZml4OiAnLnBuZyd9KTtcbiAgaWYgKGF3YWl0IGZzLmV4aXN0cyhsb2NhbEZpbGUpKSB7XG4gICAgYXdhaXQgZnMudW5saW5rKGxvY2FsRmlsZSk7XG4gIH1cbiAgdHJ5IHtcbiAgICBjb25zdCBwbmdEaXIgPSBvcHRzLmFuZHJvaWRTY3JlZW5zaG90UGF0aCB8fCAnL2RhdGEvbG9jYWwvdG1wLyc7XG4gICAgY29uc3QgcG5nID0gcGF0aC5wb3NpeC5yZXNvbHZlKHBuZ0RpciwgJ3NjcmVlbnNob3QucG5nJyk7XG4gICAgY29uc3QgY21kID0gWycvc3lzdGVtL2Jpbi9ybScsIGAke3BuZ307YCwgJy9zeXN0ZW0vYmluL3NjcmVlbmNhcCcsICctcCcsIHBuZ107XG4gICAgYXdhaXQgYWRiLnNoZWxsKGNtZCk7XG4gICAgaWYgKCFhd2FpdCBhZGIuZmlsZVNpemUocG5nKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgc2l6ZSBvZiB0aGUgdGFrZW4gc2NyZWVuc2hvdCBlcXVhbHMgdG8gemVyby4nKTtcbiAgICB9XG4gICAgYXdhaXQgYWRiLnB1bGwocG5nLCBsb2NhbEZpbGUpO1xuICAgIHJldHVybiBhd2FpdCBqaW1wLnJlYWQobG9jYWxGaWxlKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGxvY2FsRmlsZSkpIHtcbiAgICAgIGF3YWl0IGZzLnVubGluayhsb2NhbEZpbGUpO1xuICAgIH1cbiAgfVxufTtcblxuaGVscGVycy5nZXRTY3JlZW5zaG90RGF0YVdpdGhBZGJFeGVjT3V0ID0gYXN5bmMgZnVuY3Rpb24gZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiRXhlY091dCAoYWRiKSB7XG4gIGxldCB7c3Rkb3V0LCBzdGRlcnIsIGNvZGV9ID0gYXdhaXQgZXhlYyhhZGIuZXhlY3V0YWJsZS5wYXRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRiLmV4ZWN1dGFibGUuZGVmYXVsdEFyZ3NcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNvbmNhdChbJ2V4ZWMtb3V0JywgJy9zeXN0ZW0vYmluL3NjcmVlbmNhcCcsICctcCddKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtlbmNvZGluZzogJ2JpbmFyeScsIGlzQnVmZmVyOiB0cnVlfSk7XG4gIC8vIGlmIHRoZXJlIGlzIGFuIGVycm9yLCB0aHJvd1xuICBpZiAoY29kZSB8fCBzdGRlcnIubGVuZ3RoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBTY3JlZW5zaG90IHJldHVybmVkIGVycm9yLCBjb2RlOiAnJHtjb2RlfScsIHN0ZGVycjogJyR7c3RkZXJyLnRvU3RyaW5nKCl9J2ApO1xuICB9XG4gIC8vIGlmIHdlIGRvbid0IGdldCBhbnl0aGluZyBhdCBhbGwsIHRocm93XG4gIGlmICghc3Rkb3V0Lmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBFcnJvcignU2NyZWVuc2hvdCByZXR1cm5lZCBubyBkYXRhJyk7XG4gIH1cblxuICByZXR1cm4gYXdhaXQgamltcC5yZWFkKHN0ZG91dCk7XG59O1xuXG5jb21tYW5kcy5nZXRTY3JlZW5zaG90ID0gYXN5bmMgZnVuY3Rpb24gZ2V0U2NyZWVuc2hvdCAoKSB7XG4gIGNvbnN0IGFwaUxldmVsID0gYXdhaXQgdGhpcy5hZGIuZ2V0QXBpTGV2ZWwoKTtcbiAgbGV0IGltYWdlID0gbnVsbDtcbiAgaWYgKGFwaUxldmVsID4gMjApIHtcbiAgICB0cnkge1xuICAgICAgLy8gVGhpcyBzY3JlZW5zaG90aW5nIGFwcHJvYWNoIGlzIHdheSBmYXN0ZXIsIHNpbmNlIGl0IHJlcXVpcmVzIGxlc3MgZXh0ZXJuYWwgY29tbWFuZHNcbiAgICAgIC8vIHRvIGJlIGV4ZWN1dGVkLiBVbmZvcnR1bmF0ZWx5LCBleGVjLW91dCBvcHRpb24gaXMgb25seSBzdXBwb3J0ZWQgYnkgbmV3ZXIgQW5kcm9pZC9TREsgdmVyc2lvbnMgKDUuMCBhbmQgbGF0ZXIpXG4gICAgICBpbWFnZSA9IGF3YWl0IHRoaXMuZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiRXhlY091dCh0aGlzLmFkYik7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLmluZm8oYENhbm5vdCBnZXQgc2NyZWVuc2hvdCBkYXRhIHdpdGggJ2FkYiBleGVjLW91dCcgYmVjYXVzZSBvZiAnJHtlLm1lc3NhZ2V9Jy4gYCArXG4gICAgICAgICAgICAgICBgRGVmYXVsdGluZyB0byAnYWRiIHNoZWxsJyBjYWxsYCk7XG4gICAgfVxuICB9XG4gIGlmICghaW1hZ2UpIHtcbiAgICB0cnkge1xuICAgICAgaW1hZ2UgPSBhd2FpdCB0aGlzLmdldFNjcmVlbnNob3REYXRhV2l0aEFkYlNoZWxsKHRoaXMuYWRiLCB0aGlzLm9wdHMpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnN0IGVyciA9IGBDYW5ub3QgZ2V0IHNjcmVlbnNob3QgZGF0YSBiZWNhdXNlIG9mICcke2UubWVzc2FnZX0nLiBgICtcbiAgICAgICAgICAgICAgICAgIGBNYWtlIHN1cmUgdGhlICdMYXlvdXRQYXJhbXMuRkxBR19TRUNVUkUnIGlzIG5vdCBzZXQgZm9yIGAgK1xuICAgICAgICAgICAgICAgICAgYHRoZSBjdXJyZW50IHZpZXdgO1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coZXJyKTtcbiAgICB9XG4gIH1cbiAgaWYgKGFwaUxldmVsIDwgMjMpIHtcbiAgICAvLyBBbmRyb2lkIGJ1ZyA4NDMzNzQyIC0gcm90YXRlIHNjcmVlbnNob3QgaWYgc2NyZWVuIGlzIHJvdGF0ZWRcbiAgICBsZXQgc2NyZWVuT3JpZW50YXRpb24gPSBhd2FpdCB0aGlzLmFkYi5nZXRTY3JlZW5PcmllbnRhdGlvbigpO1xuICAgIHRyeSB7XG4gICAgICBpbWFnZSA9IGF3YWl0IGltYWdlLnJvdGF0ZSgtOTAgKiBzY3JlZW5PcmllbnRhdGlvbik7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgQ291bGQgbm90IHJvdGF0ZSBzY3JlZW5zaG90IGR1ZSB0byBlcnJvcjogJHtlcnJ9YCk7XG4gICAgfVxuICB9XG4gIGNvbnN0IGdldEJ1ZmZlciA9IEIucHJvbWlzaWZ5KGltYWdlLmdldEJ1ZmZlciwge2NvbnRleHQ6IGltYWdlfSk7XG4gIGNvbnN0IGltZ0J1ZmZlciA9IGF3YWl0IGdldEJ1ZmZlcihqaW1wLk1JTUVfUE5HKTtcbiAgcmV0dXJuIGltZ0J1ZmZlci50b1N0cmluZygnYmFzZTY0Jyk7XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvYWN0aW9ucy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
