"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.SimulatorXcode6 = exports.SPRINGBOARD_BUNDLE_ID = exports.BOOT_COMPLETED_EVENT = void 0;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var _appiumXcode = _interopRequireWildcard(require("appium-xcode"));

var _logger = _interopRequireDefault(require("./logger"));

var _support = require("@appium/support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _utils = require("./utils.js");

var _asyncbox = require("asyncbox");

var settings = _interopRequireWildcard(require("./settings"));

var _teen_process = require("teen_process");

var _tailUntil = require("./tail-until.js");

var _index = _interopRequireDefault(require("./extensions/index"));

var _events = require("events");

var _calendar = _interopRequireDefault(require("./calendar"));

var _permissions = _interopRequireDefault(require("./permissions"));

var _nodeSimctl = _interopRequireDefault(require("node-simctl"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

const STARTUP_TIMEOUT = 60 * 1000;
const EXTRA_STARTUP_TIME = 2000;
const UI_CLIENT_ACCESS_GUARD = new _asyncLock.default();
const UI_CLIENT_BUNDLE_ID = 'com.apple.iphonesimulator';
const SPRINGBOARD_BUNDLE_ID = 'com.apple.SpringBoard';
exports.SPRINGBOARD_BUNDLE_ID = SPRINGBOARD_BUNDLE_ID;
const BOOT_COMPLETED_EVENT = 'bootCompleted';
exports.BOOT_COMPLETED_EVENT = BOOT_COMPLETED_EVENT;

class SimulatorXcode6 extends _events.EventEmitter {
  constructor(udid, xcodeVersion) {
    super();
    this.udid = String(udid);
    this.simctl = new _nodeSimctl.default({
      udid: this.udid
    });
    this.xcodeVersion = xcodeVersion;
    this._platformVersion = null;
    this.keychainPath = _path.default.resolve(this.getDir(), 'Library', 'Keychains');
    this.simulatorApp = 'iOS Simulator.app';
    this.appDataBundlePaths = {};
    this.isFreshFiles = ['Library/ConfigurationProfiles', 'Library/Cookies', 'Library/Preferences/.GlobalPreferences.plist', 'Library/Preferences/com.apple.springboard.plist', 'var/run/syslog.pid'];
    this.extraStartupTime = EXTRA_STARTUP_TIME;
    this.calendar = new _calendar.default(xcodeVersion, this.getDir());
    this.permissions = new _permissions.default(xcodeVersion, this.getDir(), this.udid);
  }

  get uiClientBundleId() {
    return UI_CLIENT_BUNDLE_ID;
  }

  get devicesSetPath() {
    return this.simctl.devicesSetPath;
  }

  set devicesSetPath(value) {
    this.simctl.devicesSetPath = value;
  }

  async getUIClientPid() {
    let stdout;

    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('pgrep', ['-fn', `${this.simulatorApp}/Contents/MacOS/`]));
    } catch (e) {
      return null;
    }

    if (isNaN(parseInt(stdout, 10))) {
      return null;
    }

    stdout = stdout.trim();

    _logger.default.debug(`Got Simulator UI client PID: ${stdout}`);

    return stdout;
  }

  async isUIClientRunning() {
    return !_lodash.default.isNull(await this.getUIClientPid());
  }

  get startupTimeout() {
    return STARTUP_TIMEOUT;
  }

  async getPlatformVersion() {
    if (!this._platformVersion) {
      let {
        sdk
      } = await this.stat();
      this._platformVersion = sdk;
    }

    return this._platformVersion;
  }

  getRootDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Developer', 'CoreSimulator', 'Devices');
  }

  getDir() {
    return _path.default.resolve(this.getRootDir(), this.udid, 'data');
  }

  getLogDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Logs', 'CoreSimulator', this.udid);
  }

  async installApp(app) {
    return await this.simctl.installApp(app);
  }

  async isAppInstalled(bundleId, appFile = null) {
    let appDirs = await this.getAppDirs(appFile, bundleId);
    return appDirs.length !== 0;
  }

  async getUserInstalledBundleIdsByBundleName(bundleName) {
    const rootUserAppDir = await this.buildBundlePathMap('Bundle');
    const bundleIds = [];

    if (_lodash.default.isEmpty(rootUserAppDir)) {
      return bundleIds;
    }

    for (const [bundleId, userAppDirPath] of Object.entries(rootUserAppDir)) {
      const appFile = (await _support.fs.readdir(userAppDirPath)).find(file => _path.default.extname(file).toLowerCase() === '.app');

      const infoPlistPath = _path.default.resolve(userAppDirPath, appFile, 'Info.plist');

      if (!(await _support.fs.exists(infoPlistPath))) {
        continue;
      }

      try {
        const infoPlist = await _support.plist.parsePlistFile(infoPlistPath, false);

        if (infoPlist.CFBundleName === bundleName) {
          bundleIds.push(bundleId);
        }
      } catch (err) {
        _logger.default.warn(`Failed to read plist ${infoPlistPath}. Original error '${err.message}'`);

        continue;
      }
    }

    _logger.default.debug(`The simulator has '${bundleIds.length}' bundles which have '${bundleName}' as their 'CFBundleName':`);

    for (const bundleId of bundleIds) {
      _logger.default.debug(`    '${bundleId}'`);
    }

    return bundleIds;
  }

  async getAppDir(id, subDir = 'Data') {
    this.appDataBundlePaths[subDir] = this.appDataBundlePaths[subDir] || {};

    if (_lodash.default.isEmpty(this.appDataBundlePaths[subDir]) && !(await this.isFresh())) {
      this.appDataBundlePaths[subDir] = await this.buildBundlePathMap(subDir);
    }

    return this.appDataBundlePaths[subDir][id];
  }

  async buildBundlePathMap(subDir = 'Data') {
    _logger.default.debug('Building bundle path map');

    let applicationList;
    let pathBundlePair;

    if ((await this.getPlatformVersion()) === '7.1') {
      applicationList = _path.default.resolve(this.getDir(), 'Applications');

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let appFiles = await _support.fs.glob(`${dir}/*.app`);
        let bundleId = appFiles[0].match(/.*\/(.*)\.app/)[1];
        return {
          path: dir,
          bundleId
        };
      };
    } else {
      applicationList = _path.default.resolve(this.getDir(), 'Containers', subDir, 'Application');

      let readBundleId = async dir => {
        let plist = _path.default.resolve(dir, '.com.apple.mobile_container_manager.metadata.plist');

        let metadata = await settings.read(plist);
        return metadata.MCMMetadataIdentifier;
      };

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let bundleId = await readBundleId(dir);
        return {
          path: dir,
          bundleId
        };
      };
    }

    if (!(await _support.fs.exists(applicationList))) {
      _logger.default.warn(`No directory path '${applicationList}'`);

      return {};
    }

    let bundlePathDirs = await _support.fs.readdir(applicationList);
    let bundlePathPairs = await (0, _asyncbox.asyncmap)(bundlePathDirs, async function (dir) {
      return await pathBundlePair(dir);
    }, false);
    return bundlePathPairs.reduce((bundleMap, bundlePath) => {
      bundleMap[bundlePath.bundleId] = bundlePath.path;
      return bundleMap;
    }, {});
  }

  async stat() {
    for (let [sdk, deviceArr] of _lodash.default.toPairs(await this.simctl.getDevices())) {
      for (let device of deviceArr) {
        if (device.udid === this.udid) {
          device.sdk = sdk;
          return device;
        }
      }
    }

    return {};
  }

  async isFresh() {
    let files = this.isFreshFiles;
    let pv = await this.getPlatformVersion();

    if (pv !== '7.1') {
      files.push('Library/Preferences/com.apple.Preferences.plist');
    } else {
      files.push('Applications');
    }

    const dir = this.getDir();
    files = files.map(s => _path.default.resolve(dir, s));
    const existences = await (0, _asyncbox.asyncmap)(files, async f => await _support.fs.hasAccess(f));
    const fresh = _lodash.default.compact(existences).length !== files.length;

    _logger.default.debug(`Checking whether simulator has been run before: ${fresh ? 'no' : 'yes'}`);

    return fresh;
  }

  async isRunning() {
    try {
      await this.simctl.getEnv('dummy');
      return true;
    } catch (e) {
      return false;
    }
  }

  async isShutdown() {
    try {
      await this.simctl.getEnv('dummy');
      return false;
    } catch (e) {
      return _lodash.default.includes(e.stderr, 'Current state: Shutdown');
    }
  }

  async waitForBoot(startupTimeout) {
    let bootedIndicator = await this.getBootedIndicatorString();
    await this.tailLogsUntil(bootedIndicator, startupTimeout);

    _logger.default.debug(`Waiting an extra ${this.extraStartupTime}ms for the simulator to really finish booting`);

    await _bluebird.default.delay(this.extraStartupTime);

    _logger.default.debug('Done waiting extra time for simulator');

    this.emit(BOOT_COMPLETED_EVENT);
  }

  async getBootedIndicatorString() {
    let indicator;
    let platformVersion = await this.getPlatformVersion();

    switch (platformVersion) {
      case '7.1':
      case '8.1':
      case '8.2':
      case '8.3':
      case '8.4':
        indicator = 'profiled: Service starting...';
        break;

      case '9.0':
      case '9.1':
      case '9.2':
      case '9.3':
        indicator = 'System app "com.apple.springboard" finished startup';
        break;

      case '10.0':
        indicator = 'Switching to keyboard';
        break;

      default:
        _logger.default.warn(`No boot indicator case for platform version '${platformVersion}'`);

        indicator = 'no boot indicator string available';
    }

    return indicator;
  }

  async startUIClient(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);

    _lodash.default.defaultsDeep(opts, {
      scaleFactor: null,
      startupTimeout: this.startupTimeout
    });

    const simulatorApp = _path.default.resolve(await (0, _appiumXcode.getPath)(), 'Applications', this.simulatorApp);

    const args = ['-Fn', simulatorApp, '--args', '-CurrentDeviceUDID', this.udid];

    if (opts.scaleFactor) {
      const {
        name
      } = await this.stat();
      const formattedDeviceName = name.replace(/\s+/g, '-');
      const argumentName = `-SimulatorWindowLastScale-com.apple.CoreSimulator.SimDeviceType.${formattedDeviceName}`;
      args.push(argumentName, opts.scaleFactor);
    }

    _logger.default.info(`Starting Simulator UI with command: open ${args.join(' ')}`);

    try {
      await (0, _teen_process.exec)('open', args, {
        timeout: opts.startupTimeout
      });
    } catch (err) {
      if (!(err.stdout || '').includes('-10825') && !(err.stderr || '').includes('-10825')) {
        throw err;
      }

      _logger.default.warn(`Error while opening UI: ${err.stdout || err.stderr}. Continuing`);
    }
  }

  async run(opts = {}) {
    opts = Object.assign({
      startupTimeout: this.startupTimeout
    }, opts);
    const isServerRunning = await this.isRunning();
    const isUIClientRunning = await this.isUIClientRunning();

    if (isServerRunning && isUIClientRunning) {
      _logger.default.info(`Both Simulator with UDID ${this.udid} and the UI client are currently running`);

      return;
    }

    const timer = new _support.timing.Timer().start();

    try {
      await this.shutdown();
    } catch (err) {
      _logger.default.warn(`Error on Simulator shutdown: ${err.message}`);
    }

    await this.startUIClient(opts);
    await this.waitForBoot(opts.startupTimeout);

    _logger.default.info(`Simulator with UDID ${this.udid} booted in ${timer.getDuration().asSeconds.toFixed(3)}s`);
  }

  async clean() {
    await this.endSimulatorDaemon();

    _logger.default.info(`Cleaning simulator ${this.udid}`);

    await this.simctl.eraseDevice(10000);
  }

  async scrubCustomApp(appFile, appBundleId) {
    return await this.cleanCustomApp(appFile, appBundleId, true);
  }

  async cleanCustomApp(appFile, appBundleId, scrub = false) {
    _logger.default.debug(`Cleaning app data files for '${appFile}', '${appBundleId}'`);

    if (!scrub) {
      _logger.default.debug(`Deleting app altogether`);
    }

    let appDirs = await this.getAppDirs(appFile, appBundleId, scrub);

    if (appDirs.length === 0) {
      _logger.default.debug('Could not find app directories to delete. It is probably not installed');

      return;
    }

    let deletePromises = [];

    for (let dir of appDirs) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_support.fs.rimraf(dir));
    }

    if ((await this.getPlatformVersion()) >= 8) {
      let relRmPath = `Library/Preferences/${appBundleId}.plist`;

      let rmPath = _path.default.resolve(this.getRootDir(), relRmPath);

      _logger.default.debug(`Deleting file: '${rmPath}'`);

      deletePromises.push(_support.fs.rimraf(rmPath));
    }

    await _bluebird.default.all(deletePromises);
  }

  async getAppDirs(appFile, appBundleId, scrub = false) {
    let dirs = [];

    if ((await this.getPlatformVersion()) >= 8) {
      let data = await this.getAppDir(appBundleId);
      if (!data) return dirs;
      let bundle = !scrub ? await this.getAppDir(appBundleId, 'Bundle') : undefined;

      for (let src of [data, bundle]) {
        if (src) {
          dirs.push(src);
        }
      }
    } else {
      let data = await this.getAppDir(appFile);

      if (data) {
        dirs.push(data);
      }
    }

    return dirs;
  }

  async launchAndQuit(safari = false, startupTimeout = this.startupTimeout) {
    _logger.default.debug('Attempting to launch and quit the simulator, to create directory structure');

    _logger.default.debug(`Will launch with Safari? ${safari}`);

    await this.run({
      startupTimeout
    });

    if (safari) {
      await this.openUrl('http://www.appium.io');
    }

    try {
      await (0, _asyncbox.retryInterval)(60, 250, async () => {
        if (await this.isFresh()) {
          throw new Error('Simulator files not fully created. Waiting a bit');
        }
      });
    } catch (err) {
      _logger.default.warn(`Timeout waiting for simulator files to be created. Continuing`);
    }

    await this.shutdown();
  }

  async endSimulatorDaemon() {
    _logger.default.debug(`Killing any simulator daemons for ${this.udid}`);

    let launchctlCmd = `launchctl list | grep ${this.udid} | cut -f 3 | xargs -n 1 launchctl`;

    try {
      let stopCmd = `${launchctlCmd} stop`;
      await (0, _teen_process.exec)('bash', ['-c', stopCmd]);
    } catch (err) {
      _logger.default.warn(`Could not stop simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      let removeCmd = `${launchctlCmd} remove`;
      await (0, _teen_process.exec)('bash', ['-c', removeCmd]);
    } catch (err) {
      _logger.default.warn(`Could not remove simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      await (0, _asyncbox.waitForCondition)(async () => {
        let {
          stdout
        } = await (0, _teen_process.exec)('bash', ['-c', `ps -e  | grep ${this.udid} | grep launchd_sim | grep -v bash | grep -v grep | awk {'print$1'}`]);
        return stdout.trim().length === 0;
      }, {
        waitMs: 10000,
        intervalMs: 500
      });
    } catch (err) {
      _logger.default.warn(`Could not end simulator daemon for ${this.udid}: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }
  }

  async shutdown(opts = {}) {
    if (await this.isShutdown()) {
      return;
    }

    await (0, _asyncbox.retryInterval)(5, 500, this.simctl.shutdownDevice.bind(this.simctl));
    const waitMs = parseInt(opts.timeout, 10);

    if (waitMs > 0) {
      try {
        await (0, _asyncbox.waitForCondition)(async () => await this.isShutdown(), {
          waitMs,
          intervalMs: 100
        });
      } catch (err) {
        throw new Error(`Simulator is not in 'Shutdown' state after ${waitMs}ms`);
      }
    }
  }

  async delete() {
    await this.simctl.deleteDevice();
  }

  async updateSettings(plist, updates) {
    return await settings.updateSettings(this, plist, updates);
  }

  async updateLocationSettings(bundleId, authorized) {
    return await settings.updateLocationSettings(this, bundleId, authorized);
  }

  async setReduceMotion(reduceMotion = true) {
    if (await this.isFresh()) {
      await this.launchAndQuit(false, STARTUP_TIMEOUT);
    }

    await settings.setReduceMotion(this, reduceMotion);
  }

  async setAppearance() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to set UI appearance`);
  }

  async getAppearance() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to get UI appearance`);
  }

  async updateSafariSettings(updates) {
    let updated = await settings.updateSafariUserSettings(this, updates);
    return (await settings.updateSettings(this, 'mobileSafari', updates)) || updated;
  }

  async updateSafariGlobalSettings(updates) {
    return await settings.updateSafariGlobalSettings(this, updates);
  }

  async updateLocale(language, locale, calendarFormat) {
    return await settings.updateLocale(this, language, locale, calendarFormat);
  }

  async deleteSafari() {
    _logger.default.debug('Deleting Safari apps from simulator');

    let dirs = [];
    dirs.push(await this.getAppDir('com.apple.mobilesafari'));
    let pv = await this.getPlatformVersion();

    if (pv >= 8) {
      dirs.push(await this.getAppDir('com.apple.mobilesafari', 'Bundle'));
    }

    let deletePromises = [];

    for (let dir of _lodash.default.compact(dirs)) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_support.fs.rimraf(dir));
    }

    await _bluebird.default.all(deletePromises);
  }

  async cleanSafari(keepPrefs = true) {
    _logger.default.debug('Cleaning mobile safari data files');

    if (await this.isFresh()) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let libraryDir = _path.default.resolve(this.getDir(), 'Library');

    let safariRoot = await this.getAppDir('com.apple.mobilesafari');

    if (!safariRoot) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let safariLibraryDir = _path.default.resolve(safariRoot, 'Library');

    let filesToDelete = ['Caches/Snapshots/com.apple.mobilesafari', 'Caches/com.apple.mobilesafari/*', 'Caches/com.apple.WebAppCache/*', 'Caches/com.apple.WebKit.Networking/*', 'Caches/com.apple.WebKit.WebContent/*', 'Image Cache/*', 'WebKit/com.apple.mobilesafari/*', 'WebKit/GeolocationSites.plist', 'WebKit/LocalStorage/*.*', 'Safari/*', 'Cookies/*.binarycookies', 'Caches/com.apple.UIStatusBar/*', 'Caches/com.apple.keyboards/images/*', 'Caches/com.apple.Safari.SafeBrowsing/*', '../tmp/com.apple.mobilesafari/*'];
    let deletePromises = [];

    for (let file of filesToDelete) {
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(libraryDir, file)));
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(safariLibraryDir, file)));
    }

    if (!keepPrefs) {
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(safariLibraryDir, 'Preferences/*.plist')));
    }

    await _bluebird.default.all(deletePromises);
  }

  async removeApp(bundleId) {
    await this.simctl.removeApp(bundleId);
  }

  async moveBuiltInApp(appName, appPath, newAppPath) {
    await (0, _utils.safeRimRaf)(newAppPath);
    await _support.fs.copyFile(appPath, newAppPath);

    _logger.default.debug(`Copied '${appName}' to '${newAppPath}'`);

    await _support.fs.rimraf(appPath);

    _logger.default.debug(`Temporarily deleted original app at '${appPath}'`);

    return [newAppPath, appPath];
  }

  async openUrl(url) {
    const SAFARI_BOOTED_INDICATOR = 'MobileSafari[';
    const SAFARI_STARTUP_TIMEOUT = 15 * 1000;
    const EXTRA_STARTUP_TIME = 3 * 1000;

    if (await this.isRunning()) {
      await (0, _asyncbox.retry)(5000, this.simctl.openUrl.bind(this.simctl), url);
      await this.tailLogsUntil(SAFARI_BOOTED_INDICATOR, SAFARI_STARTUP_TIMEOUT);

      _logger.default.debug(`Safari started, waiting ${EXTRA_STARTUP_TIME}ms for it to fully start`);

      await _bluebird.default.delay(EXTRA_STARTUP_TIME);

      _logger.default.debug('Done waiting for Safari');

      return;
    } else {
      throw new Error('Tried to open a url, but the Simulator is not Booted');
    }
  }

  async clearCaches(...folderNames) {
    const cachesRoot = _path.default.resolve(this.getDir(), 'Library', 'Caches');

    if (!(await _support.fs.hasAccess(cachesRoot))) {
      _logger.default.debug(`Caches root at '${cachesRoot}' does not exist or is not accessible. Nothing to do there`);

      return 0;
    }

    let itemsToRemove = folderNames.length ? folderNames : await _support.fs.readdir(cachesRoot);
    itemsToRemove = itemsToRemove.map(x => _path.default.resolve(cachesRoot, x));

    if (folderNames.length) {
      itemsToRemove = await _bluebird.default.filter(itemsToRemove, x => _support.fs.hasAccess(x));
    }

    itemsToRemove = await _bluebird.default.filter(itemsToRemove, async x => (await _support.fs.stat(x)).isDirectory());

    if (!itemsToRemove.length) {
      _logger.default.debug(`No Simulator cache items for cleanup were matched in '${cachesRoot}'`);

      return 0;
    }

    _logger.default.debug(`Matched ${_support.util.pluralize('simulator cache item', itemsToRemove.length, true)} ` + `for cleanup: ${itemsToRemove}`);

    try {
      await _bluebird.default.all(itemsToRemove, x => _support.fs.rimraf(x));
    } catch (e) {
      _logger.default.warn(`Got an exception while cleaning Simulator caches: ${e.message}`);
    }

    return itemsToRemove.length;
  }

  async tailLogsUntil(bootedIndicator, timeoutMs) {
    let simLog = _path.default.resolve(this.getLogDir(), 'system.log');

    await (0, _asyncbox.retryInterval)(200, 200, async () => {
      let exists = await _support.fs.exists(simLog);

      if (!exists) {
        throw new Error(`Could not find Simulator log: '${simLog}'`);
      }
    });

    _logger.default.info(`Simulator log at '${simLog}'`);

    _logger.default.info(`Tailing simulator logs until we encounter the string "${bootedIndicator}"`);

    _logger.default.info(`We will time out after ${timeoutMs}ms`);

    try {
      await (0, _tailUntil.tailUntil)(simLog, bootedIndicator, timeoutMs);
    } catch (err) {
      _logger.default.debug('Simulator startup timed out. Continuing anyway.');
    }
  }

  async enableCalendarAccess(bundleID) {
    await this.calendar.enableCalendarAccess(bundleID);
  }

  async disableCalendarAccess(bundleID) {
    await this.calendar.disableCalendarAccess(bundleID);
  }

  async hasCalendarAccess(bundleID) {
    return await this.calendar.hasCalendarAccess(bundleID);
  }

  async _activateWindow() {
    const pid = await this.getUIClientPid();

    if (pid) {
      try {
        return await (0, _utils.activateApp)(pid);
      } catch (e) {
        _logger.default.debug(e.stderr || e.message);
      }
    }

    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
        end tell
      end tell
    `;
  }

  async executeUIClientScript(appleScript) {
    const windowActivationScript = await this._activateWindow();
    const resultScript = `${windowActivationScript ? windowActivationScript + '\n' : ''}${appleScript}`;

    _logger.default.debug(`Executing UI Apple Script on Simulator with UDID ${this.udid}: ${resultScript}`);

    return await UI_CLIENT_ACCESS_GUARD.acquire(this.simulatorApp, async () => {
      try {
        const {
          stdout
        } = await (0, _teen_process.exec)('osascript', ['-e', resultScript]);
        return stdout;
      } catch (err) {
        _logger.default.errorAndThrow(`Could not complete operation. Make sure Simulator UI is running and the parent Appium application (e. g. Appium.app or Terminal.app) ` + `is present in System Preferences > Security & Privacy > Privacy > Accessibility list. If the operation is still unsuccessful then ` + `it is not supported by this Simulator. ` + `Original error: ${err.message}`);
      }
    });
  }

  async isBiometricEnrolled() {
    const output = await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
        end tell
      end tell
    `);

    _logger.default.debug(`Touch ID enrolled state: ${output}`);

    return _lodash.default.isString(output) && output.trim() === 'true';
  }

  async enrollBiometric(isEnabled = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
          if ${isEnabled ? 'not ' : ''}isChecked then
            click dstMenuItem
          end if
        end tell
      end tell
    `);
  }

  async sendBiometricMatch(shouldMatch = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "${shouldMatch ? 'Matching' : 'Non-matching'}" of menu 1 of menu item "Simulate Finger Touch" of menu 1 of menu bar item "Hardware" of menu bar 1
          click dstMenuItem
        end tell
      end tell
    `);
  }

  async dismissDatabaseAlert(increase = true) {
    let button = increase ? 'Increase' : 'Cancel';

    _logger.default.debug(`Attempting to dismiss database alert with '${button}' button`);

    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          click button "${button}" of window 1
        end tell
      end tell
    `);
  }

  async backupKeychains() {
    if (!(await _support.fs.exists(this.keychainPath))) {
      return false;
    }

    const backupPath = await _support.tempDir.path({
      prefix: `keychains_backup_${Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1)}`,
      suffix: '.zip'
    });
    const zipArgs = ['-r', backupPath, `${this.keychainPath}${_path.default.sep}`];

    _logger.default.debug(`Creating keychains backup with 'zip ${zipArgs.join(' ')}' command`);

    await (0, _teen_process.exec)('zip', zipArgs);

    if (_lodash.default.isString(this._keychainsBackupPath) && (await _support.fs.exists(this._keychainsBackupPath))) {
      await _support.fs.unlink(this._keychainsBackupPath);
    }

    this._keychainsBackupPath = backupPath;
    return true;
  }

  async restoreKeychains(excludePatterns = []) {
    if (!_lodash.default.isString(this._keychainsBackupPath) || !(await _support.fs.exists(this._keychainsBackupPath))) {
      throw new Error(`The keychains backup archive does not exist. ` + `Are you sure it was created before?`);
    }

    if (_lodash.default.isString(excludePatterns)) {
      excludePatterns = excludePatterns.split(',').map(x => x.trim());
    }

    const isServerRunning = await this.isRunning();
    let plistPath;

    if (isServerRunning) {
      plistPath = _path.default.resolve(await this.getLaunchDaemonsRoot(), 'com.apple.securityd.plist');

      if (!(await _support.fs.exists(plistPath))) {
        throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
      }

      await this.simctl.spawnProcess(['launchctl', 'unload', plistPath]);
    }

    try {
      await _support.fs.rimraf(this.keychainPath);
      await (0, _support.mkdirp)(this.keychainPath);
      const unzipArgs = ['-o', this._keychainsBackupPath, ..._lodash.default.flatMap(excludePatterns.map(x => ['-x', x])), '-d', '/'];

      _logger.default.debug(`Restoring keychains with 'unzip ${unzipArgs.join(' ')}' command`);

      await (0, _teen_process.exec)('unzip', unzipArgs);
      await _support.fs.unlink(this._keychainsBackupPath);
      this._keychainsBackupPath = null;
    } finally {
      if (isServerRunning && plistPath) {
        await this.simctl.spawnProcess(['launchctl', 'load', plistPath]);
      }
    }

    return true;
  }

  async clearKeychains() {
    const plistPath = _path.default.resolve(await this.getLaunchDaemonsRoot(), 'com.apple.securityd.plist');

    if (!(await _support.fs.exists(plistPath))) {
      throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
    }

    await this.simctl.spawnProcess(['launchctl', 'unload', plistPath]);

    try {
      if (await _support.fs.exists(this.keychainPath)) {
        await _support.fs.rimraf(this.keychainPath);
        await (0, _support.mkdirp)(this.keychainPath);
      }
    } finally {
      await this.simctl.spawnProcess(['launchctl', 'load', plistPath]);
    }
  }

  async ps() {
    const {
      stdout
    } = await this.simctl.spawnProcess(['launchctl', 'print', 'system']);
    const servicesMatch = /^\s*services\s*=\s*{([^}]+)/m.exec(stdout);

    if (!servicesMatch) {
      _logger.default.debug(stdout);

      throw new Error(`The list of active processes cannot be retrieved`);
    }

    const result = [];
    const pattern = /^\s*(\d+)\s+[\d-]+\s+([\w\-.]+:)?([\w\-.]+)/gm;
    let match;

    while (match = pattern.exec(servicesMatch[1])) {
      result.push({
        pid: parseInt(match[1], 10),
        group: _lodash.default.trimEnd(match[2], ':') || null,
        name: match[3]
      });
    }

    return result;
  }

  async setPermission(bundleId, permission, value) {
    await this.setPermissions(bundleId, {
      [permission]: value
    });
  }

  async setPermissions(bundleId, permissionsMapping) {
    _logger.default.debug(`Setting access for '${bundleId}': ` + JSON.stringify(permissionsMapping, null, 2));

    await this.permissions.setAccess(bundleId, permissionsMapping);
  }

  async getPermission(bundleId, serviceName) {
    const result = await this.permissions.getAccess(bundleId, serviceName);

    _logger.default.debug(`Got ${serviceName} access status for '${bundleId}': ${result}`);

    return result;
  }

  async addCertificate(payload) {
    if (await (0, _utils.hasSSLCert)(payload, this.udid)) {
      _logger.default.info(`SSL certificate '${_lodash.default.truncate(payload, {
        length: 20
      })}' already installed`);

      return false;
    }

    _logger.default.info(`Installing SSL root certificate '${_lodash.default.truncate(payload, {
      length: 20
    })}'`);

    await (0, _utils.installSSLCert)(payload, this.udid);
    return true;
  }

  async pushNotification() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to push notifications`);
  }

  async getLaunchDaemonsRoot() {
    const devRoot = await (0, _utils.getDeveloperRoot)();
    return _path.default.resolve(devRoot, 'Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/LaunchDaemons');
  }

  static async _getDeviceStringPlatformVersion(platformVersion) {
    let reqVersion = platformVersion;

    if (!reqVersion) {
      reqVersion = await _appiumXcode.default.getMaxIOSSDK();

      _logger.default.warn(`No platform version set. Using max SDK version: ${reqVersion}`);

      if (!_lodash.default.isString(reqVersion)) {
        reqVersion = reqVersion % 1 ? String(reqVersion) : `${reqVersion}.0`;
      }
    }

    return reqVersion;
  }

  static async _getDeviceStringVersionString(platformVersion) {
    let reqVersion = await this._getDeviceStringPlatformVersion(platformVersion);
    return `(${reqVersion} Simulator)`;
  }

  static _getDeviceStringConfigFix() {
    return {
      'iPad Simulator (7.1 Simulator)': 'iPad 2 (7.1 Simulator)',
      'iPad Simulator (8.0 Simulator)': 'iPad 2 (8.0 Simulator)',
      'iPad Simulator (8.1 Simulator)': 'iPad 2 (8.1 Simulator)',
      'iPad Simulator (8.2 Simulator)': 'iPad 2 (8.2 Simulator)',
      'iPad Simulator (8.3 Simulator)': 'iPad 2 (8.3 Simulator)',
      'iPad Simulator (8.4 Simulator)': 'iPad 2 (8.4 Simulator)',
      'iPhone Simulator (7.1 Simulator)': 'iPhone 5s (7.1 Simulator)',
      'iPhone Simulator (8.4 Simulator)': 'iPhone 6 (8.4 Simulator)',
      'iPhone Simulator (8.3 Simulator)': 'iPhone 6 (8.3 Simulator)',
      'iPhone Simulator (8.2 Simulator)': 'iPhone 6 (8.2 Simulator)',
      'iPhone Simulator (8.1 Simulator)': 'iPhone 6 (8.1 Simulator)',
      'iPhone Simulator (8.0 Simulator)': 'iPhone 6 (8.0 Simulator)'
    };
  }

  static async getDeviceString(opts) {
    opts = Object.assign({}, {
      deviceName: null,
      platformVersion: null,
      forceIphone: false,
      forceIpad: false
    }, opts);
    let logOpts = {
      deviceName: opts.deviceName,
      platformVersion: opts.platformVersion,
      forceIphone: opts.forceIphone,
      forceIpad: opts.forceIpad
    };

    _logger.default.debug(`Getting device string from options: ${JSON.stringify(logOpts)}`);

    if ((opts.deviceName || '')[0] === '=') {
      return opts.deviceName.substring(1);
    }

    let isiPhone = !!opts.forceIphone || !opts.forceIpad;

    if (opts.deviceName) {
      let device = opts.deviceName.toLowerCase();

      if (device.indexOf('iphone') !== -1) {
        isiPhone = true;
      } else if (device.indexOf('ipad') !== -1) {
        isiPhone = false;
      }
    }

    let iosDeviceString = opts.deviceName || (isiPhone ? 'iPhone Simulator' : 'iPad Simulator');

    if (/^(iPhone|iPad)$/.test(iosDeviceString)) {
      iosDeviceString += ' Simulator';
    }

    if (/[^(iPhone|iPad)] Simulator/.test(iosDeviceString)) {
      iosDeviceString = iosDeviceString.replace(' Simulator', '');
    }

    iosDeviceString += ` ${await this._getDeviceStringVersionString(opts.platformVersion)}`;

    let CONFIG_FIX = this._getDeviceStringConfigFix();

    let configFix = CONFIG_FIX;

    if (configFix[iosDeviceString]) {
      iosDeviceString = configFix[iosDeviceString];

      _logger.default.debug(`Fixing device. Changed from '${opts.deviceName}' ` + `to '${iosDeviceString}'`);
    }

    _logger.default.debug(`Final device string is '${iosDeviceString}'`);

    return iosDeviceString;
  }

  async getWebInspectorSocket() {
    return null;
  }

}

exports.SimulatorXcode6 = SimulatorXcode6;

for (let [cmd, fn] of _lodash.default.toPairs(_index.default)) {
  SimulatorXcode6.prototype[cmd] = fn;
}

var _default = SimulatorXcode6;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW11bGF0b3IteGNvZGUtNi5qcyJdLCJuYW1lcyI6WyJTVEFSVFVQX1RJTUVPVVQiLCJFWFRSQV9TVEFSVFVQX1RJTUUiLCJVSV9DTElFTlRfQUNDRVNTX0dVQVJEIiwiQXN5bmNMb2NrIiwiVUlfQ0xJRU5UX0JVTkRMRV9JRCIsIlNQUklOR0JPQVJEX0JVTkRMRV9JRCIsIkJPT1RfQ09NUExFVEVEX0VWRU5UIiwiU2ltdWxhdG9yWGNvZGU2IiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJ1ZGlkIiwieGNvZGVWZXJzaW9uIiwiU3RyaW5nIiwic2ltY3RsIiwiU2ltY3RsIiwiX3BsYXRmb3JtVmVyc2lvbiIsImtleWNoYWluUGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0RGlyIiwic2ltdWxhdG9yQXBwIiwiYXBwRGF0YUJ1bmRsZVBhdGhzIiwiaXNGcmVzaEZpbGVzIiwiZXh0cmFTdGFydHVwVGltZSIsImNhbGVuZGFyIiwiQ2FsZW5kYXIiLCJwZXJtaXNzaW9ucyIsIlBlcm1pc3Npb25zIiwidWlDbGllbnRCdW5kbGVJZCIsImRldmljZXNTZXRQYXRoIiwidmFsdWUiLCJnZXRVSUNsaWVudFBpZCIsInN0ZG91dCIsImUiLCJpc05hTiIsInBhcnNlSW50IiwidHJpbSIsImxvZyIsImRlYnVnIiwiaXNVSUNsaWVudFJ1bm5pbmciLCJfIiwiaXNOdWxsIiwic3RhcnR1cFRpbWVvdXQiLCJnZXRQbGF0Zm9ybVZlcnNpb24iLCJzZGsiLCJzdGF0IiwiZ2V0Um9vdERpciIsImhvbWUiLCJwcm9jZXNzIiwiZW52IiwiSE9NRSIsImdldExvZ0RpciIsImluc3RhbGxBcHAiLCJhcHAiLCJpc0FwcEluc3RhbGxlZCIsImJ1bmRsZUlkIiwiYXBwRmlsZSIsImFwcERpcnMiLCJnZXRBcHBEaXJzIiwibGVuZ3RoIiwiZ2V0VXNlckluc3RhbGxlZEJ1bmRsZUlkc0J5QnVuZGxlTmFtZSIsImJ1bmRsZU5hbWUiLCJyb290VXNlckFwcERpciIsImJ1aWxkQnVuZGxlUGF0aE1hcCIsImJ1bmRsZUlkcyIsImlzRW1wdHkiLCJ1c2VyQXBwRGlyUGF0aCIsIk9iamVjdCIsImVudHJpZXMiLCJmcyIsInJlYWRkaXIiLCJmaW5kIiwiZmlsZSIsImV4dG5hbWUiLCJ0b0xvd2VyQ2FzZSIsImluZm9QbGlzdFBhdGgiLCJleGlzdHMiLCJpbmZvUGxpc3QiLCJwbGlzdCIsInBhcnNlUGxpc3RGaWxlIiwiQ0ZCdW5kbGVOYW1lIiwicHVzaCIsImVyciIsIndhcm4iLCJtZXNzYWdlIiwiZ2V0QXBwRGlyIiwiaWQiLCJzdWJEaXIiLCJpc0ZyZXNoIiwiYXBwbGljYXRpb25MaXN0IiwicGF0aEJ1bmRsZVBhaXIiLCJkaXIiLCJhcHBGaWxlcyIsImdsb2IiLCJtYXRjaCIsInJlYWRCdW5kbGVJZCIsIm1ldGFkYXRhIiwic2V0dGluZ3MiLCJyZWFkIiwiTUNNTWV0YWRhdGFJZGVudGlmaWVyIiwiYnVuZGxlUGF0aERpcnMiLCJidW5kbGVQYXRoUGFpcnMiLCJyZWR1Y2UiLCJidW5kbGVNYXAiLCJidW5kbGVQYXRoIiwiZGV2aWNlQXJyIiwidG9QYWlycyIsImdldERldmljZXMiLCJkZXZpY2UiLCJmaWxlcyIsInB2IiwibWFwIiwicyIsImV4aXN0ZW5jZXMiLCJmIiwiaGFzQWNjZXNzIiwiZnJlc2giLCJjb21wYWN0IiwiaXNSdW5uaW5nIiwiZ2V0RW52IiwiaXNTaHV0ZG93biIsImluY2x1ZGVzIiwic3RkZXJyIiwid2FpdEZvckJvb3QiLCJib290ZWRJbmRpY2F0b3IiLCJnZXRCb290ZWRJbmRpY2F0b3JTdHJpbmciLCJ0YWlsTG9nc1VudGlsIiwiQiIsImRlbGF5IiwiZW1pdCIsImluZGljYXRvciIsInBsYXRmb3JtVmVyc2lvbiIsInN0YXJ0VUlDbGllbnQiLCJvcHRzIiwiY2xvbmVEZWVwIiwiZGVmYXVsdHNEZWVwIiwic2NhbGVGYWN0b3IiLCJhcmdzIiwibmFtZSIsImZvcm1hdHRlZERldmljZU5hbWUiLCJyZXBsYWNlIiwiYXJndW1lbnROYW1lIiwiaW5mbyIsImpvaW4iLCJ0aW1lb3V0IiwicnVuIiwiYXNzaWduIiwiaXNTZXJ2ZXJSdW5uaW5nIiwidGltZXIiLCJ0aW1pbmciLCJUaW1lciIsInN0YXJ0Iiwic2h1dGRvd24iLCJnZXREdXJhdGlvbiIsImFzU2Vjb25kcyIsInRvRml4ZWQiLCJjbGVhbiIsImVuZFNpbXVsYXRvckRhZW1vbiIsImVyYXNlRGV2aWNlIiwic2NydWJDdXN0b21BcHAiLCJhcHBCdW5kbGVJZCIsImNsZWFuQ3VzdG9tQXBwIiwic2NydWIiLCJkZWxldGVQcm9taXNlcyIsInJpbXJhZiIsInJlbFJtUGF0aCIsInJtUGF0aCIsImFsbCIsImRpcnMiLCJkYXRhIiwiYnVuZGxlIiwidW5kZWZpbmVkIiwic3JjIiwibGF1bmNoQW5kUXVpdCIsInNhZmFyaSIsIm9wZW5VcmwiLCJFcnJvciIsImxhdW5jaGN0bENtZCIsInN0b3BDbWQiLCJyZW1vdmVDbWQiLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIiwic2h1dGRvd25EZXZpY2UiLCJiaW5kIiwiZGVsZXRlIiwiZGVsZXRlRGV2aWNlIiwidXBkYXRlU2V0dGluZ3MiLCJ1cGRhdGVzIiwidXBkYXRlTG9jYXRpb25TZXR0aW5ncyIsImF1dGhvcml6ZWQiLCJzZXRSZWR1Y2VNb3Rpb24iLCJyZWR1Y2VNb3Rpb24iLCJzZXRBcHBlYXJhbmNlIiwiZ2V0QXBwZWFyYW5jZSIsInVwZGF0ZVNhZmFyaVNldHRpbmdzIiwidXBkYXRlZCIsInVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncyIsInVwZGF0ZVNhZmFyaUdsb2JhbFNldHRpbmdzIiwidXBkYXRlTG9jYWxlIiwibGFuZ3VhZ2UiLCJsb2NhbGUiLCJjYWxlbmRhckZvcm1hdCIsImRlbGV0ZVNhZmFyaSIsImNsZWFuU2FmYXJpIiwia2VlcFByZWZzIiwibGlicmFyeURpciIsInNhZmFyaVJvb3QiLCJzYWZhcmlMaWJyYXJ5RGlyIiwiZmlsZXNUb0RlbGV0ZSIsInJlbW92ZUFwcCIsIm1vdmVCdWlsdEluQXBwIiwiYXBwTmFtZSIsImFwcFBhdGgiLCJuZXdBcHBQYXRoIiwiY29weUZpbGUiLCJ1cmwiLCJTQUZBUklfQk9PVEVEX0lORElDQVRPUiIsIlNBRkFSSV9TVEFSVFVQX1RJTUVPVVQiLCJjbGVhckNhY2hlcyIsImZvbGRlck5hbWVzIiwiY2FjaGVzUm9vdCIsIml0ZW1zVG9SZW1vdmUiLCJ4IiwiZmlsdGVyIiwiaXNEaXJlY3RvcnkiLCJ1dGlsIiwicGx1cmFsaXplIiwidGltZW91dE1zIiwic2ltTG9nIiwiZW5hYmxlQ2FsZW5kYXJBY2Nlc3MiLCJidW5kbGVJRCIsImRpc2FibGVDYWxlbmRhckFjY2VzcyIsImhhc0NhbGVuZGFyQWNjZXNzIiwiX2FjdGl2YXRlV2luZG93IiwicGlkIiwiZXhlY3V0ZVVJQ2xpZW50U2NyaXB0IiwiYXBwbGVTY3JpcHQiLCJ3aW5kb3dBY3RpdmF0aW9uU2NyaXB0IiwicmVzdWx0U2NyaXB0IiwiYWNxdWlyZSIsImVycm9yQW5kVGhyb3ciLCJpc0Jpb21ldHJpY0Vucm9sbGVkIiwib3V0cHV0IiwiaXNTdHJpbmciLCJlbnJvbGxCaW9tZXRyaWMiLCJpc0VuYWJsZWQiLCJzZW5kQmlvbWV0cmljTWF0Y2giLCJzaG91bGRNYXRjaCIsImRpc21pc3NEYXRhYmFzZUFsZXJ0IiwiaW5jcmVhc2UiLCJidXR0b24iLCJiYWNrdXBLZXljaGFpbnMiLCJiYWNrdXBQYXRoIiwidGVtcERpciIsInByZWZpeCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwic3VmZml4IiwiemlwQXJncyIsInNlcCIsIl9rZXljaGFpbnNCYWNrdXBQYXRoIiwidW5saW5rIiwicmVzdG9yZUtleWNoYWlucyIsImV4Y2x1ZGVQYXR0ZXJucyIsInNwbGl0IiwicGxpc3RQYXRoIiwiZ2V0TGF1bmNoRGFlbW9uc1Jvb3QiLCJzcGF3blByb2Nlc3MiLCJ1bnppcEFyZ3MiLCJmbGF0TWFwIiwiY2xlYXJLZXljaGFpbnMiLCJwcyIsInNlcnZpY2VzTWF0Y2giLCJleGVjIiwicmVzdWx0IiwicGF0dGVybiIsImdyb3VwIiwidHJpbUVuZCIsInNldFBlcm1pc3Npb24iLCJwZXJtaXNzaW9uIiwic2V0UGVybWlzc2lvbnMiLCJwZXJtaXNzaW9uc01hcHBpbmciLCJKU09OIiwic3RyaW5naWZ5Iiwic2V0QWNjZXNzIiwiZ2V0UGVybWlzc2lvbiIsInNlcnZpY2VOYW1lIiwiZ2V0QWNjZXNzIiwiYWRkQ2VydGlmaWNhdGUiLCJwYXlsb2FkIiwidHJ1bmNhdGUiLCJwdXNoTm90aWZpY2F0aW9uIiwiZGV2Um9vdCIsIl9nZXREZXZpY2VTdHJpbmdQbGF0Zm9ybVZlcnNpb24iLCJyZXFWZXJzaW9uIiwieGNvZGUiLCJnZXRNYXhJT1NTREsiLCJfZ2V0RGV2aWNlU3RyaW5nVmVyc2lvblN0cmluZyIsIl9nZXREZXZpY2VTdHJpbmdDb25maWdGaXgiLCJnZXREZXZpY2VTdHJpbmciLCJkZXZpY2VOYW1lIiwiZm9yY2VJcGhvbmUiLCJmb3JjZUlwYWQiLCJsb2dPcHRzIiwiaXNpUGhvbmUiLCJpbmRleE9mIiwiaW9zRGV2aWNlU3RyaW5nIiwidGVzdCIsIkNPTkZJR19GSVgiLCJjb25maWdGaXgiLCJnZXRXZWJJbnNwZWN0b3JTb2NrZXQiLCJjbWQiLCJmbiIsImV4dGVuc2lvbnMiLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUdBLE1BQU1BLGVBQWUsR0FBRyxLQUFLLElBQTdCO0FBQ0EsTUFBTUMsa0JBQWtCLEdBQUcsSUFBM0I7QUFDQSxNQUFNQyxzQkFBc0IsR0FBRyxJQUFJQyxrQkFBSixFQUEvQjtBQUNBLE1BQU1DLG1CQUFtQixHQUFHLDJCQUE1QjtBQUNBLE1BQU1DLHFCQUFxQixHQUFHLHVCQUE5Qjs7QUFVQSxNQUFNQyxvQkFBb0IsR0FBRyxlQUE3Qjs7O0FBR0EsTUFBTUMsZUFBTixTQUE4QkMsb0JBQTlCLENBQTJD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VyxnQ0FBK0IrRixJQUFJLENBQUMwSyxVQUFXLElBQWhELEdBQ0MsT0FBTU0sZUFBZ0IsR0FEakM7QUFFRDs7QUFFRGhSLG9CQUFJQyxLQUFKLENBQVcsMkJBQTBCK1EsZUFBZ0IsR0FBckQ7O0FBQ0EsV0FBT0EsZUFBUDtBQUNEOztBQU0wQixRQUFyQkkscUJBQXFCLEdBQUk7QUFFN0IsV0FBTyxJQUFQO0FBQ0Q7O0FBajlDd0M7Ozs7QUFvOUMzQyxLQUFLLElBQUksQ0FBQ0MsR0FBRCxFQUFNQyxFQUFOLENBQVQsSUFBc0JuUixnQkFBRWtFLE9BQUYsQ0FBVWtOLGNBQVYsQ0FBdEIsRUFBNkM7QUFDM0NyVCxFQUFBQSxlQUFlLENBQUNzVCxTQUFoQixDQUEwQkgsR0FBMUIsSUFBaUNDLEVBQWpDO0FBQ0Q7O2VBRWNwVCxlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIHhjb2RlLCBnZXRQYXRoIGFzIGdldFhjb2RlUGF0aCB9IGZyb20gJ2FwcGl1bS14Y29kZSc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGZzLCB0ZW1wRGlyLCBta2RpcnAsIHBsaXN0LCB0aW1pbmcsIHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBBc3luY0xvY2sgZnJvbSAnYXN5bmMtbG9jayc7XG5pbXBvcnQge1xuICBzYWZlUmltUmFmLCBnZXREZXZlbG9wZXJSb290LCBpbnN0YWxsU1NMQ2VydCwgaGFzU1NMQ2VydCwgYWN0aXZhdGVBcHAsXG59IGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IHsgYXN5bmNtYXAsIHJldHJ5SW50ZXJ2YWwsIHdhaXRGb3JDb25kaXRpb24sIHJldHJ5IH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0ICogYXMgc2V0dGluZ3MgZnJvbSAnLi9zZXR0aW5ncyc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IHRhaWxVbnRpbCB9IGZyb20gJy4vdGFpbC11bnRpbC5qcyc7XG5pbXBvcnQgZXh0ZW5zaW9ucyBmcm9tICcuL2V4dGVuc2lvbnMvaW5kZXgnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCBDYWxlbmRhciBmcm9tICcuL2NhbGVuZGFyJztcbmltcG9ydCBQZXJtaXNzaW9ucyBmcm9tICcuL3Blcm1pc3Npb25zJztcbmltcG9ydCBTaW1jdGwgZnJvbSAnbm9kZS1zaW1jdGwnO1xuXG5cbmNvbnN0IFNUQVJUVVBfVElNRU9VVCA9IDYwICogMTAwMDtcbmNvbnN0IEVYVFJBX1NUQVJUVVBfVElNRSA9IDIwMDA7XG5jb25zdCBVSV9DTElFTlRfQUNDRVNTX0dVQVJEID0gbmV3IEFzeW5jTG9jaygpO1xuY29uc3QgVUlfQ0xJRU5UX0JVTkRMRV9JRCA9ICdjb20uYXBwbGUuaXBob25lc2ltdWxhdG9yJztcbmNvbnN0IFNQUklOR0JPQVJEX0JVTkRMRV9JRCA9ICdjb20uYXBwbGUuU3ByaW5nQm9hcmQnO1xuXG4vKlxuICogVGhpcyBldmVudCBpcyBlbWl0dGVkIGFzIHNvb24gYXMgaU9TIFNpbXVsYXRvclxuICogaGFzIGZpbmlzaGVkIGJvb3RpbmcgYW5kIGl0IGlzIHJlYWR5IHRvIGFjY2VwdCB4Y3J1biBjb21tYW5kcy5cbiAqIFRoZSBldmVudCBoYW5kbGVyIGlzIGNhbGxlZCBhZnRlciAncnVuJyBtZXRob2QgaXMgY29tcGxldGVkXG4gKiBmb3IgWGNvZGUgNyBhbmQgb2xkZXIgYW5kIGlzIG9ubHkgdXNlZnVsIGluIFhjb2RlIDgrLFxuICogc2luY2Ugb25lIGNhbiBzdGFydCBkb2luZyBzdHVmZiAoZm9yIGV4YW1wbGUgaW5zdGFsbC91bmluc3RhbGwgYW4gYXBwKSBpbiBwYXJhbGxlbFxuICogd2l0aCBTaW11bGF0b3IgVUkgc3RhcnR1cCwgd2hpY2ggc2hvcnRlbnMgc2Vzc2lvbiBzdGFydHVwIHRpbWUuXG4gKi9cbmNvbnN0IEJPT1RfQ09NUExFVEVEX0VWRU5UID0gJ2Jvb3RDb21wbGV0ZWQnO1xuXG5cbmNsYXNzIFNpbXVsYXRvclhjb2RlNiBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdHMgdGhlIG9iamVjdCB3aXRoIHRoZSBgdWRpZGAgYW5kIHZlcnNpb24gb2YgWGNvZGUuIFVzZSB0aGUgZXhwb3J0ZWQgYGdldFNpbXVsYXRvcih1ZGlkKWAgbWV0aG9kIGluc3RlYWQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFNpbXVsYXRvciBJRC5cbiAgICogQHBhcmFtIHtvYmplY3R9IHhjb2RlVmVyc2lvbiAtIFRoZSB0YXJnZXQgWGNvZGUgdmVyc2lvbiBpbiBmb3JtYXQge21ham9yLCBtaW5vciwgYnVpbGR9LlxuICAgKi9cbiAgY29uc3RydWN0b3IgKHVkaWQsIHhjb2RlVmVyc2lvbikge1xuICAgIHN1cGVyKCk7XG5cbiAgICB0aGlzLnVkaWQgPSBTdHJpbmcodWRpZCk7XG4gICAgdGhpcy5zaW1jdGwgPSBuZXcgU2ltY3RsKHtcbiAgICAgIHVkaWQ6IHRoaXMudWRpZCxcbiAgICB9KTtcbiAgICB0aGlzLnhjb2RlVmVyc2lvbiA9IHhjb2RlVmVyc2lvbjtcblxuICAgIC8vIHBsYXRmb3JtVmVyc2lvbiBjYW5ub3QgYmUgZm91bmQgaW5pdGlhbGx5LCBzaW5jZSBnZXR0aW5nIGl0IGhhcyBzaWRlIGVmZmVjdHMgZm9yXG4gICAgLy8gb3VyIGxvZ2ljIGZvciBmaWd1cmluZyBvdXQgaWYgYSBzaW0gaGFzIGJlZW4gcnVuXG4gICAgLy8gaXQgd2lsbCBiZSBzZXQgd2hlbiBpdCBpcyBuZWVkZWRcbiAgICB0aGlzLl9wbGF0Zm9ybVZlcnNpb24gPSBudWxsO1xuXG4gICAgdGhpcy5rZXljaGFpblBhdGggPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0xpYnJhcnknLCAnS2V5Y2hhaW5zJyk7XG4gICAgdGhpcy5zaW11bGF0b3JBcHAgPSAnaU9TIFNpbXVsYXRvci5hcHAnO1xuXG4gICAgdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHMgPSB7fTtcblxuICAgIC8vIGxpc3Qgb2YgZmlsZXMgdG8gY2hlY2sgZm9yIHdoZW4gc2VlaW5nIGlmIGEgc2ltdWxhdG9yIGlzIFwiZnJlc2hcIlxuICAgIC8vIChtZWFuaW5nIGl0IGhhcyBuZXZlciBiZWVuIGJvb3RlZCkuXG4gICAgLy8gSWYgdGhlc2UgZmlsZXMgYXJlIHByZXNlbnQsIHdlIGFzc3VtZSBpdCdzIGJlZW4gc3VjY2Vzc2Z1bGx5IGJvb3RlZFxuICAgIHRoaXMuaXNGcmVzaEZpbGVzID0gW1xuICAgICAgJ0xpYnJhcnkvQ29uZmlndXJhdGlvblByb2ZpbGVzJyxcbiAgICAgICdMaWJyYXJ5L0Nvb2tpZXMnLFxuICAgICAgJ0xpYnJhcnkvUHJlZmVyZW5jZXMvLkdsb2JhbFByZWZlcmVuY2VzLnBsaXN0JyxcbiAgICAgICdMaWJyYXJ5L1ByZWZlcmVuY2VzL2NvbS5hcHBsZS5zcHJpbmdib2FyZC5wbGlzdCcsXG4gICAgICAndmFyL3J1bi9zeXNsb2cucGlkJ1xuICAgIF07XG5cbiAgICAvLyBleHRyYSB0aW1lIHRvIHdhaXQgZm9yIHNpbXVsYXRvciB0byBiZSBkZWVtZWQgYm9vdGVkXG4gICAgdGhpcy5leHRyYVN0YXJ0dXBUaW1lID0gRVhUUkFfU1RBUlRVUF9USU1FO1xuXG4gICAgdGhpcy5jYWxlbmRhciA9IG5ldyBDYWxlbmRhcih4Y29kZVZlcnNpb24sIHRoaXMuZ2V0RGlyKCkpO1xuICAgIHRoaXMucGVybWlzc2lvbnMgPSBuZXcgUGVybWlzc2lvbnMoeGNvZGVWZXJzaW9uLCB0aGlzLmdldERpcigpLCB0aGlzLnVkaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQnVuZGxlIGlkZW50aWZpZXIgb2YgU2ltdWxhdG9yIFVJIGNsaWVudC5cbiAgICovXG4gIGdldCB1aUNsaWVudEJ1bmRsZUlkICgpIHtcbiAgICByZXR1cm4gVUlfQ0xJRU5UX0JVTkRMRV9JRDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBkZXZpY2VzIHNldCB3aGVyZSB0aGUgY3VycmVudCBzaW11bGF0b3IgaXMgbG9jYXRlZC5cbiAgICogYG51bGxgIHZhbHVlIG1lYW5zIHRoYXQgdGhlIGRlZmF1bHQgcGF0aCBpcyB1c2VkLCB3aGljaCBpcyB1c3VhbGx5IGB+L0xpYnJhcnkvRGV2ZWxvcGVyL0NvcmVTaW11bGF0b3IvRGV2aWNlc2BcbiAgICovXG4gIGdldCBkZXZpY2VzU2V0UGF0aCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2ltY3RsLmRldmljZXNTZXRQYXRoO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkZXZpY2VzIHNldC4gSXQgaXMgcmVjb21tZW5kZWQgdG8gc2V0IHRoaXMgdmFsdWVcbiAgICogb25jZSByaWdodCBhZnRlciBTaW11bGF0b3IgaW5zdGFuY2UgaXMgY3JlYXRlZCBhbmQgdG8gbm90IGNoYW5nZSBpdCBkdXJpbmdcbiAgICogdGhlIGluc3RhbmNlIGxpZmVjeWNsZVxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd9IHZhbHVlIFRoZSBmdWxsIHBhdGggdG8gdGhlIGRldmljZXMgc2V0IHJvb3Qgb24gdGhlXG4gICAqIGxvY2FsIGZpbGUgc3lzdGVtXG4gICAqL1xuICBzZXQgZGV2aWNlc1NldFBhdGggKHZhbHVlKSB7XG4gICAgdGhpcy5zaW1jdGwuZGV2aWNlc1NldFBhdGggPSB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgcHJvY2VzcyBpZCBvZiB0aGUgVUkgY2xpZW50XG4gICAqXG4gICAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBwcm9jZXNzIElEIG9yIG51bGwgaWYgdGhlIFVJIGNsaWVudCBpcyBub3QgcnVubmluZ1xuICAgKi9cbiAgYXN5bmMgZ2V0VUlDbGllbnRQaWQgKCkge1xuICAgIGxldCBzdGRvdXQ7XG4gICAgdHJ5IHtcbiAgICAgICh7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3BncmVwJywgWyctZm4nLCBgJHt0aGlzLnNpbXVsYXRvckFwcH0vQ29udGVudHMvTWFjT1MvYF0pKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKGlzTmFOKHBhcnNlSW50KHN0ZG91dCwgMTApKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHN0ZG91dCA9IHN0ZG91dC50cmltKCk7XG4gICAgbG9nLmRlYnVnKGBHb3QgU2ltdWxhdG9yIFVJIGNsaWVudCBQSUQ6ICR7c3Rkb3V0fWApO1xuICAgIHJldHVybiBzdGRvdXQ7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgdGhlIHN0YXRlIG9mIFNpbXVsYXRvciBVSSBjbGllbnQuXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgb2YgaWYgVUkgY2xpZW50IGlzIHJ1bm5pbmcgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgYXN5bmMgaXNVSUNsaWVudFJ1bm5pbmcgKCkge1xuICAgIHJldHVybiAhXy5pc051bGwoYXdhaXQgdGhpcy5nZXRVSUNsaWVudFBpZCgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIb3cgbG9uZyB0byB3YWl0IGJlZm9yZSB0aHJvd2luZyBhbiBlcnJvciBhYm91dCBTaW11bGF0b3Igc3RhcnR1cCB0aW1lb3V0IGhhcHBlbmVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzLlxuICAgKi9cbiAgZ2V0IHN0YXJ0dXBUaW1lb3V0ICgpIHtcbiAgICByZXR1cm4gU1RBUlRVUF9USU1FT1VUO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcGxhdGZvcm0gdmVyc2lvbiBvZiB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gU0RLIHZlcnNpb24sIGZvciBleGFtcGxlICc4LjMnLlxuICAgKi9cbiAgYXN5bmMgZ2V0UGxhdGZvcm1WZXJzaW9uICgpIHtcbiAgICBpZiAoIXRoaXMuX3BsYXRmb3JtVmVyc2lvbikge1xuICAgICAgbGV0IHtzZGt9ID0gYXdhaXQgdGhpcy5zdGF0KCk7XG4gICAgICB0aGlzLl9wbGF0Zm9ybVZlcnNpb24gPSBzZGs7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wbGF0Zm9ybVZlcnNpb247XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHdoZXJlIFNpbXVsYXRvciBzdHVmZiBpcyBsb2NhdGVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBwYXRoIHN0cmluZy5cbiAgICovXG4gIGdldFJvb3REaXIgKCkge1xuICAgIGxldCBob21lID0gcHJvY2Vzcy5lbnYuSE9NRTtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKGhvbWUsICdMaWJyYXJ5JywgJ0RldmVsb3BlcicsICdDb3JlU2ltdWxhdG9yJywgJ0RldmljZXMnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkaXJlY3Rvcnkgd2hlcmUgU2ltdWxhdG9yIGFwcGxpY2F0aW9ucyBkYXRhIGlzIGxvY2F0ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhdGggc3RyaW5nLlxuICAgKi9cbiAgZ2V0RGlyICgpIHtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0Um9vdERpcigpLCB0aGlzLnVkaWQsICdkYXRhJyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHdoZXJlIFNpbXVsYXRvciBsb2dzIGFyZSBzdG9yZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhdGggc3RyaW5nLlxuICAgKi9cbiAgZ2V0TG9nRGlyICgpIHtcbiAgICBsZXQgaG9tZSA9IHByb2Nlc3MuZW52LkhPTUU7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZShob21lLCAnTGlicmFyeScsICdMb2dzJywgJ0NvcmVTaW11bGF0b3InLCB0aGlzLnVkaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluc3RhbGwgdmFsaWQgLmFwcCBwYWNrYWdlIG9uIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcCAtIFRoZSBwYXRoIHRvIHRoZSAuYXBwIHBhY2thZ2UuXG4gICAqL1xuICBhc3luYyBpbnN0YWxsQXBwIChhcHApIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5zaW1jdGwuaW5zdGFsbEFwcChhcHApO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmeSB3aGV0aGVyIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIGlzIGluc3RhbGxlZCBvbiBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidW5kbGUgaWQgb2YgdGhlIGFwcGxpY2F0aW9uIHRvIGJlIGNoZWNrZWQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBGdWxlIC0gQXBwbGljYXRpb24gbmFtZSBtaW51cyBcIi5hcHBcIiAoZm9yIGlPUyA3LjEpXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGlzIGluc3RhbGxlZFxuICAgKi9cbiAgYXN5bmMgaXNBcHBJbnN0YWxsZWQgKGJ1bmRsZUlkLCBhcHBGaWxlID0gbnVsbCkge1xuICAgIC8vIGBhcHBGaWxlYCBhcmd1bWVudCBvbmx5IG5lY2Vzc2FyeSBmb3IgaU9TIGJlbG93IHZlcnNpb24gOFxuICAgIGxldCBhcHBEaXJzID0gYXdhaXQgdGhpcy5nZXRBcHBEaXJzKGFwcEZpbGUsIGJ1bmRsZUlkKTtcbiAgICByZXR1cm4gYXBwRGlycy5sZW5ndGggIT09IDA7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB1c2VyIGluc3RhbGxlZCBidW5kbGUgaWRzIHdoaWNoIGhhcyAnYnVuZGxlTmFtZScgaW4gdGhlaXIgSW5mby5QbGlzdCBhcyAnQ0ZCdW5kbGVOYW1lJ1xuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBUaGUgYnVuZGxlIGlkIG9mIHRoZSBhcHBsaWNhdGlvbiB0byBiZSBjaGVja2VkLlxuICAgKiBAcmV0dXJuIHthcnJheTxzdHJpbmc+fSAtIFRoZSBsaXN0IG9mIGJ1bmRsZSBpZHMgd2hpY2ggaGF2ZSAnYnVuZGxlTmFtZSdcbiAgICovXG4gIGFzeW5jIGdldFVzZXJJbnN0YWxsZWRCdW5kbGVJZHNCeUJ1bmRsZU5hbWUgKGJ1bmRsZU5hbWUpIHtcbiAgICBjb25zdCByb290VXNlckFwcERpciA9IGF3YWl0IHRoaXMuYnVpbGRCdW5kbGVQYXRoTWFwKCdCdW5kbGUnKTtcbiAgICBjb25zdCBidW5kbGVJZHMgPSBbXTtcbiAgICBpZiAoXy5pc0VtcHR5KHJvb3RVc2VyQXBwRGlyKSkge1xuICAgICAgcmV0dXJuIGJ1bmRsZUlkcztcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IFtidW5kbGVJZCwgdXNlckFwcERpclBhdGhdIG9mIE9iamVjdC5lbnRyaWVzKHJvb3RVc2VyQXBwRGlyKSkge1xuICAgICAgY29uc3QgYXBwRmlsZSA9IChhd2FpdCBmcy5yZWFkZGlyKHVzZXJBcHBEaXJQYXRoKSkuZmluZChcbiAgICAgICAgKGZpbGUpID0+IHBhdGguZXh0bmFtZShmaWxlKS50b0xvd2VyQ2FzZSgpID09PSAnLmFwcCcpO1xuICAgICAgY29uc3QgaW5mb1BsaXN0UGF0aCA9IHBhdGgucmVzb2x2ZSh1c2VyQXBwRGlyUGF0aCwgYXBwRmlsZSwgJ0luZm8ucGxpc3QnKTtcbiAgICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKGluZm9QbGlzdFBhdGgpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaW5mb1BsaXN0ID0gYXdhaXQgcGxpc3QucGFyc2VQbGlzdEZpbGUoaW5mb1BsaXN0UGF0aCwgZmFsc2UpO1xuICAgICAgICBpZiAoaW5mb1BsaXN0LkNGQnVuZGxlTmFtZSA9PT0gYnVuZGxlTmFtZSkge1xuICAgICAgICAgIGJ1bmRsZUlkcy5wdXNoKGJ1bmRsZUlkKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy53YXJuKGBGYWlsZWQgdG8gcmVhZCBwbGlzdCAke2luZm9QbGlzdFBhdGh9LiBPcmlnaW5hbCBlcnJvciAnJHtlcnIubWVzc2FnZX0nYCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2cuZGVidWcoYFRoZSBzaW11bGF0b3IgaGFzICcke2J1bmRsZUlkcy5sZW5ndGh9JyBidW5kbGVzIHdoaWNoIGhhdmUgJyR7YnVuZGxlTmFtZX0nIGFzIHRoZWlyICdDRkJ1bmRsZU5hbWUnOmApO1xuICAgIGZvciAoY29uc3QgYnVuZGxlSWQgb2YgYnVuZGxlSWRzKSB7XG4gICAgICBsb2cuZGVidWcoYCAgICAnJHtidW5kbGVJZH0nYCk7XG4gICAgfVxuICAgIHJldHVybiBidW5kbGVJZHM7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGRpcmVjdG9yeSBmb3IgYSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uJ3MgZGF0YS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gRWl0aGVyIGEgYnVuZGxlSWQgKGUuZy4sIGNvbS5hcHBsZS5tb2JpbGVzYWZhcmkpIG9yLCBmb3IgaU9TIDcuMSwgdGhlIGFwcCBuYW1lIHdpdGhvdXQgYC5hcHBgIChlLmcuLCBNb2JpbGVTYWZhcmkpXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdWJkaXIgLSBUaGUgc3ViLWRpcmVjdG9yeSB3ZSBleHBlY3QgdG8gYmUgd2l0aGluIHRoZSBhcHBsaWNhdGlvbiBkaXJlY3RvcnkuIERlZmF1bHRzIHRvIFwiRGF0YVwiLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSByb290IGFwcGxpY2F0aW9uIGZvbGRlci5cbiAgICovXG4gIGFzeW5jIGdldEFwcERpciAoaWQsIHN1YkRpciA9ICdEYXRhJykge1xuICAgIHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl0gPSB0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdIHx8IHt9O1xuICAgIGlmIChfLmlzRW1wdHkodGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXSkgJiYgIWF3YWl0IHRoaXMuaXNGcmVzaCgpKSB7XG4gICAgICB0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdID0gYXdhaXQgdGhpcy5idWlsZEJ1bmRsZVBhdGhNYXAoc3ViRGlyKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl1baWRdO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSB4Y29kZSA2IHNpbXVsYXRvcnMgYXJlIHJlYWxseSBhbm5veWluZywgYW5kIGJ1cnkgdGhlIG1haW4gYXBwXG4gICAqIGRpcmVjdG9yaWVzIGluc2lkZSBkaXJlY3RvcmllcyBqdXN0IG5hbWVkIHdpdGggSGFzaGVzLlxuICAgKiBUaGlzIGZ1bmN0aW9uIGZpbmRzIHRoZSBwcm9wZXIgZGlyZWN0b3J5IGJ5IHRyYXZlcnNpbmcgYWxsIG9mIHRoZW1cbiAgICogYW5kIHJlYWRpbmcgYSBtZXRhZGF0YSBwbGlzdCAoTW9iaWxlIENvbnRhaW5lciBNYW5hZ2VyKSB0byBnZXQgdGhlXG4gICAqIGJ1bmRsZSBpZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN1YmRpciAtIFRoZSBzdWItZGlyZWN0b3J5IHdlIGV4cGVjdCB0byBiZSB3aXRoaW4gdGhlIGFwcGxpY2F0aW9uIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8gXCJEYXRhXCIuXG4gICAqIEByZXR1cm4ge29iamVjdH0gVGhlIGxpc3Qgb2YgcGF0aC1idW5kbGUgcGFpcnMgdG8gYW4gb2JqZWN0IHdoZXJlIGJ1bmRsZUlkcyBhcmUgbWFwcGVkIHRvIHBhdGhzLlxuICAgKi9cbiAgYXN5bmMgYnVpbGRCdW5kbGVQYXRoTWFwIChzdWJEaXIgPSAnRGF0YScpIHtcbiAgICBsb2cuZGVidWcoJ0J1aWxkaW5nIGJ1bmRsZSBwYXRoIG1hcCcpO1xuICAgIGxldCBhcHBsaWNhdGlvbkxpc3Q7XG4gICAgbGV0IHBhdGhCdW5kbGVQYWlyO1xuICAgIGlmIChhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpID09PSAnNy4xJykge1xuICAgICAgLy8gYXBwcyBhdmFpbGFibGVcbiAgICAgIC8vICAgV2ViLmFwcCxcbiAgICAgIC8vICAgV2ViVmlld1NlcnZpY2UuYXBwLFxuICAgICAgLy8gICBNb2JpbGVTYWZhcmkuYXBwLFxuICAgICAgLy8gICBXZWJDb250ZW50QW5hbHlzaXNVSS5hcHAsXG4gICAgICAvLyAgIEREQWN0aW9uc1NlcnZpY2UuYXBwLFxuICAgICAgLy8gICBTdG9yZUtpdFVJU2VydmljZS5hcHBcbiAgICAgIGFwcGxpY2F0aW9uTGlzdCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnQXBwbGljYXRpb25zJyk7XG4gICAgICBwYXRoQnVuZGxlUGFpciA9IGFzeW5jIChkaXIpID0+IHtcbiAgICAgICAgZGlyID0gcGF0aC5yZXNvbHZlKGFwcGxpY2F0aW9uTGlzdCwgZGlyKTtcbiAgICAgICAgbGV0IGFwcEZpbGVzID0gYXdhaXQgZnMuZ2xvYihgJHtkaXJ9LyouYXBwYCk7XG4gICAgICAgIGxldCBidW5kbGVJZCA9IGFwcEZpbGVzWzBdLm1hdGNoKC8uKlxcLyguKilcXC5hcHAvKVsxXTtcbiAgICAgICAgcmV0dXJuIHtwYXRoOiBkaXIsIGJ1bmRsZUlkfTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGFwcGxpY2F0aW9uTGlzdCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnQ29udGFpbmVycycsIHN1YkRpciwgJ0FwcGxpY2F0aW9uJyk7XG4gICAgICAvLyBnaXZlbiBhIGRpcmVjdG9yeSwgZmluZCB0aGUgcGxpc3QgZmlsZSBhbmQgcHVsbCB0aGUgYnVuZGxlIGlkIGZyb20gaXRcbiAgICAgIGxldCByZWFkQnVuZGxlSWQgPSBhc3luYyAoZGlyKSA9PiB7XG4gICAgICAgIGxldCBwbGlzdCA9IHBhdGgucmVzb2x2ZShkaXIsICcuY29tLmFwcGxlLm1vYmlsZV9jb250YWluZXJfbWFuYWdlci5tZXRhZGF0YS5wbGlzdCcpO1xuICAgICAgICBsZXQgbWV0YWRhdGEgPSBhd2FpdCBzZXR0aW5ncy5yZWFkKHBsaXN0KTtcbiAgICAgICAgcmV0dXJuIG1ldGFkYXRhLk1DTU1ldGFkYXRhSWRlbnRpZmllcjtcbiAgICAgIH07XG4gICAgICAvLyBnaXZlbiBhIGRpcmVjdG9yeSwgcmV0dXJuIHRoZSBwYXRoIGFuZCBidW5kbGUgaWQgYXNzb2NpYXRlZCB3aXRoIGl0XG4gICAgICBwYXRoQnVuZGxlUGFpciA9IGFzeW5jIChkaXIpID0+IHtcbiAgICAgICAgZGlyID0gcGF0aC5yZXNvbHZlKGFwcGxpY2F0aW9uTGlzdCwgZGlyKTtcbiAgICAgICAgbGV0IGJ1bmRsZUlkID0gYXdhaXQgcmVhZEJ1bmRsZUlkKGRpcik7XG4gICAgICAgIHJldHVybiB7cGF0aDogZGlyLCBidW5kbGVJZH07XG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKGFwcGxpY2F0aW9uTGlzdCkpIHtcbiAgICAgIGxvZy53YXJuKGBObyBkaXJlY3RvcnkgcGF0aCAnJHthcHBsaWNhdGlvbkxpc3R9J2ApO1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cblxuICAgIGxldCBidW5kbGVQYXRoRGlycyA9IGF3YWl0IGZzLnJlYWRkaXIoYXBwbGljYXRpb25MaXN0KTtcbiAgICBsZXQgYnVuZGxlUGF0aFBhaXJzID0gYXdhaXQgYXN5bmNtYXAoYnVuZGxlUGF0aERpcnMsIGFzeW5jIGZ1bmN0aW9uIChkaXIpIHtcbiAgICAgIHJldHVybiBhd2FpdCBwYXRoQnVuZGxlUGFpcihkaXIpO1xuICAgIH0sIGZhbHNlKTtcblxuICAgIC8vIHJlZHVjZSB0aGUgbGlzdCBvZiBwYXRoLWJ1bmRsZSBwYWlycyB0byBhbiBvYmplY3Qgd2hlcmUgYnVuZGxlSWRzIGFyZSBtYXBwZWQgdG8gcGF0aHNcbiAgICByZXR1cm4gYnVuZGxlUGF0aFBhaXJzLnJlZHVjZSgoYnVuZGxlTWFwLCBidW5kbGVQYXRoKSA9PiB7XG4gICAgICBidW5kbGVNYXBbYnVuZGxlUGF0aC5idW5kbGVJZF0gPSBidW5kbGVQYXRoLnBhdGg7XG4gICAgICByZXR1cm4gYnVuZGxlTWFwO1xuICAgIH0sIHt9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHN0YXRlIGFuZCBzcGVjaWZpY3Mgb2YgdGhpcyBzaW0uXG4gICAqXG4gICAqIEByZXR1cm4ge29iamVjdH0gU2ltdWxhdG9yIHN0YXRzIG1hcHBpbmcsIGZvciBleGFtcGxlOlxuICAgKiB7IG5hbWU6ICdpUGhvbmUgNHMnLFxuICAgKiAgIHVkaWQ6ICdDMDlCMzRFNS03RENCLTQ0MkUtQjc5Qy1BQjZCQzAzNTc0MTcnLFxuICAgKiAgIHN0YXRlOiAnU2h1dGRvd24nLFxuICAgKiAgIHNkazogJzguMydcbiAgICogfVxuICAgKi9cbiAgYXN5bmMgc3RhdCAoKSB7XG4gICAgZm9yIChsZXQgW3NkaywgZGV2aWNlQXJyXSBvZiBfLnRvUGFpcnMoYXdhaXQgdGhpcy5zaW1jdGwuZ2V0RGV2aWNlcygpKSkge1xuICAgICAgZm9yIChsZXQgZGV2aWNlIG9mIGRldmljZUFycikge1xuICAgICAgICBpZiAoZGV2aWNlLnVkaWQgPT09IHRoaXMudWRpZCkge1xuICAgICAgICAgIGRldmljZS5zZGsgPSBzZGs7XG4gICAgICAgICAgcmV0dXJuIGRldmljZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGlzIGEgYmVzdC1iZXQgaGV1cmlzdGljIGZvciB3aGV0aGVyIG9yIG5vdCBhIHNpbSBoYXMgYmVlbiBib290ZWRcbiAgICogYmVmb3JlLiBXZSB1c3VhbGx5IHdhbnQgdG8gc3RhcnQgYSBzaW11bGF0b3IgdG8gXCJ3YXJtXCIgaXQgdXAsIGhhdmVcbiAgICogWGNvZGUgcG9wdWxhdGUgaXQgd2l0aCBwbGlzdHMgZm9yIHVzIHRvIG1hbmlwdWxhdGUgYmVmb3JlIGEgcmVhbFxuICAgKiB0ZXN0IHJ1bi5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaGFzIG5ldmVyIGJlZW4gc3RhcnRlZCBiZWZvcmVcbiAgICovXG4gIGFzeW5jIGlzRnJlc2ggKCkge1xuICAgIC8vIGlmIHRoZSBmb2xsb3dpbmcgZmlsZXMgZG9uJ3QgZXhpc3QsIGl0IGhhc24ndCBiZWVuIGJvb3RlZC5cbiAgICAvLyBUSElTIElTIE5PVCBBTiBFWEhBVVNUSVZFIExJU1RcbiAgICBsZXQgZmlsZXMgPSB0aGlzLmlzRnJlc2hGaWxlcztcblxuICAgIGxldCBwdiA9IGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG4gICAgaWYgKHB2ICE9PSAnNy4xJykge1xuICAgICAgZmlsZXMucHVzaCgnTGlicmFyeS9QcmVmZXJlbmNlcy9jb20uYXBwbGUuUHJlZmVyZW5jZXMucGxpc3QnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmlsZXMucHVzaCgnQXBwbGljYXRpb25zJyk7XG4gICAgfVxuXG4gICAgY29uc3QgZGlyID0gdGhpcy5nZXREaXIoKTtcbiAgICBmaWxlcyA9IGZpbGVzLm1hcCgocykgPT4gcGF0aC5yZXNvbHZlKGRpciwgcykpO1xuXG4gICAgY29uc3QgZXhpc3RlbmNlcyA9IGF3YWl0IGFzeW5jbWFwKGZpbGVzLCBhc3luYyAoZikgPT4gYXdhaXQgZnMuaGFzQWNjZXNzKGYpKTtcbiAgICBjb25zdCBmcmVzaCA9IF8uY29tcGFjdChleGlzdGVuY2VzKS5sZW5ndGggIT09IGZpbGVzLmxlbmd0aDtcbiAgICBsb2cuZGVidWcoYENoZWNraW5nIHdoZXRoZXIgc2ltdWxhdG9yIGhhcyBiZWVuIHJ1biBiZWZvcmU6ICR7ZnJlc2ggPyAnbm8nIDogJ3llcyd9YCk7XG5cbiAgICByZXR1cm4gZnJlc2g7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSBzdGF0ZSBvZiB0aGUgY3VycmVudCBTaW11bGF0b3IuIE9uZSBzaG91bGQgZGlzdGluZ3Vpc2ggdGhlXG4gICAqIHN0YXRlcyBvZiBTaW11bGF0b3IgVUkgYW5kIHRoZSBTaW11bGF0b3IgaXRzZWxmLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBjdXJyZW50IFNpbXVsYXRvciBpcyBydW5uaW5nLlxuICAgKi9cbiAgYXN5bmMgaXNSdW5uaW5nICgpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zaW1jdGwuZ2V0RW52KCdkdW1teScpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdGhlIHNpbXVsYXRvciBpcyBpbiBzaHV0ZG93biBzdGF0ZS5cbiAgICogVGhpcyBtZXRob2QgaXMgbmVjZXNzYXJ5LCBiZWNhdXNlIFNpbXVsYXRvciBtaWdodCBhbHNvIGJlXG4gICAqIGluIHRoZSB0cmFuc2l0aW9uYWwgU2h1dHRpbmcgRG93biBzdGF0ZSByaWdodCBhZnRlciB0aGUgYHNodXRkb3duYFxuICAgKiBjb21tYW5kIGhhcyBiZWVuIGlzc3VlZC5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaXMgc2h1dCBkb3duLlxuICAgKi9cbiAgYXN5bmMgaXNTaHV0ZG93biAoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLmdldEVudignZHVtbXknKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gXy5pbmNsdWRlcyhlLnN0ZGVyciwgJ0N1cnJlbnQgc3RhdGU6IFNodXRkb3duJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmeSB3aGV0aGVyIHRoZSBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQgYW5kL29yIHdhaXQgZm9yIGl0XG4gICAqIHVudGlsIHRoZSB0aW1lb3V0IGV4cGlyZXMuXG4gICAqXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydHVwVGltZW91dCAtIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgYm9vdGluZyBpcyBjb21wbGV0ZWQuXG4gICAqIEBlbWl0cyBCT09UX0NPTVBMRVRFRF9FVkVOVCBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaXMgcmVhZHkgdG8gYWNjZXB0IHNpbWN0bCBjb21tYW5kcywgbGlrZSAnaW5zdGFsbCcuXG4gICAqL1xuICBhc3luYyB3YWl0Rm9yQm9vdCAoc3RhcnR1cFRpbWVvdXQpIHtcbiAgICAvLyB3YWl0IGZvciB0aGUgc2ltdWxhdG9yIHRvIGJvb3RcbiAgICAvLyB3YWl0aW5nIGZvciB0aGUgc2ltdWxhdG9yIHN0YXR1cyB0byBiZSAnYm9vdGVkJyBpc24ndCBnb29kIGVub3VnaFxuICAgIC8vIGl0IGNsYWltcyB0byBiZSBib290ZWQgd2F5IGJlZm9yZSBmaW5pc2hpbmcgbG9hZGluZ1xuICAgIC8vIGxldCdzIHRhaWwgdGhlIHNpbXVsYXRvciBzeXN0ZW0gbG9nIHVudGlsIHdlIHNlZSBhIG1hZ2ljIGxpbmUgKHRoaXMuYm9vdGVkSW5kaWNhdG9yKVxuICAgIGxldCBib290ZWRJbmRpY2F0b3IgPSBhd2FpdCB0aGlzLmdldEJvb3RlZEluZGljYXRvclN0cmluZygpO1xuICAgIGF3YWl0IHRoaXMudGFpbExvZ3NVbnRpbChib290ZWRJbmRpY2F0b3IsIHN0YXJ0dXBUaW1lb3V0KTtcblxuICAgIC8vIHNvIHNvcnJ5LCBidXQgd2Ugc2hvdWxkIHdhaXQgYW5vdGhlciB0d28gc2Vjb25kcywganVzdCB0byBtYWtlIHN1cmUgd2UndmUgcmVhbGx5IHN0YXJ0ZWRcbiAgICAvLyB3ZSBjYW4ndCBsb29rIGZvciBhbm90aGVyIG1hZ2ljIGxvZyBsaW5lLCBiZWNhdXNlIHRoZXkgc2VlbSB0byBiZSBhcHAtZGVwZW5kZW50IChub3Qgc3lzdGVtIGRlcGVuZGVudClcbiAgICBsb2cuZGVidWcoYFdhaXRpbmcgYW4gZXh0cmEgJHt0aGlzLmV4dHJhU3RhcnR1cFRpbWV9bXMgZm9yIHRoZSBzaW11bGF0b3IgdG8gcmVhbGx5IGZpbmlzaCBib290aW5nYCk7XG4gICAgYXdhaXQgQi5kZWxheSh0aGlzLmV4dHJhU3RhcnR1cFRpbWUpO1xuICAgIGxvZy5kZWJ1ZygnRG9uZSB3YWl0aW5nIGV4dHJhIHRpbWUgZm9yIHNpbXVsYXRvcicpO1xuXG4gICAgdGhpcy5lbWl0KEJPT1RfQ09NUExFVEVEX0VWRU5UKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgbWFnaWMgc3RyaW5nLCB3aGljaCwgaWYgcHJlc2VudCBpbiBsb2dzLCByZWZsZWN0cyB0aGUgZmFjdCB0aGF0IHNpbXVsYXRvciBib290aW5nIGhhcyBiZWVuIGNvbXBsZXRlZC5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgbWFnaWMgbG9nIHN0cmluZy5cbiAgICovXG4gIGFzeW5jIGdldEJvb3RlZEluZGljYXRvclN0cmluZyAoKSB7XG4gICAgbGV0IGluZGljYXRvcjtcbiAgICBsZXQgcGxhdGZvcm1WZXJzaW9uID0gYXdhaXQgdGhpcy5nZXRQbGF0Zm9ybVZlcnNpb24oKTtcbiAgICBzd2l0Y2ggKHBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgY2FzZSAnNy4xJzpcbiAgICAgIGNhc2UgJzguMSc6XG4gICAgICBjYXNlICc4LjInOlxuICAgICAgY2FzZSAnOC4zJzpcbiAgICAgIGNhc2UgJzguNCc6XG4gICAgICAgIGluZGljYXRvciA9ICdwcm9maWxlZDogU2VydmljZSBzdGFydGluZy4uLic7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnOS4wJzpcbiAgICAgIGNhc2UgJzkuMSc6XG4gICAgICBjYXNlICc5LjInOlxuICAgICAgY2FzZSAnOS4zJzpcbiAgICAgICAgaW5kaWNhdG9yID0gJ1N5c3RlbSBhcHAgXCJjb20uYXBwbGUuc3ByaW5nYm9hcmRcIiBmaW5pc2hlZCBzdGFydHVwJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICcxMC4wJzpcbiAgICAgICAgaW5kaWNhdG9yID0gJ1N3aXRjaGluZyB0byBrZXlib2FyZCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbG9nLndhcm4oYE5vIGJvb3QgaW5kaWNhdG9yIGNhc2UgZm9yIHBsYXRmb3JtIHZlcnNpb24gJyR7cGxhdGZvcm1WZXJzaW9ufSdgKTtcbiAgICAgICAgaW5kaWNhdG9yID0gJ25vIGJvb3QgaW5kaWNhdG9yIHN0cmluZyBhdmFpbGFibGUnO1xuICAgIH1cbiAgICByZXR1cm4gaW5kaWNhdG9yO1xuICB9XG5cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gU2ltdWxhdG9yT3B0aW9uc1xuICAgKiBAcHJvcGVydHkgez9zdHJpbmd9IHNjYWxlRmFjdG9yIFtudWxsXSAtIERlZmluZXMgdGhlIHdpbmRvdyBzY2FsZSB2YWx1ZSBmb3IgdGhlIFVJIGNsaWVudCB3aW5kb3cgZm9yIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICogICBFcXVhbHMgdG8gbnVsbCBieSBkZWZhdWx0LCB3aGljaCBrZWVwcyB0aGUgY3VycmVudCBzY2FsZSB1bmNoYW5nZWQuXG4gICAqICAgSXQgc2hvdWxkIGJlIG9uZSBvZiBbJzEuMCcsICcwLjc1JywgJzAuNScsICcwLjMzJywgJzAuMjUnXS5cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IHN0YXJ0dXBUaW1lb3V0IFs2MDAwMF0gLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgU2ltdWxhdG9yIGJvb3RpbmdcbiAgICogICBwcm9jZXNzIGlzIGNvbXBsZXRlZC4gVGhlIGRlZmF1bHQgdGltZW91dCB3aWxsIGJlIHVzZWQgaWYgbm90IHNldCBleHBsaWNpdGx5LlxuICAgKi9cblxuICAvKipcbiAgICogU3RhcnQgdGhlIFNpbXVsYXRvciBVSSBjbGllbnQgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzXG4gICAqIEBwYXJhbSB7U2ltdWxhdG9yT3B0aW9uc30gb3B0cyAtIFNpbXVsYXRvciBzdGFydHVwIG9wdGlvbnNcbiAgICovXG4gIGFzeW5jIHN0YXJ0VUlDbGllbnQgKG9wdHMgPSB7fSkge1xuICAgIG9wdHMgPSBfLmNsb25lRGVlcChvcHRzKTtcbiAgICBfLmRlZmF1bHRzRGVlcChvcHRzLCB7XG4gICAgICBzY2FsZUZhY3RvcjogbnVsbCxcbiAgICAgIHN0YXJ0dXBUaW1lb3V0OiB0aGlzLnN0YXJ0dXBUaW1lb3V0LFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2ltdWxhdG9yQXBwID0gcGF0aC5yZXNvbHZlKGF3YWl0IGdldFhjb2RlUGF0aCgpLCAnQXBwbGljYXRpb25zJywgdGhpcy5zaW11bGF0b3JBcHApO1xuICAgIGNvbnN0IGFyZ3MgPSBbXG4gICAgICAnLUZuJywgc2ltdWxhdG9yQXBwLFxuICAgICAgJy0tYXJncycsICctQ3VycmVudERldmljZVVESUQnLCB0aGlzLnVkaWQsXG4gICAgXTtcblxuICAgIGlmIChvcHRzLnNjYWxlRmFjdG9yKSB7XG4gICAgICBjb25zdCB7bmFtZX0gPSBhd2FpdCB0aGlzLnN0YXQoKTtcbiAgICAgIGNvbnN0IGZvcm1hdHRlZERldmljZU5hbWUgPSBuYW1lLnJlcGxhY2UoL1xccysvZywgJy0nKTtcbiAgICAgIGNvbnN0IGFyZ3VtZW50TmFtZSA9IGAtU2ltdWxhdG9yV2luZG93TGFzdFNjYWxlLWNvbS5hcHBsZS5Db3JlU2ltdWxhdG9yLlNpbURldmljZVR5cGUuJHtmb3JtYXR0ZWREZXZpY2VOYW1lfWA7XG4gICAgICBhcmdzLnB1c2goYXJndW1lbnROYW1lLCBvcHRzLnNjYWxlRmFjdG9yKTtcbiAgICB9XG5cbiAgICBsb2cuaW5mbyhgU3RhcnRpbmcgU2ltdWxhdG9yIFVJIHdpdGggY29tbWFuZDogb3BlbiAke2FyZ3Muam9pbignICcpfWApO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBleGVjKCdvcGVuJywgYXJncywge3RpbWVvdXQ6IG9wdHMuc3RhcnR1cFRpbWVvdXR9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghKGVyci5zdGRvdXQgfHwgJycpLmluY2x1ZGVzKCctMTA4MjUnKSAmJiAhKGVyci5zdGRlcnIgfHwgJycpLmluY2x1ZGVzKCctMTA4MjUnKSkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICBsb2cud2FybihgRXJyb3Igd2hpbGUgb3BlbmluZyBVSTogJHtlcnIuc3Rkb3V0IHx8IGVyci5zdGRlcnJ9LiBDb250aW51aW5nYCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGVzIGdpdmVuIFNpbXVsYXRvciB3aXRoIG9wdGlvbnMuIFRoZSBTaW11bGF0b3Igd2lsbCBub3QgYmUgcmVzdGFydGVkIGlmXG4gICAqIGl0IGlzIGFscmVhZHkgcnVubmluZy5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdHMgLSBPbmUgb3IgbW9yZSBvZiBhdmFpbGFibGUgU2ltdWxhdG9yIG9wdGlvbnMuXG4gICAqICAgU2VlIHsjc3RhcnRVSUNsaWVudChvcHRzKX0gZG9jdW1lbnRhdGlvbiBmb3IgbW9yZSBkZXRhaWxzIG9uIG90aGVyIHN1cHBvcnRlZCBrZXlzLlxuICAgKi9cbiAgYXN5bmMgcnVuIChvcHRzID0ge30pIHtcbiAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7XG4gICAgICBzdGFydHVwVGltZW91dDogdGhpcy5zdGFydHVwVGltZW91dCxcbiAgICB9LCBvcHRzKTtcbiAgICBjb25zdCBpc1NlcnZlclJ1bm5pbmcgPSBhd2FpdCB0aGlzLmlzUnVubmluZygpO1xuICAgIGNvbnN0IGlzVUlDbGllbnRSdW5uaW5nID0gYXdhaXQgdGhpcy5pc1VJQ2xpZW50UnVubmluZygpO1xuICAgIGlmIChpc1NlcnZlclJ1bm5pbmcgJiYgaXNVSUNsaWVudFJ1bm5pbmcpIHtcbiAgICAgIGxvZy5pbmZvKGBCb3RoIFNpbXVsYXRvciB3aXRoIFVESUQgJHt0aGlzLnVkaWR9IGFuZCB0aGUgVUkgY2xpZW50IGFyZSBjdXJyZW50bHkgcnVubmluZ2ApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0aW1lciA9IG5ldyB0aW1pbmcuVGltZXIoKS5zdGFydCgpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnNodXRkb3duKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgRXJyb3Igb24gU2ltdWxhdG9yIHNodXRkb3duOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLnN0YXJ0VUlDbGllbnQob3B0cyk7XG5cbiAgICBhd2FpdCB0aGlzLndhaXRGb3JCb290KG9wdHMuc3RhcnR1cFRpbWVvdXQpO1xuICAgIGxvZy5pbmZvKGBTaW11bGF0b3Igd2l0aCBVRElEICR7dGhpcy51ZGlkfSBib290ZWQgaW4gJHt0aW1lci5nZXREdXJhdGlvbigpLmFzU2Vjb25kcy50b0ZpeGVkKDMpfXNgKTtcbiAgfVxuXG4gIC8vIFRPRE8ga2VlcCBrZXljaGFpbnNcbiAgLyoqXG4gICAqIFJlc2V0IHRoZSBjdXJyZW50IFNpbXVsYXRvciB0byB0aGUgY2xlYW4gc3RhdGUuXG4gICAqL1xuICBhc3luYyBjbGVhbiAoKSB7XG4gICAgYXdhaXQgdGhpcy5lbmRTaW11bGF0b3JEYWVtb24oKTtcbiAgICBsb2cuaW5mbyhgQ2xlYW5pbmcgc2ltdWxhdG9yICR7dGhpcy51ZGlkfWApO1xuICAgIGF3YWl0IHRoaXMuc2ltY3RsLmVyYXNlRGV2aWNlKDEwMDAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTY3J1YiAoZGVsZXRlIHRoZSBwcmVmZXJlbmNlcyBhbmQgY2hhbmdlZCBmaWxlcykgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gb24gU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwRmlsZSAtIEFwcGxpY2F0aW9uIG5hbWUgbWludXMgXCIuYXBwXCIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBCdW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICovXG4gIGFzeW5jIHNjcnViQ3VzdG9tQXBwIChhcHBGaWxlLCBhcHBCdW5kbGVJZCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNsZWFuQ3VzdG9tQXBwKGFwcEZpbGUsIGFwcEJ1bmRsZUlkLCB0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbi9zY3J1YiB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBvbiBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBGaWxlIC0gQXBwbGljYXRpb24gbmFtZSBtaW51cyBcIi5hcHBcIi5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNjcnViIC0gSWYgYHNjcnViYCBpcyBmYWxzZSwgd2Ugd2FudCB0byBjbGVhbiBieSBkZWxldGluZyB0aGUgYXBwIGFuZCBhbGxcbiAgICogICBmaWxlcyBhc3NvY2lhdGVkIHdpdGggaXQuIElmIGBzY3J1YmAgaXMgdHJ1ZSwgd2UganVzdCB3YW50IHRvIGRlbGV0ZSB0aGUgcHJlZmVyZW5jZXMgYW5kXG4gICAqICAgY2hhbmdlZCBmaWxlcy5cbiAgICovXG4gIGFzeW5jIGNsZWFuQ3VzdG9tQXBwIChhcHBGaWxlLCBhcHBCdW5kbGVJZCwgc2NydWIgPSBmYWxzZSkge1xuICAgIGxvZy5kZWJ1ZyhgQ2xlYW5pbmcgYXBwIGRhdGEgZmlsZXMgZm9yICcke2FwcEZpbGV9JywgJyR7YXBwQnVuZGxlSWR9J2ApO1xuICAgIGlmICghc2NydWIpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgRGVsZXRpbmcgYXBwIGFsdG9nZXRoZXJgKTtcbiAgICB9XG5cbiAgICAvLyBnZXQgdGhlIGRpcmVjdG9yaWVzIHRvIGJlIGRlbGV0ZWRcbiAgICBsZXQgYXBwRGlycyA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlycyhhcHBGaWxlLCBhcHBCdW5kbGVJZCwgc2NydWIpO1xuXG4gICAgaWYgKGFwcERpcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICBsb2cuZGVidWcoJ0NvdWxkIG5vdCBmaW5kIGFwcCBkaXJlY3RvcmllcyB0byBkZWxldGUuIEl0IGlzIHByb2JhYmx5IG5vdCBpbnN0YWxsZWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcblxuICAgIGZvciAobGV0IGRpciBvZiBhcHBEaXJzKSB7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGRpcmVjdG9yeTogJyR7ZGlyfSdgKTtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKGRpcikpO1xuICAgIH1cblxuICAgIGlmIChhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpID49IDgpIHtcbiAgICAgIGxldCByZWxSbVBhdGggPSBgTGlicmFyeS9QcmVmZXJlbmNlcy8ke2FwcEJ1bmRsZUlkfS5wbGlzdGA7XG4gICAgICBsZXQgcm1QYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0Um9vdERpcigpLCByZWxSbVBhdGgpO1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBmaWxlOiAnJHtybVBhdGh9J2ApO1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocm1QYXRoKSk7XG4gICAgfVxuXG4gICAgYXdhaXQgQi5hbGwoZGVsZXRlUHJvbWlzZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHBhdGhzIHRvIGRpcnMgd2hlcmUgYXBwbGljYXRpb24gZGF0YSBpcyBzdG9yZWQuIGlPUyA4KyBzdG9yZXMgYXBwIGRhdGEgaW4gdHdvIHBsYWNlcyxcbiAgICogYW5kIGlPUyA3LjEgaGFzIG9ubHkgb25lIGRpcmVjdG9yeVxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwRmlsZSAtIEFwcGxpY2F0aW9uIG5hbWUgbWludXMgXCIuYXBwXCIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBCdW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICogQHBhcmFtIHtib29sZWFufSBzY3J1YiAtIFRoZSBgQnVuZGxlYCBkaXJlY3RvcnkgaGFzIHRoZSBhY3R1YWwgYXBwIGluIGl0LiBJZiB3ZSBhcmUganVzdCBzY3J1YmJpbmcsXG4gICAqICAgd2Ugd2FudCB0aGlzIHRvIHN0YXkuIElmIHdlIGFyZSBjbGVhbmluZyB3ZSBkZWxldGUuXG4gICAqIEByZXR1cm4ge2FycmF5PHN0cmluZz59IEFycmF5IG9mIGFwcGxpY2F0aW9uIGRhdGEgcGF0aHMuXG4gICAqL1xuICBhc3luYyBnZXRBcHBEaXJzIChhcHBGaWxlLCBhcHBCdW5kbGVJZCwgc2NydWIgPSBmYWxzZSkge1xuICAgIGxldCBkaXJzID0gW107XG4gICAgaWYgKGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCkgPj0gOCkge1xuICAgICAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmdldEFwcERpcihhcHBCdW5kbGVJZCk7XG4gICAgICBpZiAoIWRhdGEpIHJldHVybiBkaXJzOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgICAgIGxldCBidW5kbGUgPSAhc2NydWIgPyBhd2FpdCB0aGlzLmdldEFwcERpcihhcHBCdW5kbGVJZCwgJ0J1bmRsZScpIDogdW5kZWZpbmVkO1xuXG4gICAgICBmb3IgKGxldCBzcmMgb2YgW2RhdGEsIGJ1bmRsZV0pIHtcbiAgICAgICAgaWYgKHNyYykge1xuICAgICAgICAgIGRpcnMucHVzaChzcmMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBkYXRhID0gYXdhaXQgdGhpcy5nZXRBcHBEaXIoYXBwRmlsZSk7XG4gICAgICBpZiAoZGF0YSkge1xuICAgICAgICBkaXJzLnB1c2goZGF0YSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkaXJzO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgdGhlIFNpbXVsYXRvciBpbiBvcmRlciB0byBoYXZlIHRoZSBpbml0aWFsIGZpbGUgc3RydWN0dXJlIGNyZWF0ZWQgYW5kIHNodXRkb3duIGl0IGFmdGVyd2FyZHMuXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2FmYXJpIC0gV2hldGhlciB0byBleGVjdXRlIG1vYmlsZSBTYWZhcmkgYWZ0ZXIgc3RhcnR1cC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0dXBUaW1lb3V0IC0gSG93IGxvbmcgdG8gd2FpdCB1bnRpbCBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQgKGluIG1pbGxpc2Vjb25kcykuXG4gICAqL1xuICBhc3luYyBsYXVuY2hBbmRRdWl0IChzYWZhcmkgPSBmYWxzZSwgc3RhcnR1cFRpbWVvdXQgPSB0aGlzLnN0YXJ0dXBUaW1lb3V0KSB7XG4gICAgbG9nLmRlYnVnKCdBdHRlbXB0aW5nIHRvIGxhdW5jaCBhbmQgcXVpdCB0aGUgc2ltdWxhdG9yLCB0byBjcmVhdGUgZGlyZWN0b3J5IHN0cnVjdHVyZScpO1xuICAgIGxvZy5kZWJ1ZyhgV2lsbCBsYXVuY2ggd2l0aCBTYWZhcmk/ICR7c2FmYXJpfWApO1xuXG4gICAgYXdhaXQgdGhpcy5ydW4oe3N0YXJ0dXBUaW1lb3V0fSk7XG5cbiAgICBpZiAoc2FmYXJpKSB7XG4gICAgICBhd2FpdCB0aGlzLm9wZW5VcmwoJ2h0dHA6Ly93d3cuYXBwaXVtLmlvJyk7XG4gICAgfVxuXG4gICAgLy8gd2FpdCBmb3IgdGhlIHN5c3RlbSB0byBjcmVhdGUgdGhlIGZpbGVzIHdlIHdpbGwgbWFuaXB1bGF0ZVxuICAgIC8vIG5lZWQgcXVpdGUgYSBoaWdoIHJldHJ5IG51bWJlciwgaW4gb3JkZXIgdG8gYWNjb21tb2RhdGUgaU9TIDcuMVxuICAgIC8vIGxvY2FsbHksIDcuMSBhdmVyYWdlcyA4LjUgcmV0cmllcyAoZnJvbSA2IC0gMTIpXG4gICAgLy8gICAgICAgICAgOCBhdmVyYWdlcyAwLjYgcmV0cmllcyAoZnJvbSAwIC0gMilcbiAgICAvLyAgICAgICAgICA5IGF2ZXJhZ2VzIDE0IHJldHJpZXNcbiAgICB0cnkge1xuICAgICAgYXdhaXQgcmV0cnlJbnRlcnZhbCg2MCwgMjUwLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmIChhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2ltdWxhdG9yIGZpbGVzIG5vdCBmdWxseSBjcmVhdGVkLiBXYWl0aW5nIGEgYml0Jyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYFRpbWVvdXQgd2FpdGluZyBmb3Igc2ltdWxhdG9yIGZpbGVzIHRvIGJlIGNyZWF0ZWQuIENvbnRpbnVpbmdgKTtcbiAgICB9XG5cbiAgICAvLyBhbmQgcXVpdFxuICAgIGF3YWl0IHRoaXMuc2h1dGRvd24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb29rcyBmb3IgbGF1bmNoZCBkYWVtb25zIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHNpbSB1ZGlkIGFuZCB0cmllcyB0byBzdG9wIHRoZW0gY2xlYW5seVxuICAgKiBUaGlzIHByZXZlbnRzIHhjcnVuIHNpbWN0bCBlcmFzZSBmcm9tIGhhbmdpbmcuXG4gICAqL1xuICBhc3luYyBlbmRTaW11bGF0b3JEYWVtb24gKCkge1xuICAgIGxvZy5kZWJ1ZyhgS2lsbGluZyBhbnkgc2ltdWxhdG9yIGRhZW1vbnMgZm9yICR7dGhpcy51ZGlkfWApO1xuXG4gICAgbGV0IGxhdW5jaGN0bENtZCA9IGBsYXVuY2hjdGwgbGlzdCB8IGdyZXAgJHt0aGlzLnVkaWR9IHwgY3V0IC1mIDMgfCB4YXJncyAtbiAxIGxhdW5jaGN0bGA7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBzdG9wQ21kID0gYCR7bGF1bmNoY3RsQ21kfSBzdG9wYDtcbiAgICAgIGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJywgc3RvcENtZF0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCBzdG9wIHNpbXVsYXRvciBkYWVtb25zOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgbG9nLmRlYnVnKCdDYXJyeWluZyBvbiBhbnl3YXkhJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBsZXQgcmVtb3ZlQ21kID0gYCR7bGF1bmNoY3RsQ21kfSByZW1vdmVgO1xuICAgICAgYXdhaXQgZXhlYygnYmFzaCcsIFsnLWMnLCByZW1vdmVDbWRdKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBDb3VsZCBub3QgcmVtb3ZlIHNpbXVsYXRvciBkYWVtb25zOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgbG9nLmRlYnVnKCdDYXJyeWluZyBvbiBhbnl3YXkhJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAvLyBXYWl0cyAxMCBzZWMgZm9yIHRoZSBzaW11bGF0b3IgbGF1bmNoZCBzZXJ2aWNlcyB0byBzdG9wLlxuICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJyxcbiAgICAgICAgICBgcHMgLWUgIHwgZ3JlcCAke3RoaXMudWRpZH0gfCBncmVwIGxhdW5jaGRfc2ltIHwgZ3JlcCAtdiBiYXNoIHwgZ3JlcCAtdiBncmVwIHwgYXdrIHsncHJpbnQkMSd9YF0pO1xuICAgICAgICByZXR1cm4gc3Rkb3V0LnRyaW0oKS5sZW5ndGggPT09IDA7XG4gICAgICB9LCB7d2FpdE1zOiAxMDAwMCwgaW50ZXJ2YWxNczogNTAwfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgQ291bGQgbm90IGVuZCBzaW11bGF0b3IgZGFlbW9uIGZvciAke3RoaXMudWRpZH06ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2cuZGVidWcoJ0NhcnJ5aW5nIG9uIGFueXdheSEnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gU2h1dGRvd25PcHRpb25zXG4gICAqIEBwcm9wZXJ0eSB7P251bWJlcnxzdHJpbmd9IHRpbWVvdXQgVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbFxuICAgKiBTaW11bGF0b3IgaXMgc2h1dCBkb3duIGNvbXBsZXRlbHkuIE5vIHdhaXQgaGFwcGVucyBpZiB0aGUgdGltZW91dCB2YWx1ZSBpcyBub3Qgc2V0XG4gICAqL1xuXG4gIC8qKlxuICAgKiBTaHV0IGRvd24gdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0gez9TaHV0ZG93bk9wdGlvbnN9IG9wdHNcbiAgICogQHRocm93cyB7RXJyb3J9IElmIFNpbXVsYXRvciBmYWlscyB0byB0cmFuc2l0aW9uIGludG8gU2h1dGRvd24gc3RhdGUgYWZ0ZXJcbiAgICogdGhlIGdpdmVuIHRpbWVvdXRcbiAgICovXG4gIGFzeW5jIHNodXRkb3duIChvcHRzID0ge30pIHtcbiAgICBpZiAoYXdhaXQgdGhpcy5pc1NodXRkb3duKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBhd2FpdCByZXRyeUludGVydmFsKDUsIDUwMCwgdGhpcy5zaW1jdGwuc2h1dGRvd25EZXZpY2UuYmluZCh0aGlzLnNpbWN0bCkpO1xuICAgIGNvbnN0IHdhaXRNcyA9IHBhcnNlSW50KG9wdHMudGltZW91dCwgMTApO1xuICAgIGlmICh3YWl0TXMgPiAwKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IGF3YWl0IHRoaXMuaXNTaHV0ZG93bigpLCB7XG4gICAgICAgICAgd2FpdE1zLFxuICAgICAgICAgIGludGVydmFsTXM6IDEwMCxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTaW11bGF0b3IgaXMgbm90IGluICdTaHV0ZG93bicgc3RhdGUgYWZ0ZXIgJHt3YWl0TXN9bXNgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIHRoZSBwYXJ0aWN1bGFyIFNpbXVsYXRvciBmcm9tIGRldmljZXMgbGlzdFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlICgpIHtcbiAgICBhd2FpdCB0aGlzLnNpbWN0bC5kZWxldGVEZXZpY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHBhcnRpY3VsYXIgcHJlZmVyZW5jZSBmaWxlIHdpdGggdGhlIGdpdmVuIGtleS92YWx1ZSBwYWlycy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBsaXN0IC0gVGhlIHByZWZlcmVuY2VzIGZpbGUgdG8gdXBkYXRlLlxuICAgKiBAcGFyYW0ge29iamVjdH0gdXBkYXRlcyAtIFRoZSBrZXkvdmFsdWUgcGFpcnMgdG8gdXBkYXRlLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlU2V0dGluZ3MgKHBsaXN0LCB1cGRhdGVzKSB7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZVNldHRpbmdzKHRoaXMsIHBsaXN0LCB1cGRhdGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdXRob3JpemUvZGUtYXV0aG9yaXplIGxvY2F0aW9uIHNldHRpbmdzIGZvciBhIHBhcnRpY3VsYXIgYXBwbGljYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBhcHBsaWNhdGlvbiBJRCB0byB1cGRhdGUuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gYXV0aG9yaXplZCAtIFdoZXRoZXIgb3Igbm90IHRvIGF1dGhvcml6ZS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZUxvY2F0aW9uU2V0dGluZ3MgKGJ1bmRsZUlkLCBhdXRob3JpemVkKSB7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZUxvY2F0aW9uU2V0dGluZ3ModGhpcywgYnVuZGxlSWQsIGF1dGhvcml6ZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuYWJsZS9EaXNhYmxlIHJlZHVjZSBtb3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gcmVkdWNlTW90aW9uIC0gV2hldGhlciBvciBub3QgdG8gZW5hYmxlIGl0LlxuICAgKi9cbiAgYXN5bmMgc2V0UmVkdWNlTW90aW9uIChyZWR1Y2VNb3Rpb24gPSB0cnVlKSB7XG4gICAgaWYgKGF3YWl0IHRoaXMuaXNGcmVzaCgpKSB7XG4gICAgICBhd2FpdCB0aGlzLmxhdW5jaEFuZFF1aXQoZmFsc2UsIFNUQVJUVVBfVElNRU9VVCk7XG4gICAgfVxuXG4gICAgYXdhaXQgc2V0dGluZ3Muc2V0UmVkdWNlTW90aW9uKHRoaXMsIHJlZHVjZU1vdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyBVSSBhcHBlYXJhbmNlIHN0eWxlLlxuICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiBhIGJvb3RlZCBzaW11bGF0b3IuXG4gICAqXG4gICAqIEBzaW5jZSBYY29kZSBTREsgMTEuNFxuICAgKi9cbiAgYXN5bmMgc2V0QXBwZWFyYW5jZSAoLyogdmFsdWUgKi8pIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBYY29kZSBTREsgJyR7dGhpcy54Y29kZVZlcnNpb259JyBpcyB0b28gb2xkIHRvIHNldCBVSSBhcHBlYXJhbmNlYCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgY3VycmVudCBVSSBhcHBlYXJhbmNlIHN0eWxlXG4gICAqIFRoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uIGEgYm9vdGVkIHNpbXVsYXRvci5cbiAgICpcbiAgICogQHNpbmNlIFhjb2RlIFNESyAxMS40XG4gICAqL1xuICBhc3luYyBnZXRBcHBlYXJhbmNlICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBYY29kZSBTREsgJyR7dGhpcy54Y29kZVZlcnNpb259JyBpcyB0b28gb2xkIHRvIGdldCBVSSBhcHBlYXJhbmNlYCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNldHRpbmdzIGZvciBTYWZhcmkuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB1cGRhdGVzIC0gVGhlIGhhc2ggb2Yga2V5L3ZhbHVlIHBhaXJzIHRvIHVwZGF0ZSBmb3IgU2FmYXJpLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlU2FmYXJpU2V0dGluZ3MgKHVwZGF0ZXMpIHtcbiAgICBsZXQgdXBkYXRlZCA9IGF3YWl0IHNldHRpbmdzLnVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncyh0aGlzLCB1cGRhdGVzKTtcbiAgICByZXR1cm4gYXdhaXQgc2V0dGluZ3MudXBkYXRlU2V0dGluZ3ModGhpcywgJ21vYmlsZVNhZmFyaScsIHVwZGF0ZXMpIHx8IHVwZGF0ZWQ7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGdsb2JhbCBzZXR0aW5ncyBmb3IgU2FmYXJpLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gdXBkYXRlcyAtIFRoZSBoYXNoIG9mIGtleS92YWx1ZSBwYWlycyB0byB1cGRhdGUgZm9yIFNhZmFyaS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNhZmFyaUdsb2JhbFNldHRpbmdzICh1cGRhdGVzKSB7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZVNhZmFyaUdsb2JhbFNldHRpbmdzKHRoaXMsIHVwZGF0ZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgbG9jYWxlIGZvciB0aGUgU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2UgLSBUaGUgbGFuZ3VhZ2UgZm9yIHRoZSBzaW11bGF0b3IuIEUuZy4sIGBcImZyX1VTXCJgLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbG9jYWxlIC0gVGhlIGxvY2FsZSB0byBzZXQgZm9yIHRoZSBzaW11bGF0b3IuIEUuZy4sIGBcImVuXCJgLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gY2FsZW5kYXJGb3JtYXQgLSBUaGUgZm9ybWF0IG9mIHRoZSBjYWxlbmRhci5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZUxvY2FsZSAobGFuZ3VhZ2UsIGxvY2FsZSwgY2FsZW5kYXJGb3JtYXQpIHtcbiAgICByZXR1cm4gYXdhaXQgc2V0dGluZ3MudXBkYXRlTG9jYWxlKHRoaXMsIGxhbmd1YWdlLCBsb2NhbGUsIGNhbGVuZGFyRm9ybWF0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wbGV0ZWx5IGRlbGV0ZSBtb2JpbGUgU2FmYXJpIGFwcGxpY2F0aW9uIGZyb20gdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKi9cbiAgYXN5bmMgZGVsZXRlU2FmYXJpICgpIHtcbiAgICBsb2cuZGVidWcoJ0RlbGV0aW5nIFNhZmFyaSBhcHBzIGZyb20gc2ltdWxhdG9yJyk7XG5cbiAgICBsZXQgZGlycyA9IFtdO1xuXG4gICAgLy8gZ2V0IHRoZSBkYXRhIGRpcmVjdG9yeVxuICAgIGRpcnMucHVzaChhd2FpdCB0aGlzLmdldEFwcERpcignY29tLmFwcGxlLm1vYmlsZXNhZmFyaScpKTtcblxuICAgIGxldCBwdiA9IGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG4gICAgaWYgKHB2ID49IDgpIHtcbiAgICAgIC8vIGdldCB0aGUgYnVuZGxlIGRpcmVjdG9yeVxuICAgICAgZGlycy5wdXNoKGF3YWl0IHRoaXMuZ2V0QXBwRGlyKCdjb20uYXBwbGUubW9iaWxlc2FmYXJpJywgJ0J1bmRsZScpKTtcbiAgICB9XG5cbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcbiAgICBmb3IgKGxldCBkaXIgb2YgXy5jb21wYWN0KGRpcnMpKSB7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGRpcmVjdG9yeTogJyR7ZGlyfSdgKTtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKGRpcikpO1xuICAgIH1cbiAgICBhd2FpdCBCLmFsbChkZWxldGVQcm9taXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4gdXAgdGhlIGRpcmVjdG9yaWVzIGZvciBtb2JpbGUgU2FmYXJpLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGtlZXBQcmVmcyAtIFdoZXRoZXIgdG8ga2VlcCBTYWZhcmkgcHJlZmVyZW5jZXMgZnJvbSBiZWluZyBkZWxldGVkLlxuICAgKi9cbiAgYXN5bmMgY2xlYW5TYWZhcmkgKGtlZXBQcmVmcyA9IHRydWUpIHtcbiAgICBsb2cuZGVidWcoJ0NsZWFuaW5nIG1vYmlsZSBzYWZhcmkgZGF0YSBmaWxlcycpO1xuICAgIGlmIChhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgbG9nLmluZm8oJ0NvdWxkIG5vdCBmaW5kIFNhZmFyaSBzdXBwb3J0IGRpcmVjdG9yaWVzIHRvIGNsZWFuIG91dCBvbGQgJyArXG4gICAgICAgICAgICAgICAnZGF0YS4gUHJvYmFibHkgdGhlcmUgaXMgbm90aGluZyB0byBjbGVhbiBvdXQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgbGlicmFyeURpciA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnTGlicmFyeScpO1xuICAgIGxldCBzYWZhcmlSb290ID0gYXdhaXQgdGhpcy5nZXRBcHBEaXIoJ2NvbS5hcHBsZS5tb2JpbGVzYWZhcmknKTtcbiAgICBpZiAoIXNhZmFyaVJvb3QpIHtcbiAgICAgIGxvZy5pbmZvKCdDb3VsZCBub3QgZmluZCBTYWZhcmkgc3VwcG9ydCBkaXJlY3RvcmllcyB0byBjbGVhbiBvdXQgb2xkICcgK1xuICAgICAgICAgICAgICAgJ2RhdGEuIFByb2JhYmx5IHRoZXJlIGlzIG5vdGhpbmcgdG8gY2xlYW4gb3V0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBzYWZhcmlMaWJyYXJ5RGlyID0gcGF0aC5yZXNvbHZlKHNhZmFyaVJvb3QsICdMaWJyYXJ5Jyk7XG4gICAgbGV0IGZpbGVzVG9EZWxldGUgPSBbXG4gICAgICAnQ2FjaGVzL1NuYXBzaG90cy9jb20uYXBwbGUubW9iaWxlc2FmYXJpJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLm1vYmlsZXNhZmFyaS8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLldlYkFwcENhY2hlLyonLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuV2ViS2l0Lk5ldHdvcmtpbmcvKicsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5XZWJLaXQuV2ViQ29udGVudC8qJyxcbiAgICAgICdJbWFnZSBDYWNoZS8qJyxcbiAgICAgICdXZWJLaXQvY29tLmFwcGxlLm1vYmlsZXNhZmFyaS8qJyxcbiAgICAgICdXZWJLaXQvR2VvbG9jYXRpb25TaXRlcy5wbGlzdCcsXG4gICAgICAnV2ViS2l0L0xvY2FsU3RvcmFnZS8qLionLFxuICAgICAgJ1NhZmFyaS8qJyxcbiAgICAgICdDb29raWVzLyouYmluYXJ5Y29va2llcycsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5VSVN0YXR1c0Jhci8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLmtleWJvYXJkcy9pbWFnZXMvKicsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5TYWZhcmkuU2FmZUJyb3dzaW5nLyonLFxuICAgICAgJy4uL3RtcC9jb20uYXBwbGUubW9iaWxlc2FmYXJpLyonXG4gICAgXTtcbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcblxuICAgIGZvciAobGV0IGZpbGUgb2YgZmlsZXNUb0RlbGV0ZSkge1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKGxpYnJhcnlEaXIsIGZpbGUpKSk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihwYXRoLnJlc29sdmUoc2FmYXJpTGlicmFyeURpciwgZmlsZSkpKTtcbiAgICB9XG5cbiAgICBpZiAoIWtlZXBQcmVmcykge1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKHNhZmFyaUxpYnJhcnlEaXIsICdQcmVmZXJlbmNlcy8qLnBsaXN0JykpKTtcbiAgICB9XG5cbiAgICBhd2FpdCBCLmFsbChkZWxldGVQcm9taXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogVW5pbnN0YWxsIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBmcm9tIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1aW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uIHRvIGJlIHJlbW92ZWQuXG4gICAqL1xuICBhc3luYyByZW1vdmVBcHAgKGJ1bmRsZUlkKSB7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwucmVtb3ZlQXBwKGJ1bmRsZUlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIGEgYnVpbHQtaW4gYXBwbGljYXRpb24gdG8gYSBuZXcgcGxhY2UgKGFjdHVhbGx5LCByZW5hbWUgaXQpLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBhcHAgdG8gYmUgbW92ZWQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGN1cnJlbnQgcGF0aCB0byB0aGUgYXBwbGljYXRpb24uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuZXdBcHBQYXRoIC0gVGhlIG5ldyBwYXRoIHRvIHRoZSBhcHBsaWNhdGlvbi5cbiAgICogICBJZiBzb21lIGFwcGxpY2F0aW9uIGFscmVhZHkgZXhpc3RzIGJ5IHRoaXMgcGF0aCB0aGVuIGl0J3MgZ29pbmcgdG8gYmUgcmVtb3ZlZC5cbiAgICovXG4gIGFzeW5jIG1vdmVCdWlsdEluQXBwIChhcHBOYW1lLCBhcHBQYXRoLCBuZXdBcHBQYXRoKSB7XG4gICAgYXdhaXQgc2FmZVJpbVJhZihuZXdBcHBQYXRoKTtcbiAgICBhd2FpdCBmcy5jb3B5RmlsZShhcHBQYXRoLCBuZXdBcHBQYXRoKTtcbiAgICBsb2cuZGVidWcoYENvcGllZCAnJHthcHBOYW1lfScgdG8gJyR7bmV3QXBwUGF0aH0nYCk7XG5cbiAgICBhd2FpdCBmcy5yaW1yYWYoYXBwUGF0aCk7XG4gICAgbG9nLmRlYnVnKGBUZW1wb3JhcmlseSBkZWxldGVkIG9yaWdpbmFsIGFwcCBhdCAnJHthcHBQYXRofSdgKTtcblxuICAgIHJldHVybiBbbmV3QXBwUGF0aCwgYXBwUGF0aF07XG4gIH1cblxuICAvKipcbiAgICogT3BlbiB0aGUgZ2l2ZW4gVVJMIGluIG1vYmlsZSBTYWZhcmkgYnJvd3Nlci5cbiAgICogVGhlIGJyb3dzZXIgd2lsbCBiZSBzdGFydGVkIGF1dG9tYXRpY2FsbHkgaWYgaXQgaXMgbm90IHJ1bm5pbmcuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIHRvIGJlIG9wZW5lZC5cbiAgICovXG4gIGFzeW5jIG9wZW5VcmwgKHVybCkge1xuICAgIGNvbnN0IFNBRkFSSV9CT09URURfSU5ESUNBVE9SID0gJ01vYmlsZVNhZmFyaVsnO1xuICAgIGNvbnN0IFNBRkFSSV9TVEFSVFVQX1RJTUVPVVQgPSAxNSAqIDEwMDA7XG4gICAgY29uc3QgRVhUUkFfU1RBUlRVUF9USU1FID0gMyAqIDEwMDA7XG5cbiAgICBpZiAoYXdhaXQgdGhpcy5pc1J1bm5pbmcoKSkge1xuICAgICAgYXdhaXQgcmV0cnkoNTAwMCwgdGhpcy5zaW1jdGwub3BlblVybC5iaW5kKHRoaXMuc2ltY3RsKSwgdXJsKTtcbiAgICAgIGF3YWl0IHRoaXMudGFpbExvZ3NVbnRpbChTQUZBUklfQk9PVEVEX0lORElDQVRPUiwgU0FGQVJJX1NUQVJUVVBfVElNRU9VVCk7XG4gICAgICAvLyBTbyBzb3JyeSwgYnV0IHRoZSBsb2dzIGhhdmUgbm90aGluZyBlbHNlIGZvciBTYWZhcmkgc3RhcnRpbmcuLiBqdXN0IGRlbGF5IGEgbGl0dGxlIGJpdFxuICAgICAgbG9nLmRlYnVnKGBTYWZhcmkgc3RhcnRlZCwgd2FpdGluZyAke0VYVFJBX1NUQVJUVVBfVElNRX1tcyBmb3IgaXQgdG8gZnVsbHkgc3RhcnRgKTtcbiAgICAgIGF3YWl0IEIuZGVsYXkoRVhUUkFfU1RBUlRVUF9USU1FKTtcbiAgICAgIGxvZy5kZWJ1ZygnRG9uZSB3YWl0aW5nIGZvciBTYWZhcmknKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmllZCB0byBvcGVuIGEgdXJsLCBidXQgdGhlIFNpbXVsYXRvciBpcyBub3QgQm9vdGVkJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm0gU2ltdWxhdG9yIGNhY2hlcyBjbGVhbnVwLlxuICAgKlxuICAgKiBAcGFyYW0gey4uLnN0cmluZ30gZm9sZGVyTmFtZXMgLSBUaGUgbmFtZXMgb2YgQ2FjaGVzIHN1YmZvbGRlcnMgdG8gYmUgY2xlYW5lZC5cbiAgICogICBOb24tYWNjZXNzaWJsZS9ub24tZXhpc3Rpbmcgc3ViZm9sZGVycyB3aWxsIGJlIHNraXBwZWQuXG4gICAqICAgQWxsIGV4aXN0aW5nIHN1YmZvbGRlcnMgdW5kZXIgQ2FjaGVzIHdpbGwgYmUgZGVsZXRlZCBpZiB0aGlzIHBhcmFtZXRlciBpcyBvbWl0dGVkLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY291bnQgb2YgY2xlYW5lZCBjYWNoZSBpdGVtcy5cbiAgICogICBaZXJvIGlzIHJldHVybmVkIGlmIG5vIGl0ZW1zIHdlcmUgbWF0Y2hlZCBmb3IgY2xlYW51cCAoZWl0aGVyIG5vdCBhY2Nlc3NpYmxlIG9yIG5vdCBkaXJlY3RvcmllcykuXG4gICAqL1xuICBhc3luYyBjbGVhckNhY2hlcyAoLi4uZm9sZGVyTmFtZXMpIHtcbiAgICBjb25zdCBjYWNoZXNSb290ID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0RGlyKCksICdMaWJyYXJ5JywgJ0NhY2hlcycpO1xuICAgIGlmICghKGF3YWl0IGZzLmhhc0FjY2VzcyhjYWNoZXNSb290KSkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgQ2FjaGVzIHJvb3QgYXQgJyR7Y2FjaGVzUm9vdH0nIGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlLiBOb3RoaW5nIHRvIGRvIHRoZXJlYCk7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBsZXQgaXRlbXNUb1JlbW92ZSA9IGZvbGRlck5hbWVzLmxlbmd0aCA/IGZvbGRlck5hbWVzIDogKGF3YWl0IGZzLnJlYWRkaXIoY2FjaGVzUm9vdCkpO1xuICAgIGl0ZW1zVG9SZW1vdmUgPSBpdGVtc1RvUmVtb3ZlLm1hcCgoeCkgPT4gcGF0aC5yZXNvbHZlKGNhY2hlc1Jvb3QsIHgpKTtcbiAgICBpZiAoZm9sZGVyTmFtZXMubGVuZ3RoKSB7XG4gICAgICBpdGVtc1RvUmVtb3ZlID0gYXdhaXQgQi5maWx0ZXIoaXRlbXNUb1JlbW92ZSwgKHgpID0+IGZzLmhhc0FjY2Vzcyh4KSk7XG4gICAgfVxuICAgIGl0ZW1zVG9SZW1vdmUgPSBhd2FpdCBCLmZpbHRlcihpdGVtc1RvUmVtb3ZlLCBhc3luYyAoeCkgPT4gKGF3YWl0IGZzLnN0YXQoeCkpLmlzRGlyZWN0b3J5KCkpO1xuICAgIGlmICghaXRlbXNUb1JlbW92ZS5sZW5ndGgpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgTm8gU2ltdWxhdG9yIGNhY2hlIGl0ZW1zIGZvciBjbGVhbnVwIHdlcmUgbWF0Y2hlZCBpbiAnJHtjYWNoZXNSb290fSdgKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgTWF0Y2hlZCAke3V0aWwucGx1cmFsaXplKCdzaW11bGF0b3IgY2FjaGUgaXRlbScsIGl0ZW1zVG9SZW1vdmUubGVuZ3RoLCB0cnVlKX0gYCArXG4gICAgICBgZm9yIGNsZWFudXA6ICR7aXRlbXNUb1JlbW92ZX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgQi5hbGwoaXRlbXNUb1JlbW92ZSwgKHgpID0+IGZzLnJpbXJhZih4KSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLndhcm4oYEdvdCBhbiBleGNlcHRpb24gd2hpbGUgY2xlYW5pbmcgU2ltdWxhdG9yIGNhY2hlczogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICAgIHJldHVybiBpdGVtc1RvUmVtb3ZlLmxlbmd0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBCbG9ja3MgdW50aWwgdGhlIGdpdmVuIGluZGljYXRlciBzdHJpbmcgYXBwZWFycyBpbiBTaW11bGF0b3IgbG9ncy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJvb3RlZEluZGljYXRvciAtIFRoZSBtYWdpYyBzdHJpbmcsIHdoaWNoIGFwcGVhcnMgaW4gbG9ncyBhZnRlciBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0TXMgLSBUaGUgbWF4aW11bW0gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGZvciB0aGUgc3RyaW5nIGluZGljYXRvciBwcmVzZW5jZS5cbiAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGlvcyBzaW11bGF0b3IgbG9ncyBvdXRwdXQgYSBsaW5lIG1hdGNoaW5nIGBib290ZWRJbmRpY2F0b3JgXG4gICAqIHRpbWVzIG91dCBhZnRlciB0aW1lb3V0TXNcbiAgICovXG4gIGFzeW5jIHRhaWxMb2dzVW50aWwgKGJvb3RlZEluZGljYXRvciwgdGltZW91dE1zKSB7XG4gICAgbGV0IHNpbUxvZyA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldExvZ0RpcigpLCAnc3lzdGVtLmxvZycpO1xuXG4gICAgLy8gd2UgbmVlZCB0byBtYWtlIHN1cmUgbG9nIGZpbGUgZXhpc3RzIGJlZm9yZSB3ZSBjYW4gdGFpbCBpdFxuICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoMjAwLCAyMDAsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBleGlzdHMgPSBhd2FpdCBmcy5leGlzdHMoc2ltTG9nKTtcbiAgICAgIGlmICghZXhpc3RzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgU2ltdWxhdG9yIGxvZzogJyR7c2ltTG9nfSdgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGxvZy5pbmZvKGBTaW11bGF0b3IgbG9nIGF0ICcke3NpbUxvZ30nYCk7XG4gICAgbG9nLmluZm8oYFRhaWxpbmcgc2ltdWxhdG9yIGxvZ3MgdW50aWwgd2UgZW5jb3VudGVyIHRoZSBzdHJpbmcgXCIke2Jvb3RlZEluZGljYXRvcn1cImApO1xuICAgIGxvZy5pbmZvKGBXZSB3aWxsIHRpbWUgb3V0IGFmdGVyICR7dGltZW91dE1zfW1zYCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRhaWxVbnRpbChzaW1Mb2csIGJvb3RlZEluZGljYXRvciwgdGltZW91dE1zKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5kZWJ1ZygnU2ltdWxhdG9yIHN0YXJ0dXAgdGltZWQgb3V0LiBDb250aW51aW5nIGFueXdheS4nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW5hYmxlIENhbGVuZGFyIGFjY2VzcyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSUQgLSBCdW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uLCBmb3Igd2hpY2ggdGhlIGFjY2VzcyBzaG91bGQgYmUgZ3JhbnRlZC5cbiAgICovXG4gIGFzeW5jIGVuYWJsZUNhbGVuZGFyQWNjZXNzIChidW5kbGVJRCkge1xuICAgIGF3YWl0IHRoaXMuY2FsZW5kYXIuZW5hYmxlQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc2FibGUgQ2FsZW5kYXIgYWNjZXNzIGZvciB0aGUgZ2l2ZW4gYXBwbGljYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJRCAtIEJ1bmRsZSBJRCBvZiB0aGUgYXBwbGljYXRpb24sIGZvciB3aGljaCB0aGUgYWNjZXNzIHNob3VsZCBiZSBkZW5pZWQuXG4gICAqL1xuICBhc3luYyBkaXNhYmxlQ2FsZW5kYXJBY2Nlc3MgKGJ1bmRsZUlEKSB7XG4gICAgYXdhaXQgdGhpcy5jYWxlbmRhci5kaXNhYmxlQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHdoZXRoZXIgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGhhcyBhY2Nlc3MgdG8gQ2FsZW5kYXIuXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGhhcyB0aGUgYWNjZXNzLlxuICAgKi9cbiAgYXN5bmMgaGFzQ2FsZW5kYXJBY2Nlc3MgKGJ1bmRsZUlEKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2FsZW5kYXIuaGFzQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFjdGl2YXRlcyBTaW11bGF0b3Igd2luZG93LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcmV0dXJucyB7P3N0cmluZ30gSWYgdGhlIG1ldGhvZCByZXR1cm5zIGEgc3RyaW5nIHRoZW4gaXQgc2hvdWxkIGJlIGEgdmFsaWQgQXBwbGUgU2NyaXB0IHdoaWNoXG4gICAqIGlzIGFwcGVuZGVkIGJlZm9yZSBlYWNoIFVJIGNsaWVudCBjb21tYW5kIGlzIGV4ZWN1dGVkLiBPdGhlcndpc2UgdGhlIG1ldGhvZCBzaG91bGQgYWN0aXZhdGUgdGhlIHdpbmRvd1xuICAgKiBpdHNlbGYgYW5kIHJldHVybiBub3RoaW5nLlxuICAgKi9cbiAgYXN5bmMgX2FjdGl2YXRlV2luZG93ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgY29uc3QgcGlkID0gYXdhaXQgdGhpcy5nZXRVSUNsaWVudFBpZCgpO1xuICAgIGlmIChwaWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBhY3RpdmF0ZUFwcChwaWQpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cuZGVidWcoZS5zdGRlcnIgfHwgZS5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBzZXQgZnJvbnRtb3N0IHRvIGZhbHNlXG4gICAgICAgICAgc2V0IGZyb250bW9zdCB0byB0cnVlXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGA7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBnaXZlbiBBcHBsZSBTY3JpcHQgaW5zaWRlIGEgY3JpdGljYWwgc2VjdGlvbiwgc28gb3RoZXJcbiAgICogc2Vzc2lvbnMgY2Fubm90IGluZmx1ZW5jZSB0aGUgVUkgY2xpZW50IGF0IHRoZSBzYW1lIHRpbWUuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBsZVNjcmlwdCAtIFRoZSB2YWxpZCBBcHBsZSBTY3JpcHQgc25pcHBldCB0byBiZSBleGVjdXRlZC5cbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgc3Rkb3V0IG91dHB1dCBwcm9kdWNlZCBieSB0aGUgc2NyaXB0LlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgb3Nhc2NyaXB0IHRvb2wgcmV0dXJucyBub24temVybyBleGl0IGNvZGUuXG4gICAqL1xuICBhc3luYyBleGVjdXRlVUlDbGllbnRTY3JpcHQgKGFwcGxlU2NyaXB0KSB7XG4gICAgY29uc3Qgd2luZG93QWN0aXZhdGlvblNjcmlwdCA9IGF3YWl0IHRoaXMuX2FjdGl2YXRlV2luZG93KCk7XG4gICAgY29uc3QgcmVzdWx0U2NyaXB0ID0gYCR7d2luZG93QWN0aXZhdGlvblNjcmlwdCA/IHdpbmRvd0FjdGl2YXRpb25TY3JpcHQgKyAnXFxuJyA6ICcnfSR7YXBwbGVTY3JpcHR9YDtcbiAgICBsb2cuZGVidWcoYEV4ZWN1dGluZyBVSSBBcHBsZSBTY3JpcHQgb24gU2ltdWxhdG9yIHdpdGggVURJRCAke3RoaXMudWRpZH06ICR7cmVzdWx0U2NyaXB0fWApO1xuICAgIHJldHVybiBhd2FpdCBVSV9DTElFTlRfQUNDRVNTX0dVQVJELmFjcXVpcmUodGhpcy5zaW11bGF0b3JBcHAsIGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnb3Nhc2NyaXB0JywgWyctZScsIHJlc3VsdFNjcmlwdF0pO1xuICAgICAgICByZXR1cm4gc3Rkb3V0O1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgY29tcGxldGUgb3BlcmF0aW9uLiBNYWtlIHN1cmUgU2ltdWxhdG9yIFVJIGlzIHJ1bm5pbmcgYW5kIHRoZSBwYXJlbnQgQXBwaXVtIGFwcGxpY2F0aW9uIChlLiBnLiBBcHBpdW0uYXBwIG9yIFRlcm1pbmFsLmFwcCkgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBpcyBwcmVzZW50IGluIFN5c3RlbSBQcmVmZXJlbmNlcyA+IFNlY3VyaXR5ICYgUHJpdmFjeSA+IFByaXZhY3kgPiBBY2Nlc3NpYmlsaXR5IGxpc3QuIElmIHRoZSBvcGVyYXRpb24gaXMgc3RpbGwgdW5zdWNjZXNzZnVsIHRoZW4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBpdCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgU2ltdWxhdG9yLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCBzdGF0ZSBvZiBCaW9tZXRyaWMgRW5yb2xsbWVudCBmZWF0dXJlLlxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gRWl0aGVyIHRydWUgb3IgZmFsc2VcbiAgICogQHRocm93cyB7RXJyb3J9IElmIEVucm9sbG1lbnQgc3RhdGUgY2Fubm90IGJlIGRldGVybWluZWRcbiAgICovXG4gIGFzeW5jIGlzQmlvbWV0cmljRW5yb2xsZWQgKCkge1xuICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IHRoaXMuZXhlY3V0ZVVJQ2xpZW50U2NyaXB0KGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBzZXQgZHN0TWVudUl0ZW0gdG8gbWVudSBpdGVtIFwiVG91Y2ggSUQgRW5yb2xsZWRcIiBvZiBtZW51IDEgb2YgbWVudSBiYXIgaXRlbSBcIkhhcmR3YXJlXCIgb2YgbWVudSBiYXIgMVxuICAgICAgICAgIHNldCBpc0NoZWNrZWQgdG8gKHZhbHVlIG9mIGF0dHJpYnV0ZSBcIkFYTWVudUl0ZW1NYXJrQ2hhclwiIG9mIGRzdE1lbnVJdGVtKSBpcyBcIuKck1wiXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICAgIGxvZy5kZWJ1ZyhgVG91Y2ggSUQgZW5yb2xsZWQgc3RhdGU6ICR7b3V0cHV0fWApO1xuICAgIHJldHVybiBfLmlzU3RyaW5nKG91dHB1dCkgJiYgb3V0cHV0LnRyaW0oKSA9PT0gJ3RydWUnO1xuICB9XG5cbiAgLyoqXG4gICAqIEVucm9sbHMgYmlvbWV0cmljIChUb3VjaElkLCBGYWNlSWQpIGZlYXR1cmUgdGVzdGluZyBpbiBTaW11bGF0b3IgVUkgY2xpZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzRW5hYmxlZCAtIERlZmluZXMgd2hldGhlciBiaW9tZXRyaWMgc3RhdGUgaXMgZW5hYmxlZC9kaXNhYmxlZFxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGVucm9sbGVkIHN0YXRlIGNhbm5vdCBiZSBjaGFuZ2VkXG4gICAqL1xuICBhc3luYyBlbnJvbGxCaW9tZXRyaWMgKGlzRW5hYmxlZCA9IHRydWUpIHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIlRvdWNoIElEIEVucm9sbGVkXCIgb2YgbWVudSAxIG9mIG1lbnUgYmFyIGl0ZW0gXCJIYXJkd2FyZVwiIG9mIG1lbnUgYmFyIDFcbiAgICAgICAgICBzZXQgaXNDaGVja2VkIHRvICh2YWx1ZSBvZiBhdHRyaWJ1dGUgXCJBWE1lbnVJdGVtTWFya0NoYXJcIiBvZiBkc3RNZW51SXRlbSkgaXMgXCLinJNcIlxuICAgICAgICAgIGlmICR7aXNFbmFibGVkID8gJ25vdCAnIDogJyd9aXNDaGVja2VkIHRoZW5cbiAgICAgICAgICAgIGNsaWNrIGRzdE1lbnVJdGVtXG4gICAgICAgICAgZW5kIGlmXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmRzIGEgbm90aWZpY2F0aW9uIHRvIG1hdGNoL25vdCBtYXRjaCB0aGUgdG91Y2ggaWQuXG4gICAqXG4gICAqIEBwYXJhbSB7P2Jvb2xlYW59IHNob3VsZE1hdGNoIFt0cnVlXSAtIFNldCBpdCB0byB0cnVlIG9yIGZhbHNlIGluIG9yZGVyIHRvIGVtdWxhdGVcbiAgICogbWF0Y2hpbmcvbm90IG1hdGNoaW5nIHRoZSBjb3JyZXNwb25kaW5nIGJpb21ldHJpY1xuICAgKi9cbiAgYXN5bmMgc2VuZEJpb21ldHJpY01hdGNoIChzaG91bGRNYXRjaCA9IHRydWUpIHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIiR7c2hvdWxkTWF0Y2ggPyAnTWF0Y2hpbmcnIDogJ05vbi1tYXRjaGluZyd9XCIgb2YgbWVudSAxIG9mIG1lbnUgaXRlbSBcIlNpbXVsYXRlIEZpbmdlciBUb3VjaFwiIG9mIG1lbnUgMSBvZiBtZW51IGJhciBpdGVtIFwiSGFyZHdhcmVcIiBvZiBtZW51IGJhciAxXG4gICAgICAgICAgY2xpY2sgZHN0TWVudUl0ZW1cbiAgICAgICAgZW5kIHRlbGxcbiAgICAgIGVuZCB0ZWxsXG4gICAgYCk7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBhIHNwZWNpYWwgQXBwbGUgc2NyaXB0LCB3aGljaCBjbGlja3MgdGhlIHBhcnRpY3VsYXIgYnV0dG9uIG9uIERhdGFiYXNlIGFsZXJ0LlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGluY3JlYXNlIC0gQ2xpY2sgdGhlIGJ1dHRvbiB3aXRoICdJbmNyZWFzZScgdGl0bGUgb24gdGhlIGFsZXJ0IGlmIHRoaXNcbiAgICogICBwYXJhbWV0ZXIgaXMgdHJ1ZS4gVGhlICdDYW5jZWwnIGJ1dHRvbiB3aWxsIGJlIGNsaWNrZWQgb3RoZXJ3aXNlLlxuICAgKi9cbiAgYXN5bmMgZGlzbWlzc0RhdGFiYXNlQWxlcnQgKGluY3JlYXNlID0gdHJ1ZSkge1xuICAgIGxldCBidXR0b24gPSBpbmNyZWFzZSA/ICdJbmNyZWFzZScgOiAnQ2FuY2VsJztcbiAgICBsb2cuZGVidWcoYEF0dGVtcHRpbmcgdG8gZGlzbWlzcyBkYXRhYmFzZSBhbGVydCB3aXRoICcke2J1dHRvbn0nIGJ1dHRvbmApO1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVVJQ2xpZW50U2NyaXB0KGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBjbGljayBidXR0b24gXCIke2J1dHRvbn1cIiBvZiB3aW5kb3cgMVxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgKTtcbiAgfVxuXG4gIC8vcmVnaW9uIEtleWNoYWlucyBJbnRlcmFjdGlvblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSBiYWNrdXAgb2Yga2V5Y2hhaW5zIGZvbGRlci5cbiAgICogVGhlIHByZXZpb3VzbHkgY3JlYXRlZCBiYWNrdXAgd2lsbCBiZSBhdXRvbWF0aWNhbGx5XG4gICAqIGRlbGV0ZWQgaWYgdGhpcyBtZXRob2Qgd2FzIGNhbGxlZCB0d2ljZSBpbiBhIHJvdyB3aXRob3V0XG4gICAqIGByZXN0b3JlS2V5Y2hhaW5zYCBiZWluZyBpbnZva2VkLlxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgYmFja3VwIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bGwuXG4gICAqL1xuICBhc3luYyBiYWNrdXBLZXljaGFpbnMgKCkge1xuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHRoaXMua2V5Y2hhaW5QYXRoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGJhY2t1cFBhdGggPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe1xuICAgICAgcHJlZml4OiBga2V5Y2hhaW5zX2JhY2t1cF8ke01hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSl9YCxcbiAgICAgIHN1ZmZpeDogJy56aXAnLFxuICAgIH0pO1xuICAgIGNvbnN0IHppcEFyZ3MgPSBbXG4gICAgICAnLXInLCBiYWNrdXBQYXRoLFxuICAgICAgYCR7dGhpcy5rZXljaGFpblBhdGh9JHtwYXRoLnNlcH1gXG4gICAgXTtcbiAgICBsb2cuZGVidWcoYENyZWF0aW5nIGtleWNoYWlucyBiYWNrdXAgd2l0aCAnemlwICR7emlwQXJncy5qb2luKCcgJyl9JyBjb21tYW5kYCk7XG4gICAgYXdhaXQgZXhlYygnemlwJywgemlwQXJncyk7XG4gICAgaWYgKF8uaXNTdHJpbmcodGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCkgJiYgYXdhaXQgZnMuZXhpc3RzKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpKSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsodGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCk7XG4gICAgfVxuICAgIHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGggPSBiYWNrdXBQYXRoO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RvcmUgdGhlIHByZXZpc291bHkgY3JlYXRlZCBrZXljaGFpbnMgYmFja3VwLlxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd8QXJyYXk8c3RyaW5nPn0gZXhjbHVkZVBhdHRlcm5zIC0gVGhlIGxpc3RcbiAgICogb2YgZmlsZSBuYW1lIHBhdHRlcm5zIHRvIGJlIGV4Y2x1ZGVkIGZyb20gcmVzdG9yZS4gVGhlIGZvcm1hdFxuICAgKiBvZiBlYWNoIGl0ZW0gc2hvdWxkIGJlIHRoZSBzYW1lIGFzICcteCcgb3B0aW9uIGZvcm1hdCBmb3JcbiAgICogJ3VuemlwJyB1dGlsaXR5LiBUaGlzIGNhbiBhbHNvIGJlIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZyxcbiAgICogd2hpY2ggaXMgZ29pbmcgYmUgdHJhbnNmb3JtZWQgaW50byBhIGxpc3QgYXV0b21hdGljYWxseSxcbiAgICogZm9yIGV4YW1wbGU6ICcqLmRiKixibGFibGEuc3FsaXRlJ1xuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gSWYgdGhlIHJlc3RvcmUgb3ByYXRpb24gd2FzIHN1Y2Nlc3NmdWwuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSBpcyBubyBrZXljaGFpbnMgYmFja3VwIGF2YWlsYWJsZSBmb3IgcmVzdG9yZS5cbiAgICovXG4gIGFzeW5jIHJlc3RvcmVLZXljaGFpbnMgKGV4Y2x1ZGVQYXR0ZXJucyA9IFtdKSB7XG4gICAgaWYgKCFfLmlzU3RyaW5nKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpIHx8ICFhd2FpdCBmcy5leGlzdHModGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGtleWNoYWlucyBiYWNrdXAgYXJjaGl2ZSBkb2VzIG5vdCBleGlzdC4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYEFyZSB5b3Ugc3VyZSBpdCB3YXMgY3JlYXRlZCBiZWZvcmU/YCk7XG4gICAgfVxuXG4gICAgaWYgKF8uaXNTdHJpbmcoZXhjbHVkZVBhdHRlcm5zKSkge1xuICAgICAgZXhjbHVkZVBhdHRlcm5zID0gZXhjbHVkZVBhdHRlcm5zLnNwbGl0KCcsJykubWFwKCh4KSA9PiB4LnRyaW0oKSk7XG4gICAgfVxuICAgIGNvbnN0IGlzU2VydmVyUnVubmluZyA9IGF3YWl0IHRoaXMuaXNSdW5uaW5nKCk7XG4gICAgbGV0IHBsaXN0UGF0aDtcbiAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nKSB7XG4gICAgICBwbGlzdFBhdGggPSBwYXRoLnJlc29sdmUoYXdhaXQgdGhpcy5nZXRMYXVuY2hEYWVtb25zUm9vdCgpLCAnY29tLmFwcGxlLnNlY3VyaXR5ZC5wbGlzdCcpO1xuICAgICAgaWYgKCFhd2FpdCBmcy5leGlzdHMocGxpc3RQYXRoKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjbGVhciBrZXljaGFpbnMgYmVjYXVzZSAnJHtwbGlzdFBhdGh9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFsnbGF1bmNoY3RsJywgJ3VubG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgIGF3YWl0IG1rZGlycCh0aGlzLmtleWNoYWluUGF0aCk7XG4gICAgICBjb25zdCB1bnppcEFyZ3MgPSBbXG4gICAgICAgICctbycsIHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgsXG4gICAgICAgIC4uLihfLmZsYXRNYXAoZXhjbHVkZVBhdHRlcm5zLm1hcCgoeCkgPT4gWycteCcsIHhdKSkpLFxuICAgICAgICAnLWQnLCAnLydcbiAgICAgIF07XG4gICAgICBsb2cuZGVidWcoYFJlc3RvcmluZyBrZXljaGFpbnMgd2l0aCAndW56aXAgJHt1bnppcEFyZ3Muam9pbignICcpfScgY29tbWFuZGApO1xuICAgICAgYXdhaXQgZXhlYygndW56aXAnLCB1bnppcEFyZ3MpO1xuICAgICAgYXdhaXQgZnMudW5saW5rKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpO1xuICAgICAgdGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCA9IG51bGw7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlmIChpc1NlcnZlclJ1bm5pbmcgJiYgcGxpc3RQYXRoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbJ2xhdW5jaGN0bCcsICdsb2FkJywgcGxpc3RQYXRoXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFycyBLZXljaGFpbnMgZm9yIHRoZSBwYXJ0aWN1bGFyIHNpbXVsYXRvciBpbiBydW50aW1lICh0aGVyZSBpcyBubyBuZWVkIHRvIHN0b3AgaXQpLlxuICAgKlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYga2V5Y2hhaW4gY2xlYW51cCBoYXMgZmFpbGVkLlxuICAgKi9cbiAgYXN5bmMgY2xlYXJLZXljaGFpbnMgKCkge1xuICAgIGNvbnN0IHBsaXN0UGF0aCA9IHBhdGgucmVzb2x2ZShhd2FpdCB0aGlzLmdldExhdW5jaERhZW1vbnNSb290KCksICdjb20uYXBwbGUuc2VjdXJpdHlkLnBsaXN0Jyk7XG4gICAgaWYgKCFhd2FpdCBmcy5leGlzdHMocGxpc3RQYXRoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY2xlYXIga2V5Y2hhaW5zIGJlY2F1c2UgJyR7cGxpc3RQYXRofScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFsnbGF1bmNoY3RsJywgJ3VubG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIHRyeSB7XG4gICAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKHRoaXMua2V5Y2hhaW5QYXRoKSkge1xuICAgICAgICBhd2FpdCBmcy5yaW1yYWYodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgICBhd2FpdCBta2RpcnAodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgfVxuICAgIH0gZmluYWxseSB7XG4gICAgICBhd2FpdCB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoWydsYXVuY2hjdGwnLCAnbG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIH1cbiAgfVxuXG4gIC8vZW5kcmVnaW9uXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFByb2Nlc3NJbmZvXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBwaWQgVGhlIGFjdHVhbCBwcm9jZXNzIGlkZW50aWZpZXIuXG4gICAqIENvdWxkIGJlIHplcm8gaWYgdGhlIHByb2Nlc3MgaXMgdGhlIHN5c3RlbSBvbmUuXG4gICAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gZ3JvdXAgVGhlIHByb2Nlc3MgZ3JvdXAgaWRlbnRpZmllci5cbiAgICogVGhpcyBjb3VsZCBiZSBgbnVsbGAgaWYgdGhlIHByb2Nlc3MgaXMgbm90IGEgcGFydCBvZiB0aGVcbiAgICogcGFydGljdWxhciBncm91cC4gRm9yIGBub3JtYWxgIGFwcGxpY2F0aW9uIHByb2Nlc3NlcyB0aGUgZ3JvdXBcbiAgICogbmFtZSB1c3VhbGx5IGVxdWFscyB0byBgVUlLaXRBcHBsaWNhdGlvbmAuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lIFRoZSBwcm9jZXNzIG5hbWUsIGZvciBleGFtcGxlXG4gICAqIGBjb20uYXBwbGUuUHJlZmVyZW5jZXNgXG4gICAqL1xuXG4gIC8qKlxuICAgKiBMaXN0cyBwcm9jZXNzZXMgdGhhdCBhcmUgY3VycmVudGx5IHJ1bm5pbmcgb24gdGhlIGdpdmVuIFNpbXVsYXRvci5cbiAgICogVGhlIHNpbXVsYXRvciBtdXN0IGJlIGluIHJ1bm5pbmcgc3RhdGUgaW4gb3JkZXIgZm9yIHRoaXNcbiAgICogbWV0aG9kIHRvIHdvcmsgcHJvcGVybHkuXG4gICAqXG4gICAqIEByZXR1cm4ge0FycmF5PFByb2Nlc3NJbmZvPn0gVGhlIGxpc3Qgb2YgcmV0cmlldmVkIHByb2Nlc3NcbiAgICogaW5mb3JtYXRpb25cbiAgICogQHRocm93cyB7RXJyb3J9IGlmIG5vIHByb2Nlc3MgaW5mb3JtYXRpb24gY291bGQgYmUgcmV0cmlldmVkLlxuICAgKi9cbiAgYXN5bmMgcHMgKCkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFtcbiAgICAgICdsYXVuY2hjdGwnLFxuICAgICAgJ3ByaW50JyxcbiAgICAgICdzeXN0ZW0nLFxuICAgIF0pO1xuXG4gICAgY29uc3Qgc2VydmljZXNNYXRjaCA9IC9eXFxzKnNlcnZpY2VzXFxzKj1cXHMqeyhbXn1dKykvbS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKCFzZXJ2aWNlc01hdGNoKSB7XG4gICAgICBsb2cuZGVidWcoc3Rkb3V0KTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGxpc3Qgb2YgYWN0aXZlIHByb2Nlc3NlcyBjYW5ub3QgYmUgcmV0cmlldmVkYCk7XG4gICAgfVxuICAgIC8qXG4gICAgRXhhbXBsZSBtYXRjaDpcbiAgICAgICAgMCAgICAgNzggXHRjb20uYXBwbGUucmVzb3VyY2VncmFiYmVyZFxuICAgIDgyMTU4ICAgICAgLSBcdGNvbS5hcHBsZS5hc3Npc3RhbnRfc2VydmljZVxuICAgIDgyMTIwICAgICAgLSBcdGNvbS5hcHBsZS5uYW5vcmVnaXN0cnlkXG4gICAgODIwODcgICAgICAtIFx0Y29tLmFwcGxlLm5vdGlmeWRcbiAgICA4MjI2NCAgICAgIC0gXHRVSUtpdEFwcGxpY2F0aW9uOmNvbS5hcHBsZS5QcmVmZXJlbmNlc1s3MDRiXVtyYi1sZWdhY3ldXG4gICAgKi9cbiAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICBjb25zdCBwYXR0ZXJuID0gL15cXHMqKFxcZCspXFxzK1tcXGQtXStcXHMrKFtcXHdcXC0uXSs6KT8oW1xcd1xcLS5dKykvZ207XG4gICAgbGV0IG1hdGNoO1xuICAgIHdoaWxlICgobWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoc2VydmljZXNNYXRjaFsxXSkpKSB7XG4gICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgIHBpZDogcGFyc2VJbnQobWF0Y2hbMV0sIDEwKSxcbiAgICAgICAgZ3JvdXA6IF8udHJpbUVuZChtYXRjaFsyXSwgJzonKSB8fCBudWxsLFxuICAgICAgICBuYW1lOiBtYXRjaFszXSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHBhcnRpY3VsYXIgcGVybWlzc2lvbiB0byB0aGUgYXBwbGljYXRpb24gYnVuZGxlLiBTZWVcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL3dpeC9BcHBsZVNpbXVsYXRvclV0aWxzIGZvciBtb3JlIGRldGFpbHMgb25cbiAgICogdGhlIGF2YWlsYWJsZSBzZXJ2aWNlIG5hbWVzIGFuZCBzdGF0dXNlcy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwZXJtaXNzaW9uIC0gU2VydmljZSBuYW1lIHRvIGJlIHNldC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIGRlc2lyZWQgc3RhdHVzIGZvciB0aGUgc2VydmljZS5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9uLlxuICAgKi9cbiAgYXN5bmMgc2V0UGVybWlzc2lvbiAoYnVuZGxlSWQsIHBlcm1pc3Npb24sIHZhbHVlKSB7XG4gICAgYXdhaXQgdGhpcy5zZXRQZXJtaXNzaW9ucyhidW5kbGVJZCwge1twZXJtaXNzaW9uXTogdmFsdWV9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwZXJtaXNzaW9ucyBmb3IgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gYnVuZGxlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBBcHBsaWNhdGlvbiBidW5kbGUgaWRlbnRpZmllci5cbiAgICogQHBhcmFtIHtPYmplY3R9IHBlcm1pc3Npb25zTWFwcGluZyAtIEEgbWFwcGluZyB3aGVyZSBrYXlzXG4gICAqIGFyZSBzZXJ2aWNlIG5hbWVzIGFuZCB2YWx1ZXMgYXJlIHRoZWlyIGNvcnJlc3BvbmRpbmcgc3RhdHVzIHZhbHVlcy5cbiAgICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS93aXgvQXBwbGVTaW11bGF0b3JVdGlsc1xuICAgKiBmb3IgbW9yZSBkZXRhaWxzIG9uIGF2YWlsYWJsZSBzZXJ2aWNlIG5hbWVzIGFuZCBzdGF0dXNlcy5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIHNldFBlcm1pc3Npb25zIChidW5kbGVJZCwgcGVybWlzc2lvbnNNYXBwaW5nKSB7XG4gICAgbG9nLmRlYnVnKGBTZXR0aW5nIGFjY2VzcyBmb3IgJyR7YnVuZGxlSWR9JzogYCArXG4gICAgICBKU09OLnN0cmluZ2lmeShwZXJtaXNzaW9uc01hcHBpbmcsIG51bGwsIDIpKTtcbiAgICBhd2FpdCB0aGlzLnBlcm1pc3Npb25zLnNldEFjY2VzcyhidW5kbGVJZCwgcGVybWlzc2lvbnNNYXBwaW5nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgY3VycmVudCBwZXJtaXNzaW9uIHN0YXR1cyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGJ1bmRsZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZXJ2aWNlTmFtZSAtIE9uZSBvZiBhdmFpbGFibGUgc2VydmljZSBuYW1lcy5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSByZXRyaWV2aW5nIHBlcm1pc3Npb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0UGVybWlzc2lvbiAoYnVuZGxlSWQsIHNlcnZpY2VOYW1lKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wZXJtaXNzaW9ucy5nZXRBY2Nlc3MoYnVuZGxlSWQsIHNlcnZpY2VOYW1lKTtcbiAgICBsb2cuZGVidWcoYEdvdCAke3NlcnZpY2VOYW1lfSBhY2Nlc3Mgc3RhdHVzIGZvciAnJHtidW5kbGVJZH0nOiAke3Jlc3VsdH1gKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgdGhlIGdpdmVuIGNlcnRpZmljYXRlIGludG8gdGhlIFRydXN0ZWQgUm9vdCBTdG9yZSBvbiB0aGUgc2ltdWxhdG9yLlxuICAgKiBUaGUgc2ltdWxhdG9yIG11c3QgYmUgc2h1dCBkb3duIGluIG9yZGVyIGZvciB0aGlzIG1ldGhvZCB0byB3b3JrIHByb3Blcmx5LlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF5bG9hZCB0aGUgY29udGVudCBvZiB0aGUgUEVNIGNlcnRpZmljYXRlXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBgdHJ1ZWAgaWYgdGhlIGNlcnRpZmljYXRlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBpbnN0YWxsZWRcbiAgICogb3IgYGZhbHNlYCBpZiBpdCBoYXMgYWxyZWFkeSBiZWVuIHRoZXJlXG4gICAqL1xuICBhc3luYyBhZGRDZXJ0aWZpY2F0ZSAocGF5bG9hZCwgLyogb3B0cyA9IHt9ICovKSB7XG4gICAgaWYgKGF3YWl0IGhhc1NTTENlcnQocGF5bG9hZCwgdGhpcy51ZGlkKSkge1xuICAgICAgbG9nLmluZm8oYFNTTCBjZXJ0aWZpY2F0ZSAnJHtfLnRydW5jYXRlKHBheWxvYWQsIHtsZW5ndGg6IDIwfSl9JyBhbHJlYWR5IGluc3RhbGxlZGApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsb2cuaW5mbyhgSW5zdGFsbGluZyBTU0wgcm9vdCBjZXJ0aWZpY2F0ZSAnJHtfLnRydW5jYXRlKHBheWxvYWQsIHtsZW5ndGg6IDIwfSl9J2ApO1xuICAgIGF3YWl0IGluc3RhbGxTU0xDZXJ0KHBheWxvYWQsIHRoaXMudWRpZCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogU2ltdWxhdGVzIHB1c2ggbm90aWZpY2F0aW9uIGRlbGl2ZXJ5XG4gICAqXG4gICAqIEBzaW5jZSBYY29kZSBTREsgMTEuNFxuICAgKi9cbiAgYXN5bmMgcHVzaE5vdGlmaWNhdGlvbiAoLyogcGF5bG9hZCAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFhjb2RlIFNESyAnJHt0aGlzLnhjb2RlVmVyc2lvbn0nIGlzIHRvbyBvbGQgdG8gcHVzaCBub3RpZmljYXRpb25zYCk7XG4gIH1cblxuICBhc3luYyBnZXRMYXVuY2hEYWVtb25zUm9vdCAoKSB7XG4gICAgY29uc3QgZGV2Um9vdCA9IGF3YWl0IGdldERldmVsb3BlclJvb3QoKTtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKGRldlJvb3QsXG4gICAgICAnUGxhdGZvcm1zL2lQaG9uZVNpbXVsYXRvci5wbGF0Zm9ybS9EZXZlbG9wZXIvU0RLcy9pUGhvbmVTaW11bGF0b3Iuc2RrL1N5c3RlbS9MaWJyYXJ5L0xhdW5jaERhZW1vbnMnKTtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBfZ2V0RGV2aWNlU3RyaW5nUGxhdGZvcm1WZXJzaW9uIChwbGF0Zm9ybVZlcnNpb24pIHtcbiAgICBsZXQgcmVxVmVyc2lvbiA9IHBsYXRmb3JtVmVyc2lvbjtcbiAgICBpZiAoIXJlcVZlcnNpb24pIHtcbiAgICAgIHJlcVZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRNYXhJT1NTREsoKTtcbiAgICAgIGxvZy53YXJuKGBObyBwbGF0Zm9ybSB2ZXJzaW9uIHNldC4gVXNpbmcgbWF4IFNESyB2ZXJzaW9uOiAke3JlcVZlcnNpb259YCk7XG4gICAgICAvLyB0aGlzIHdpbGwgYmUgYSBudW1iZXIsIGFuZCBwb3NzaWJseSBhbiBpbnRlZ2VyIChlLmcuLCBpZiBtYXggaU9TIFNESyBpcyA5KVxuICAgICAgLy8gc28gdHVybiBpdCBpbnRvIGEgc3RyaW5nIGFuZCBhZGQgYSAuMCBpZiBuZWNlc3NhcnlcbiAgICAgIGlmICghXy5pc1N0cmluZyhyZXFWZXJzaW9uKSkge1xuICAgICAgICByZXFWZXJzaW9uID0gKHJlcVZlcnNpb24gJSAxKSA/IFN0cmluZyhyZXFWZXJzaW9uKSA6IGAke3JlcVZlcnNpb259LjBgO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVxVmVyc2lvbjtcbiAgfVxuXG4gIC8vIGNoYW5nZSB0aGUgZm9ybWF0IGluIHN1YmNsYXNzZXMsIGFzIG5lY2Vzc2FyeVxuICBzdGF0aWMgYXN5bmMgX2dldERldmljZVN0cmluZ1ZlcnNpb25TdHJpbmcgKHBsYXRmb3JtVmVyc2lvbikge1xuICAgIGxldCByZXFWZXJzaW9uID0gYXdhaXQgdGhpcy5fZ2V0RGV2aWNlU3RyaW5nUGxhdGZvcm1WZXJzaW9uKHBsYXRmb3JtVmVyc2lvbik7XG5cbiAgICByZXR1cm4gYCgke3JlcVZlcnNpb259IFNpbXVsYXRvcilgO1xuICB9XG5cbiAgLy8gY2hhbmdlIHRoZSBmb3JtYXQgaW4gc3ViY2xhc3NlcywgYXMgbmVjZXNzYXJ5XG4gIHN0YXRpYyBfZ2V0RGV2aWNlU3RyaW5nQ29uZmlnRml4ICgpIHtcbiAgICAvLyBzb21lIGRldmljZXMgbmVlZCB0byBiZSB1cGRhdGVkXG4gICAgcmV0dXJuIHtcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoNy4xIFNpbXVsYXRvciknOiAnaVBhZCAyICg3LjEgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguMCBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC4wIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjEgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguMSBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC4yIFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjIgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguMyBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC4zIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjQgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguNCBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg3LjEgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNXMgKDcuMSBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjQgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC40IFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguMyBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjMgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC4yIFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguMiBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjEgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC4xIFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguMCBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjAgU2ltdWxhdG9yKSdcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFRha2VzIGEgc2V0IG9mIG9wdGlvbnMgYW5kIGZpbmRzIHRoZSBjb3JyZWN0IGRldmljZSBzdHJpbmcgaW4gb3JkZXIgZm9yIEluc3RydW1lbnRzIHRvXG4gICAqIGlkZW50aWZ5IHRoZSBjb3JyZWN0IHNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdHMgLSBUaGUgb3B0aW9ucyBhdmFpbGFibGUgYXJlOlxuICAgKiAgIC0gYGRldmljZU5hbWVgIC0gYSBuYW1lIGZvciB0aGUgZGV2aWNlLiBJZiB0aGUgZ2l2ZW4gZGV2aWNlIG5hbWUgc3RhcnRzIHdpdGggYD1gLCB0aGUgbmFtZSwgbGVzcyB0aGUgZXF1YWxzIHNpZ24sIGlzIHJldHVybmVkLlxuICAgKiAgIC0gYHBsYXRmb3JtVmVyc2lvbmAgLSB0aGUgdmVyc2lvbiBvZiBpT1MgdG8gdXNlLiBEZWZhdWx0cyB0byB0aGUgY3VycmVudCBYY29kZSdzIG1heGltdW0gU0RLIHZlcnNpb24uXG4gICAqICAgLSBgZm9yY2VJcGhvbmVgIC0gZm9yY2UgdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIGRldmljZSBzdHJpbmcgdG8gaVBob25lLiBEZWZhdWx0cyB0byBgZmFsc2VgLlxuICAgKiAgIC0gYGZvcmNlSXBhZGAgLSBmb3JjZSB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgZGV2aWNlIHN0cmluZyB0byBpUGFkLiBEZWZhdWx0cyB0byBgZmFsc2VgLlxuICAgKiAgIElmIGJvdGggYGZvcmNlSXBob25lYCBhbmQgYGZvcmNlSXBhZGAgYXJlIHRydWUsIHRoZSBkZXZpY2Ugd2lsbCBiZSBmb3JjZWQgdG8gaVBob25lLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBmb3VuZCBkZXZpY2Ugc3RyaW5nLlxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldERldmljZVN0cmluZyAob3B0cykge1xuICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCB7XG4gICAgICBkZXZpY2VOYW1lOiBudWxsLFxuICAgICAgcGxhdGZvcm1WZXJzaW9uOiBudWxsLFxuICAgICAgZm9yY2VJcGhvbmU6IGZhbHNlLFxuICAgICAgZm9yY2VJcGFkOiBmYWxzZVxuICAgIH0sIG9wdHMpO1xuICAgIGxldCBsb2dPcHRzID0ge1xuICAgICAgZGV2aWNlTmFtZTogb3B0cy5kZXZpY2VOYW1lLFxuICAgICAgcGxhdGZvcm1WZXJzaW9uOiBvcHRzLnBsYXRmb3JtVmVyc2lvbixcbiAgICAgIGZvcmNlSXBob25lOiBvcHRzLmZvcmNlSXBob25lLFxuICAgICAgZm9yY2VJcGFkOiBvcHRzLmZvcmNlSXBhZFxuICAgIH07XG4gICAgbG9nLmRlYnVnKGBHZXR0aW5nIGRldmljZSBzdHJpbmcgZnJvbSBvcHRpb25zOiAke0pTT04uc3RyaW5naWZ5KGxvZ09wdHMpfWApO1xuXG4gICAgLy8gc2hvcnQgY2lyY3VpdCBpZiB3ZSBhbHJlYWR5IGhhdmUgYSBkZXZpY2UgbmFtZVxuICAgIGlmICgob3B0cy5kZXZpY2VOYW1lIHx8ICcnKVswXSA9PT0gJz0nKSB7XG4gICAgICByZXR1cm4gb3B0cy5kZXZpY2VOYW1lLnN1YnN0cmluZygxKTtcbiAgICB9XG5cbiAgICBsZXQgaXNpUGhvbmUgPSAhIW9wdHMuZm9yY2VJcGhvbmUgfHwgIW9wdHMuZm9yY2VJcGFkO1xuXG4gICAgaWYgKG9wdHMuZGV2aWNlTmFtZSkge1xuICAgICAgbGV0IGRldmljZSA9IG9wdHMuZGV2aWNlTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKGRldmljZS5pbmRleE9mKCdpcGhvbmUnKSAhPT0gLTEpIHtcbiAgICAgICAgaXNpUGhvbmUgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChkZXZpY2UuaW5kZXhPZignaXBhZCcpICE9PSAtMSkge1xuICAgICAgICBpc2lQaG9uZSA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBpb3NEZXZpY2VTdHJpbmcgPSBvcHRzLmRldmljZU5hbWUgfHwgKGlzaVBob25lID8gJ2lQaG9uZSBTaW11bGF0b3InIDogJ2lQYWQgU2ltdWxhdG9yJyk7XG5cbiAgICAvLyBpZiBzb21lb25lIHBhc3NlcyBpbiBqdXN0IFwiaVBob25lXCIsIG1ha2UgdGhhdCBcImlQaG9uZSBTaW11bGF0b3JcIiB0b1xuICAgIC8vIGNvbmZvcm0gdG8gYWxsIHRoZSBsb2dpYyBiZWxvd1xuICAgIGlmICgvXihpUGhvbmV8aVBhZCkkLy50ZXN0KGlvc0RldmljZVN0cmluZykpIHtcbiAgICAgIGlvc0RldmljZVN0cmluZyArPSAnIFNpbXVsYXRvcic7XG4gICAgfVxuXG4gICAgLy8gd2Ugc3VwcG9ydCBkZXZpY2VOYW1lOiBcImlQaG9uZSBTaW11bGF0b3JcIiwgYW5kIGFsc28gd2FudCB0byBzdXBwb3J0XG4gICAgLy8gXCJpUGhvbmUgWFlaIFNpbXVsYXRvclwiLCBidXQgdGhlc2Ugc3RyaW5ncyBhcmVuJ3QgaW4gdGhlIGRldmljZSBsaXN0LlxuICAgIC8vIFNvLCBpZiBzb21lb25lIHNlbnQgaW4gXCJpUGhvbmUgWFlaIFNpbXVsYXRvclwiLCBzdHJpcCBvZmYgXCIgU2ltdWxhdG9yXCJcbiAgICAvLyBpbiBvcmRlciB0byBhbGxvdyB0aGUgZGVmYXVsdCBcImlQaG9uZSBYWVpcIiBtYXRjaFxuICAgIGlmICgvW14oaVBob25lfGlQYWQpXSBTaW11bGF0b3IvLnRlc3QoaW9zRGV2aWNlU3RyaW5nKSkge1xuICAgICAgaW9zRGV2aWNlU3RyaW5nID0gaW9zRGV2aWNlU3RyaW5nLnJlcGxhY2UoJyBTaW11bGF0b3InLCAnJyk7XG4gICAgfVxuICAgIGlvc0RldmljZVN0cmluZyArPSBgICR7YXdhaXQgdGhpcy5fZ2V0RGV2aWNlU3RyaW5nVmVyc2lvblN0cmluZyhvcHRzLnBsYXRmb3JtVmVyc2lvbil9YDtcblxuICAgIGxldCBDT05GSUdfRklYID0gdGhpcy5fZ2V0RGV2aWNlU3RyaW5nQ29uZmlnRml4KCk7XG5cbiAgICBsZXQgY29uZmlnRml4ID0gQ09ORklHX0ZJWDtcbiAgICBpZiAoY29uZmlnRml4W2lvc0RldmljZVN0cmluZ10pIHtcbiAgICAgIGlvc0RldmljZVN0cmluZyA9IGNvbmZpZ0ZpeFtpb3NEZXZpY2VTdHJpbmddO1xuICAgICAgbG9nLmRlYnVnKGBGaXhpbmcgZGV2aWNlLiBDaGFuZ2VkIGZyb20gJyR7b3B0cy5kZXZpY2VOYW1lfScgYCArXG4gICAgICAgICAgICAgICAgYHRvICcke2lvc0RldmljZVN0cmluZ30nYCk7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKGBGaW5hbCBkZXZpY2Ugc3RyaW5nIGlzICcke2lvc0RldmljZVN0cmluZ30nYCk7XG4gICAgcmV0dXJuIGlvc0RldmljZVN0cmluZztcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBzaW11bGF0b3IncyBXZWJJbnNwZWN0b3IgVW5peCBEb21haW4gU29ja2V0XG4gICAqICAgb3IgYG51bGxgIGlmIHRoZXJlIGlzIG5vIHNvY2tldC5cbiAgICovXG4gIGFzeW5jIGdldFdlYkluc3BlY3RvclNvY2tldCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIC8vIHRoZXJlIGlzIG5vIFdlYkluc3BlY3RvciBzb2NrZXQgZm9yIHRoaXMgdmVyc2lvbiBvZiBYY29kZVxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmZvciAobGV0IFtjbWQsIGZuXSBvZiBfLnRvUGFpcnMoZXh0ZW5zaW9ucykpIHtcbiAgU2ltdWxhdG9yWGNvZGU2LnByb3RvdHlwZVtjbWRdID0gZm47XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNpbXVsYXRvclhjb2RlNjtcbmV4cG9ydCB7IFNpbXVsYXRvclhjb2RlNiwgQk9PVF9DT01QTEVURURfRVZFTlQsIFNQUklOR0JPQVJEX0JVTkRMRV9JRCB9O1xuIl0sImZpbGUiOiJsaWIvc2ltdWxhdG9yLXhjb2RlLTYuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
